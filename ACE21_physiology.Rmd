---
title: "R Notebook"
html_document:
code_folding: hide
toc:yes
toc_depth:3
toc_float:yes
output: 
chunk_output_type: console
editor_options: 
  chunk_output_type: console
---

Data analysis for the All Coral Experiment #2021. Physiological variables:  
AFDW
Flow Cytometry (cell counts)
Protien
Biomass
BW
PAM


#Data and libraries
```{r}   
knitr::opts_chunk$set(warning=FALSE, message=FALSE)


library(plyr)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(lmerTest)
library(car)
library(emmeans)
library(gridExtra)
library(multcomp)
library(reshape)
library(tidyverse)
library(factoextra)
library(reshape2)
library(vegan)
library(pairwiseAdonis)
library("scales")
packageVersion("scales")
library(RColorBrewer)
library(colorRamps)
library(devtools)
```

Load meta
```{r}         
meta  <- read.csv("Data/Master_Metadata_20190402.csv")
#remove frags that re duplicated or T3
meta<-meta[!(meta$X=="REMOVE"),]
meta<- meta[!(meta$Frag.ID == "3149"),] # dup
#write.csv(meta,"ACE21meta.csv")

#add new col for Clades
# EDIT sample data
 #Pcomp
  meta$Clade[meta$Parent.ID==314]<-"C15cj"
  meta$Clade[meta$Parent.ID==317]<-"C15cj"
  meta$Clade[meta$Parent.ID==319]<-"C15cj"
  meta$Clade[meta$Parent.ID==320]<-"C15cj"
  meta$Clade[meta$Parent.ID==321]<-"C15cj"
  meta$Clade[meta$Parent.ID==322]<-"C15cj"
  meta$Clade[meta$Parent.ID==313]<-"C15n"
  meta$Clade[meta$Parent.ID==315]<-"C15n"
  meta$Clade[meta$Parent.ID==316]<-"C15n"
  meta$Clade[meta$Parent.ID==318]<-"C15n"
  meta$Clade[meta$Parent.ID==323]<-"C15n"
  meta$Clade[meta$Parent.ID==324]<-"C15n"
  
  #Pvar
  meta$Clade[meta$Parent.ID==353]<-"C1"
  meta$Clade[meta$Parent.ID==358]<-"C1"
  meta$Clade[meta$Parent.ID==361]<-"C1"
  meta$Clade[meta$Parent.ID==325]<-"C1"
  meta$Clade[meta$Parent.ID==356]<-"C1"
  meta$Clade[meta$Parent.ID==351]<-"C27"
  meta$Clade[meta$Parent.ID==354]<-"C27"
  meta$Clade[meta$Parent.ID==355]<-"C27"
  meta$Clade[meta$Parent.ID==357]<-"C27"
  meta$Clade[meta$Parent.ID==359]<-"C27"
  meta$Clade[meta$Parent.ID==360]<-"C27"
  meta$Clade[meta$Parent.ID==362]<-"C27"
  
#Pacu
  meta$Clade[meta$Parent.ID==311]<-"C42"
  meta$Clade[meta$Parent.ID==301]<-"CCC"
  meta$Clade[meta$Parent.ID==304]<-"CCC"
  meta$Clade[meta$Parent.ID==306]<-"CCC"
  meta$Clade[meta$Parent.ID==303]<-"CCC"
  meta$Clade[meta$Parent.ID==307]<-"C42"
  meta$Clade[meta$Parent.ID==308]<-"CCC"
  meta$Clade[meta$Parent.ID==310]<-"CCC"
  meta$Clade[meta$Parent.ID==312]<-"CCC"
  meta$Clade[meta$Parent.ID==302]<-"CCC"
  meta$Clade[meta$Parent.ID==305]<-"C42"
  meta$Clade[meta$Parent.ID==309]<-"C42"

#Mcap
  meta$Clade[meta$Parent.ID==363]<-"C"
  meta$Clade[meta$Parent.ID==364]<-"CD"
  meta$Clade[meta$Parent.ID==365]<-"CD"
  meta$Clade[meta$Parent.ID==366]<-"CD"
  meta$Clade[meta$Parent.ID==367]<-"C"
  meta$Clade[meta$Parent.ID==368]<-"CD"
  meta$Clade[meta$Parent.ID==369]<-"CD"
  meta$Clade[meta$Parent.ID==370]<-"C"
  meta$Clade[meta$Parent.ID==371]<-"C"
  meta$Clade[meta$Parent.ID==372]<-"C"
  meta$Clade[meta$Parent.ID==373]<-"C"
  meta$Clade[meta$Parent.ID==374]<-"CD"

meta$Clade<-as.factor(meta$Clade)

#add tissue thickness, transmission mode, 
  meta$Tissue[meta$Species=="Montipora_capitata"]<-"thick"
  meta$Tissue[meta$Species=="Porites_compressa"]<-"thick"
  meta$Tissue[meta$Species=="Pavona_varians"]<-"thick"
  meta$Tissue[meta$Species=="Pocillopora_acuta"]<-"thin"

  meta$transmission[meta$Species=="Montipora_capitata"]<-"vertical"
  meta$transmission[meta$Species=="Porites_compressa"]<-"vertical"
  meta$transmission[meta$Species=="Pavona_varians"]<-"horizontal"
  meta$transmission[meta$Species=="Pocillopora_acuta"]<-"vertical"


  meta$skeleton[meta$Species=="Montipora_capitata"]<-"porous"
  meta$skeleton[meta$Species=="Porites_compressa"]<-"porous"
  meta$skeleton[meta$Species=="Pavona_varians"]<-"self-shading"
  meta$skeleton[meta$Species=="Pocillopora_acuta"]<-"non-porous"

  meta$shape[meta$Species=="Montipora_capitata"]<-"branch"
  meta$shape[meta$Species=="Porites_compressa"]<-"branch"
  meta$shape[meta$Species=="Pavona_varians"]<-"encrust"
  meta$shape[meta$Species=="Pocillopora_acuta"]<-"small"




#write.csv(meta,"meta16s.csv")
#Ashfreedryweight, Wax dipping, Total airbrush volume, metadata

#respiration check

# RespCheck  <- read.csv("Data/RespCheck.csv")
# RespCheckC<-cast(RespCheck, Frag.ID~Time.Point)
# 
# metaResp<-meta
# metaResp<-metaResp[,c("Frag.ID","Time.Point")] # keep only columns you need
# Respcheck3<-merge(metaResp, RespCheckC)
# #write.csv(Respcheck3,"Respcheck3.csv")


AFDW <- read.csv("Data/ACE21_AFDW_20210308.csv")
#AFDW <- AFDW[!(AFDW$Frag.ID == "1195"),]
#AFDW <- AFDW[!(AFDW$Frag.ID == "N49"),]
#AFDW <- AFDW[!(AFDW$Frag.ID == "3149"),]
AFDWtest<-merge(meta, AFDW, all = T)
#write.csv(AFDWtest,"AFDWtest.csv")

WaxDipping <- read.csv("Data/WaxDipping_Results_20190403.csv")
#WaxDipping <- WaxDipping[!(WaxDipping$Frag.ID == "1195"),]
#WaxDipping <- WaxDipping[!(WaxDipping$Frag.ID == "N49"),]
#WaxDipping <- WaxDipping[!(WaxDipping$Frag.ID == "3149"),]
#WaxDipping <- WaxDipping[!(WaxDipping$Frag.ID == "634"),]

Slurry <- read.csv("Data/TT17_airbrush_totalVol_20190420.csv")
#Slurry <- Slurry[!(Slurry$Frag.ID == "1195"),]
#Slurry <- Slurry[!(Slurry$Frag.ID == "N49"),]
#Slurry <- Slurry[!(Slurry$Frag.ID == "3149"),]
#Slurry <- Slurry[!(WaxDipping$Frag.ID == "634"),]
Slurrytest<-merge(meta, Slurry, all.x = T)

#merge 
testAFDW<-merge(AFDW, meta, all=T)
ohhh#testSlurry<-merge(Slurry, meta, all.y=T)
#testflow<-merge(tData, meta, all.y=T)
#SurfaceArea<-merge(SA, meta, all.y=T)
#write.csv(SurfaceArea, "SurfaceAreaACE21.csv")



```


#Biomass (AFDW and SA)
```{r}     
   
SA<-WaxDipping 
SA<- SA[,c("Frag.ID","Surface.area")] # keep only columns you need
#WaxDippingtest<-merge(meta, SA, all.x = T)

# merge AFDW and slurry
AFDW.slurry <- merge(AFDW, Slurry)
AFDW.slurry$AFDW.mg.ml <- AFDW.slurry$AFDW.g.mL*1000  # grams to mg
AFDW.slurry$AFDWmg <-AFDW.slurry$AFDW.mg.ml*AFDW.slurry$TotalVolume # now we have mg of AFDW


DUP2<-duplicated(AFDW.slurry$Frag.ID) #look for duplicate entries

# SA cm2 and AFDW g/mL --> mg/cm2

# merge
biomass <- merge(AFDW.slurry, SA)
biomass$Surface.area<-as.numeric(as.character(biomass$Surface.area))
biomass<- biomass[,c("Frag.ID", "AFDWmg", "Surface.area")] # keep only columns you need
biomass$AFDWmg.cm2 <-biomass$AFDWmg/biomass$Surface.area # mg/cm2
 
# merge with metadata to plot by treatments
biomass2 <- merge(biomass, meta)
#write.csv(biomass2, "biomass2.csv")

# 
biomass2_mean <- ddply(biomass2, c("Treatment", "Species", "Time.Point"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass2_mean #display table

biomass2_meanClade <- ddply(biomass2, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass2_meanClade



#Mcap_biomass_mean <-Mcap_biomass_mean[-3,] # Remove T0
#biomass2_mean

# Make "BOTH" into Ambeint and High...THIS IS UGLY CODE BUT IT WORKS
# Mcap 
#Mcap_biomass_mean<-subset(biomass2_mean, Species=="Montipora_capitata") #Subset Mcap

#Mcap_biomass_mean_Both<-Mcap_biomass_mean #copy df
#row.names.remove <- c("1","2","13","14") #remove high and amb by row numbers
#Mcap_biomass_mean_Both<-Mcap_biomass_mean_Both[!(row.names(Mcap_biomass_mean_Both) %in% row.names.remove), ] #remove

#Mcap_biomass_mean_Both2<-Mcap_biomass_mean_Both # make a copy of the BOTH df
#Mcap_biomass_mean_Both[Mcap_biomass_mean_Both=="Both"]<-"Ambient"  #rename "Both" to "Ambient"
#Mcap_biomass_mean_Both2[Mcap_biomass_mean_Both2=="Both"]<-"High"  #rename "Both" to "High"

#row.names.remove <- c("9") #remove "high and amb by row numbers "both""
#Mcap_biomass_mean<-Mcap_biomass_mean[!(row.names(Mcap_biomass_mean) %in% row.names.remove), ]
#Mcap_biomass_mean<-rbind(Mcap_biomass_mean,Mcap_biomass_mean_Both,Mcap_biomass_mean_Both2) #bind together

#Mcap 
Mcap_biomass_mean<-subset(biomass2_mean, Species=="Montipora_capitata") #Subset Mcap
Mcap_biomass_meanClade<-subset(biomass2_meanClade, Species=="Montipora_capitata") #Subset Mcap

# Pcomp 
Pcomp_biomass_mean<-subset(biomass2_mean, Species=="Porites_compressa") #Subset Pcomp
Pcomp_biomass_meanClade<-subset(biomass2_meanClade, Species=="Porites_compressa") #Subset Mcap

# Pacu 
Pacu_biomass_mean<-subset(biomass2_mean, Species=="Pocillopora_acuta") #Subset Pacu
Pacu_biomass_meanClade<-subset(biomass2_meanClade, Species=="Pocillopora_acuta") #Subset Mcap

# Pvar 
Pvar_biomass_mean<-subset(biomass2_mean, Species=="Pavona_varians") #Subset Pvar
Pvar_biomass_meanClade<-subset(biomass2_meanClade, Species=="Pavona_varians") #Subset Mcap


```
Stats - T0 is n=6, not n=12. T1 and TF
```{r}      
Biomass_stats<-biomass2

biomass_stats_T1TF<-biomass2
biomass_stats_T1TF<-subset(biomass_stats_T1TF, Time.Point=="T1"|Time.Point=="TF")

#t0
biomass_stats_T0<-biomass2
biomass_stats_T0<-subset(biomass_stats_T0, Time.Point=="T0")
hist(biomass_stats_T0$AFDWmg.cm2) 
#t0 only
Biomass_T0_model<-lmer(AFDWmg.cm2~Treatment*Species+(1|Tank.num), biomass_stats_T0)
anova(Biomass_T0_model)  #species differ
qqPlot(residuals(Biomass_T0_model)) 
emm<-emmeans(Biomass_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)

Biomass_T0_model<-lmer(AFDWmg.cm2~Species*Clade+(1|Tank.num), biomass_stats_T0)
anova(Biomass_T0_model)  #species differ
qqPlot(residuals(Biomass_T0_model)) 
emm<-emmeans(Biomass_T0_model,  ~ Species*Clade, adjust="Tukey")
cld(emm)
pairs(emm)


#t0 only by speices?
biomass_stats_T0.mcap<-subset(biomass_stats_T0, Species=="Montipora_capitata")
biomass_stats_T0.pcomp<-subset(biomass_stats_T0, Species=="Porites_compressa")
biomass_stats_T0.pvar<-subset(biomass_stats_T0, Species=="Pavona_varians")
biomass_stats_T0.pacu<-subset(biomass_stats_T0, Species=="Pocillopora_acuta")

#mcap
Biomass_T0_model<-lmer(AFDWmg.cm2~Clade+(1|Tank.num), biomass_stats_T0.mcap)
anova(Biomass_T0_model)  #species differ
qqPlot(residuals(Biomass_T0_model)) 
emm<-emmeans(Biomass_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)



#pcomp
Biomass_T0_model<-lmer(AFDWmg.cm2~Clade+(1|Tank.num), biomass_stats_T0.pcomp)
anova(Biomass_T0_model)  #species differ
qqPlot(residuals(Biomass_T0_model)) 
emm<-emmeans(Biomass_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
Biomass_T0_model<-lmer(AFDWmg.cm2~Clade+(1|Tank.num), biomass_stats_T0.pvar)
anova(Biomass_T0_model)  #species differ
qqPlot(residuals(Biomass_T0_model)) 
emm<-emmeans(Biomass_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
Biomass_T0_model<-lmer(AFDWmg.cm2~Clade+(1|Tank.num), biomass_stats_T0.pacu)
anova(Biomass_T0_model)  #species differ
qqPlot(residuals(Biomass_T0_model)) 
emm<-emmeans(Biomass_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)







hist(biomass_stats_T1TF$AFDWmg.cm2) 
# biomass_stats_T1TF$AFDWmg.cm2_log<-log10(biomass_stats_T1TF$AFDWmg.cm2)
# hist(biomass_stats_T1TF$AFDWmg.cm2_log) 

#T1TF

Biomass_model<-lmer(AFDWmg.cm2~Time.Point*Treatment*Species*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF)
anova(Biomass_model) 
qqPlot(residuals(Biomass_model)) 

  emm<-emmeans(Biomass_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)

# by Species df: biomass_stats_T1TF_Mcap, biomass_stats_T1TF_Pcomp, biomass_stats_T1TF_Pvar, biomass_stats_T1TF_Pacu
biomass_stats_T1TF_Mcap<-subset(biomass_stats_T1TF, Species=="Montipora_capitata")
  biomass_stats_T1TF_Mcap.C<-subset(biomass_stats_T1TF_Mcap, Clade=="C")
  biomass_stats_T1TF_Mcap.CD<-subset(biomass_stats_T1TF_Mcap, Clade=="CD")
biomass_stats_T1TF_Pcomp<-subset(biomass_stats_T1TF, Species=="Porites_compressa")
  biomass_stats_T1TF_Pcomp.C15cj<-subset(biomass_stats_T1TF_Pcomp, Clade=="C15cj")
  biomass_stats_T1TF_Pcomp.C15n<-subset(biomass_stats_T1TF_Pcomp, Clade=="C15n")
biomass_stats_T1TF_Pvar<-subset(biomass_stats_T1TF, Species=="Pavona_varians")
  biomass_stats_T1TF_Pvar.C1<-subset(biomass_stats_T1TF_Pvar, Clade=="C1")
  biomass_stats_T1TF_Pvar.C27<-subset(biomass_stats_T1TF_Pvar, Clade=="C27")
biomass_stats_T1TF_Pacu<-subset(biomass_stats_T1TF, Species=="Pocillopora_acuta")
  biomass_stats_T1TF_Pacu.CCC<-subset(biomass_stats_T1TF_Pacu, Clade=="CCC")
  biomass_stats_T1TF_Pacu.C42<-subset(biomass_stats_T1TF_Pacu, Clade=="C42")
  
#mcap ####
#lmer
  
Biomass_Mcap_model<-lmer(AFDWmg.cm2~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Mcap)
  anova(Biomass_Mcap_model) 
  qqPlot(residuals(Biomass_Mcap_model)) 
  emm<-emmeans(Biomass_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  Biomass_Mcap_model<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Mcap)
  anova(Biomass_Mcap_model) 
  qqPlot(residuals(Biomass_Mcap_model)) 
  emm<-emmeans(Biomass_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

#T1 only
  biomass_stats_Mcap.T1<-subset(biomass_stats_T1TF_Mcap, Time.Point=="T1")
   Biomass_Mcap_model.T1<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Mcap.T1)
  anova(Biomass_Mcap_model.T1) 
    Biomass_Mcap_model.T1<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Mcap.T1)
  anova(Biomass_Mcap_model.T1) 
  qqPlot(residuals(Biomass_Mcap_model.T1)) 
  emm<-emmeans(Biomass_Mcap_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    biomass_stats_Mcap.TF<-subset(biomass_stats_T1TF_Mcap, Time.Point=="TF")
 Biomass_Mcap_model.TF<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Mcap.TF)
  anova(Biomass_Mcap_model.TF) 
  Biomass_Mcap_model.TF<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Mcap.TF)
  anova(Biomass_Mcap_model.TF) 
  qqPlot(residuals(Biomass_Mcap_model.TF)) 
  emm<-emmeans(Biomass_Mcap_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
#mcap-C only
  Biomass_Mcap_model.C<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Mcap.C)
  anova(Biomass_Mcap_model.C) 
  qqPlot(residuals(Biomass_Mcap_model.C)) 
    emm<-emmeans(Biomass_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  Biomass_Mcap_model.CD<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Mcap.CD)
  anova(Biomass_Mcap_model.CD) 
  qqPlot(residuals(Biomass_Mcap_model.CD)) 
    emm<-emmeans(Biomass_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)*
    pairs(emm)
    
#Pcomp ####
#lmer
Biomass_Pcomp_model<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pcomp)
  anova(Biomass_Pcomp_model) 
  qqPlot(residuals(Biomass_Pcomp_model)) 
  emm<-emmeans(Biomass_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Biomass_Pcomp_model.Clade<-lmer(AFDWmg.cm2~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pcomp)
  anova(Biomass_Pcomp_model.Clade) 
  qqPlot(residuals(Biomass_Pcomp_model.Clade)) 
  emm<-emmeans(Biomass_Pcomp_model.Clade,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#T1 only
  biomass_stats_Pcomp.T1<-subset(biomass_stats_T1TF_Pcomp, Time.Point=="T1")
  Biomass_Pcomp_model.T1<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pcomp.T1)
  anova(Biomass_Pcomp_model.T1) 
    Biomass_Pcomp_model.T1<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pcomp.T1)
  anova(Biomass_Pcomp_model.T1) 
  qqPlot(residuals(Biomass_Pcomp_model.T1)) 
  emm<-emmeans(Biomass_Pcomp_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    biomass_stats_Pcomp.TF<-subset(biomass_stats_T1TF_Pcomp, Time.Point=="TF")
Biomass_Pcomp_model.TF<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pcomp.TF)
  anova(Biomass_Pcomp_model.TF) 
  Biomass_Pcomp_model.TF<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pcomp.TF)
  anova(Biomass_Pcomp_model.TF) 
  qqPlot(residuals(Biomass_Pcomp_model.TF)) 
  emm<-emmeans(Biomass_Pcomp_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)    
    
    
    
    
    
 ## pcompphylotype ####   
#Pcomp-C15cj only
  Biomass_Pcomp_model.C15cj<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pcomp.C15cj)
  anova(Biomass_Pcomp_model.C15cj) 
  qqPlot(residuals(Biomass_Pcomp_model.C15cj)) 
    emm<-emmeans(Biomass_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C27 only
  Biomass_Pcomp_model.C15n<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pcomp.C15n)
  anova(Biomass_Pcomp_model.C15n) 
  qqPlot(residuals(Biomass_Pcomp_model.C15n)) 
    emm<-emmeans(Biomass_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pvar  ####
#lmer
Biomass_Pvar_model<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pvar)
  anova(Biomass_Pvar_model) 
  qqPlot(residuals(Biomass_Pvar_model)) 
  emm<-emmeans(Biomass_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

#T1 only
  biomass_stats_Pvar.T1<-subset(biomass_stats_T1TF_Pvar, Time.Point=="T1")
   Biomass_Pvar_model.T1<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pvar.T1)
  anova(Biomass_Pvar_model.T1) 
  
    Biomass_Pvar_model.T1<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pvar.T1)
  anova(Biomass_Pvar_model.T1) 
  qqPlot(residuals(Biomass_Pvar_model.T1)) 
  emm<-emmeans(Biomass_Pvar_model.T1,  ~ Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    biomass_stats_Pvar.TF<-subset(biomass_stats_T1TF_Pvar, Time.Point=="TF")
    
Biomass_Pvar_model.TF<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pvar.TF)
  anova(Biomass_Pvar_model.TF) 
  Biomass_Pvar_model.TF<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pvar.TF)
  anova(Biomass_Pvar_model.TF) 
  qqPlot(residuals(Biomass_Pvar_model.TF)) 
  
  emm<-emmeans(Biomass_Pvar_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  emm<-emmeans(Biomass_Pvar_model.TF,  ~ Clade*Treatment, adjust="Tukey")

  
    
#Pvar-C only ####
  Biomass_Pvar_model.C1<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pvar.C1)
  anova(Biomass_Pvar_model.C1) 
  qqPlot(residuals(Biomass_Pvar_model.C1)) 
    emm<-emmeans(Biomass_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  Biomass_Pvar_model.C27<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pvar.C27)
  anova(Biomass_Pvar_model.C27) 
  qqPlot(residuals(Biomass_Pvar_model.C27)) 
    emm<-emmeans(Biomass_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#Pacu ####
#lmer
    Biomass_Pacu_model<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pacu)
  anova(Biomass_Pacu_model)
Biomass_Pacu_model<-lmer(AFDWmg.cm2~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pacu)
  anova(Biomass_Pacu_model) 
  qqPlot(residuals(Biomass_Pacu_model)) 
  emm<-emmeans(Biomass_Pacu_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

  
#T1 only
  biomass_stats_Pacu.T1<-subset(biomass_stats_T1TF_Pacu, Time.Point=="T1")
  Biomass_Pacu_model.T1<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pacu.T1)
  anova(Biomass_Pacu_model.T1) 
    Biomass_Pacu_model.T1<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pacu.T1)
  anova(Biomass_Pacu_model.T1) 
  qqPlot(residuals(Biomass_Pacu_model.T1)) 
  emm<-emmeans(Biomass_Pacu_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    biomass_stats_Pacu.TF<-subset(biomass_stats_T1TF_Pacu, Time.Point=="TF")
Biomass_Pacu_model.TF<-lmer(AFDWmg.cm2~Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pacu.TF)
  anova(Biomass_Pacu_model.TF) 
  Biomass_Pacu_model.TF<-lmer(AFDWmg.cm2~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), biomass_stats_Pacu.TF)
  anova(Biomass_Pacu_model.TF) 
  qqPlot(residuals(Biomass_Pacu_model.TF)) 
  emm<-emmeans(Biomass_Pacu_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
#Pacu-CCC only
  Biomass_Pacu_model.CCC<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pacu.CCC)
  anova(Biomass_Pacu_model.CCC) 
  qqPlot(residuals(Biomass_Pacu_model.CCC)) 
    emm<-emmeans(Biomass_Pacu_model.CCC,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  Biomass_Pacu_model.C42<-lmer(AFDWmg.cm2~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), biomass_stats_T1TF_Pacu.C42)
  anova(Biomass_Pacu_model.C42) 
  qqPlot(residuals(Biomass_Pacu_model.C42)) 
    emm<-emmeans(Biomass_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    





```
PLOTS
```{r}    

#t0 only#### 
biomass_T0<-subset(biomass2, Time.Point=="T0") #Subset Pvar
biomass_T0_mean <- ddply(biomass_T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass_T0_mean


#### all species#
#plot all
All_biomass_plot<-ggplot(data=biomass_T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));All_biomass_plot

#by clade T0
biomass_T0_mean.clade <- ddply(biomass_T0, c( "Species","Clade"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass_T0_mean.clade

biomass_T0_mean.clade$Code<-paste(biomass_T0_mean.clade$Species, biomass_T0_mean.clade$Clade)

#plot all
biomass_T0_mean_plot.c<-ggplot(data=biomass_T0_mean.clade, aes(x=Species, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Code), size=4, show.legend = T)+
  geom_line(aes(color=Code), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("AFDWmg.cm2"))) +
  ggtitle("Time 0 biomass")+
  theme(plot.title = element_text(size=20, face = "italic"));biomass_T0_mean_plot.c







#TFH only#### 
biomass_TFH<-subset(biomass2, Time.Point=="TF"&Treatment=="High") #Subset Pvar
biomass_TFH_mean <- ddply(biomass_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass_TFH_mean


#means
biomass_means <- ddply(biomass2, c( "Species","Treatment","Time.Point"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass_means



#all at t1
biomass_mean.T1<-subset(biomass_means, Time.Point=="T1")
# Notched box plot
T1.Biomass.plot<-ggplot(biomass_mean.T1, aes(x=Species, y=mean, color=Treatment)) + 
  scale_color_manual(values=c("blue", "red"))+
     # coord_cartesian(ylim = c(0, 10))+
   theme_classic()+
 theme(legend.position="none") +# Remove legend
  geom_boxplot(notch=TRUE);T1.Biomass.plot

#### all species#
#plot all
All_biomass_plot<-ggplot(data=biomass_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));All_biomass_plot





#plot Mcap #### 
Mcap_biomass_plot<-ggplot(data=Mcap_biomass_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Treatment), size=4, show.legend = F)+
  geom_line(aes(color=Treatment), linetype=2, show.legend = F)+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic"));Mcap_biomass_plot




# Pcomp  ####

Pcomp_biomass_plot<-ggplot(data=Pcomp_biomass_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Treatment), size=4, show.legend = F)+
  geom_line(aes(color=Treatment), linetype=2, show.legend = F)+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  ylab("") + #Label the X Axis
  ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic"));Pcomp_biomass_plot

Pcomp_biomass2<-subset(biomass2, Species=="Porites_compressa")
biomass2_Pcompmean <- ddply(Pcomp_biomass2, c("Treatment", "Clade", "Time.Point"), summarise, #summarize cell counts
                 N    = length(AFDWmg.cm2[!is.na(AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
biomass2_Pcompmean #display table
biomass2_PcompmeanTF<-subset(biomass2_Pcompmean, Time.Point=="TF")
biomass2_PcompmeanTF$Code<-paste(biomass2_PcompmeanTF$Clade,biomass2_PcompmeanTF$Treatment)

Pcomp_biomass_plot_Clade<-ggplot(data=biomass2_PcompmeanTF, aes(x=Clade, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Code), size=4, show.legend = T)+
  geom_line(aes(color=Code), linetype=2, show.legend = T)+
  scale_color_manual(values=c("dodgerblue3", "darkred","blue","red"))+
  xlab("") + #Label the X Axis
  ylab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  ggtitle("P compressa TF clade")+
  theme(plot.title = element_text(size=20, face = "italic"));Pcomp_biomass_plot_Clade


# Pvar  ####

Pvar_biomass_mean_plot<-ggplot(data=Pvar_biomass_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Treatment), size=4, show.legend = F)+
  geom_line(aes(color=Treatment), linetype=2, show.legend = F)+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic"));Pvar_biomass_mean_plot

# Pacu ####

Pacu_biomass_mean_plot<-ggplot(data=Pacu_biomass_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Treatment), size=4, show.legend = F)+
  geom_line(aes(color=Treatment), linetype=2, show.legend = F)+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  ylab("") + #Label the Y Axis
  ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        plot.background =element_blank(), #Set the plot background
        text = element_text(size=18),  # set element text
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("Tissue biomass mg cm"^"-2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20,face = "italic"));Pacu_biomass_mean_plot


###### All plots together
Mcap_biomass_plot_plot<-Mcap_biomass_plot+ theme(legend.position = "none") #remove legend
Pcomp_biomass_plot<-Pcomp_biomass_plot+ theme(legend.position = "none") #remove legend
Pvar_biomass_mean_plot<-Pvar_biomass_mean_plot+ theme(legend.position = "none") #remove legend
Pacu_biomass_mean_plot<-Pacu_biomass_mean_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_biomass_plot, Pcomp_biomass_plot, Pvar_biomass_mean_plot,Pacu_biomass_mean_plot, nrow = 1)
 
```

# Flow cytometry  cell counts
```{r}     
#import data
Std.curve <- read.csv("Data/standard_curve_fcm20181312.csv")

###notes: 2289 isn't anywhere. 

PlateA <- read.csv("Data/Symbio.Counts.Dec.14.2018.PlateA.csv")
PlateA <- subset(PlateA, Gate.Name == "Symbiodinium")       # keep only Symbiodinium rows
keepA <- c("Sample.Name", "Concentration") # keep only Sample.name and concentration
PlateA <- PlateA[keepA]
A_meta <- read.csv("Data/TT17_FC_PlateA.csv") # load Plate A location data
PlateA <- merge(PlateA, A_meta)   # merge with location data
PlateA <-merge(PlateA, meta, all.x = TRUE) # merge with Sample metadata
PlateA <- na.omit(PlateA) # omit NAs
PlateA<- PlateA[!(PlateA$Frag.ID == "1133"),] # redid in plate E
PlateA<- PlateA[!(PlateA$Frag.ID == "N172"),] # redid in plate E


PlateB <- read.csv("Data/Symbio.Counts.Dec.14.2018.PlateB1.csv")
PlateB$Concentration<-as.numeric(as.character(PlateB$Concentration)) # this is loading in as a factor, not sure why
PlateB <- subset(PlateB, Gate.Name == "Symbiodinium")
keepB <- c("Sample.Name", "Concentration")
PlateB <- PlateB[keepB]
B_meta <- read.csv("Data/TT17_FC_PlateB.csv") # lood Plate B location data
PlateB <- merge(PlateB, B_meta)
PlateB <-merge(PlateB, meta, all.x = TRUE)
PlateB <- na.omit(PlateB)
PlateB<- PlateB[!(PlateB$Frag.ID == "428"),] # redid in plate E

PlateC <- read.csv("Data/Symbio.Counts.Dec.14.2018.PlateCredo.csv")
PlateC$Concentration<-as.numeric(as.character(PlateC$Concentration)) # this is loading in as a factor, not sure why
PlateC <- subset(PlateC, Gate.Name == "Symbiodinium")
keepC <- c("Sample.Name", "Concentration")
PlateC <- PlateC[keepC]
C_meta <- read.csv("Data/TT17_FC_PlateCredo.csv") # lood Plate C location data
PlateC <- merge(PlateC, C_meta)
PlateC <-merge(PlateC, meta, all.x = TRUE)
PlateC <- na.omit(PlateC)
PlateC<- PlateC[!(PlateC$Frag.ID == "3481"),] # redid in plate E
PlateC<- PlateC[!(PlateC$Frag.ID == "49"),] # redid in plate E
PlateC<- PlateC[!(PlateC$Frag.ID == "N49"),] # redid in plate E

#note: Frag.ID 403 Pacu seems abnormally high

PlateE <- read.csv("Data/Symbio.Count.apr.02.2019.PlateE.csv")
PlateE$Concentration<-as.numeric(as.character(PlateE$Concentration)) # this is loading in as a factor, not sure why
PlateE <- subset(PlateE, Gate.Name == "Symbiodinium")
keepE <- c("Sample.Name", "Concentration")
PlateE <- PlateE[keepE]
E_meta <- read.csv("Data/TT17_FC_PlateE.csv") # lood Plate A location data
PlateE <- merge(PlateE, E_meta)
PlateE <-merge(PlateE, meta, all.x = TRUE)
PlateE <- na.omit(PlateE)

# Bind all runs together
tData <- rbind(PlateA, PlateB, PlateC, PlateE)
tData$Parent.ID<- as.factor(tData$Parent.ID) #for some reason, "Concentration" was a chr not numeric. Check by calling str()

# Create column to relate to standard curve
tData$corrected <- tData$Concentration*3.2959 # <- also confirm you did this correctly. 

# Use Slurry
#merge with tdata
tData <- merge(tData, Slurry)
tData$TotalVolume <- tData$TotalVolume * 1000 # change total volume to from mL to uL

#write.csv(tData,"FLOW.csv")
#use SA for slurry

#merge with tData, make numeric
tData <- merge(tData, SA)
tData$Surface.area<- as.numeric(as.character(tData$Surface.area))
duplicated(tData$Frag.ID) #check 428 Pacu TF, N172mcap T1,1133 mcap t1

#add biomass to try standardizing by biomass 
Biomass4FC<-subset(biomass, select=c("Frag.ID","AFDWmg.cm2"))
tData <- merge(tData, Biomass4FC)




#write.csv(tData, "tdataCHECK.csv")
#Subset by Species and correct for 10% dilutions in Mcap and Pcomp
Mcap_FC <- subset(tData, Species == "Montipora_capitata")
Mcap_FC$corrected <- Mcap_FC$corrected*10 # to compensate for the 10% dultion

Pcomp_FC <- subset(tData, Species == "Porites_compressa")
Pcomp_FC$corrected <- Pcomp_FC$corrected*10 # to compensate for the 10% dultion

Pvar_FC <- subset(tData, Species == "Pavona_varians") #not diluted
Pacu_FC <- subset(tData, Species == "Pocillopora_acuta") #not diluted

# Create new column for total cells in total slurry
Mcap_FC$Tot.zoox <- Mcap_FC$corrected*(Mcap_FC$TotalVolume)
Pcomp_FC$Tot.zoox <- Pcomp_FC$corrected*(Pcomp_FC$TotalVolume)
Pvar_FC$Tot.zoox <- Pvar_FC$corrected*(Pvar_FC$TotalVolume)
Pacu_FC$Tot.zoox <- Pacu_FC$corrected*(Pacu_FC$TotalVolume)

# Calculate zoox/cm2
Mcap_FC$zoox.cm2<-Mcap_FC$Tot.zoox/Mcap_FC$Surface.area
Pcomp_FC$zoox.cm2<-Pcomp_FC$Tot.zoox/Pcomp_FC$Surface.area
Pvar_FC$zoox.cm2<-Pvar_FC$Tot.zoox/Pvar_FC$Surface.area
Pacu_FC$zoox.cm2<-Pacu_FC$Tot.zoox/Pacu_FC$Surface.area

# Calculate zoox/biomass
Mcap_FC$zoox.AFDWmg.cm2<-Mcap_FC$Tot.zoox/Mcap_FC$AFDWmg.cm2
Pcomp_FC$zoox.AFDWmg.cm2<-Pcomp_FC$Tot.zoox/Pcomp_FC$AFDWmg.cm2
Pvar_FC$zoox.AFDWmg.cm2<-Pvar_FC$Tot.zoox/Pvar_FC$AFDWmg.cm2
Pacu_FC$zoox.AFDWmg.cm2<-Pacu_FC$Tot.zoox/Pacu_FC$AFDWmg.cm2

FC_Data <- rbind(Mcap_FC, Pcomp_FC, Pvar_FC, Pacu_FC) #combine


#mean by biomas

#mean tables
#
FC.biomass_Sum <- ddply(FC_Data, c("Species","Treatment", "Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.AFDWmg.cm2[!is.na(zoox.AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC.biomass_Sum #display table


FC_SumClade <- ddply(FC_Data, c("Treatment", "Clade", "Species","Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_SumClade #display table

FC_SumClade.mcap<-subset(FC_SumClade, Species=="Montipora_capitata")
FC_SumClade.pcomp<-subset(FC_SumClade, Species=="Porites_compressa")
FC_SumClade.pvar<-subset(FC_SumClade, Species=="Pavona_varians")
FC_SumClade.pacu<-subset(FC_SumClade, Species=="Pocillopora_acuta")


FC_SumCladenoTemp <- ddply(FC_Data, c( "Clade", "Species","Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_SumCladenoTemp #display table

FC_SumCladeSp.bio <- ddply(FC_Data, c( "Species","Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.AFDWmg.cm2[!is.na(zoox.AFDWmg.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.AFDWmg.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.AFDWmg.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.AFDWmg.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_SumCladeSp.bio #display table


#mean tables
# Mcap
Mcap_FC_Sum <- ddply(Mcap_FC, c("Treatment", "Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Mcap_FC_Sum #display table

# Pcomp
Pcomp_FC_Sum <- ddply(Pcomp_FC, c("Treatment", "Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Pcomp_FC_Sum #display table

Pcomp_FC_SumClade <- ddply(Pcomp_FC, c("Treatment", "Clade", "Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Pcomp_FC_SumClade #display table


# Pvar
Pvar_FC_Sum <- ddply(Pvar_FC, c("Treatment", "Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Pvar_FC_Sum #display table

Pvar_FC_SumClade <- ddply(Pvar_FC, c("Treatment", "Time.Point","Clade"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Pvar_FC_SumClade #display table

# Pacu
Pacu_FC_Sum <- ddply(Pacu_FC, c("Treatment", "Time.Point"), summarise, #summarize cell counts
                   N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
Pacu_FC_Sum #display table

```
Stats
```{r}    
 FC.biomass_SumT0<-subset(FC.biomass_Sum, Time.Point=="T0")

#T0 only
hist(FC_stats_T0$zoox.cm2) 
FC_stats_T0<-subset(FC_Data, Time.Point=="T0")
FC_stats_T0$zoox.cm2_log<-log10(FC_stats_T0$zoox.cm2+1)
hist(FC_stats_T0$zoox.cm2_log) #normal (use)

#t0 only
FC_T0_model<-lmer(zoox.cm2_log~Treatment*Species+(1|Tank.num), FC_stats_T0)
anova(FC_T0_model)  #species differ
qqPlot(residuals(FC_T0_model)) 
emm<-emmeans(FC_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)


#t0 only by speices?
FC_stats_T0.mcap<-subset(FC_stats_T0, Species=="Montipora_capitata")
FC_stats_T0.pcomp<-subset(FC_stats_T0, Species=="Porites_compressa")
FC_stats_T0.pvar<-subset(FC_stats_T0, Species=="Pavona_varians")
FC_stats_T0.pacu<-subset(FC_stats_T0, Species=="Pocillopora_acuta")

#mcap
FC_T0_model<-lmer(zoox.cm2_log~Clade+(1|Tank.num), FC_stats_T0.mcap)
anova(FC_T0_model)  #species differ
qqPlot(residuals(FC_T0_model)) 
emm<-emmeans(FC_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
FC_T0_model<-lmer(zoox.cm2_log~Clade+(1|Tank.num), FC_stats_T0.pcomp)
anova(FC_T0_model)  #species differ
qqPlot(residuals(FC_T0_model)) 
emm<-emmeans(FC_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
FC_T0_model<-lmer(zoox.cm2_log~Clade+(1|Tank.num), FC_stats_T0.pvar)
anova(FC_T0_model)  #species differ
qqPlot(residuals(FC_T0_model)) 
emm<-emmeans(FC_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
FC_T0_model<-lmer(zoox.cm2_log~Clade+(1|Tank.num), FC_stats_T0.pacu)
anova(FC_T0_model)  #species differ
qqPlot(residuals(FC_T0_model)) 
emm<-emmeans(FC_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)












# models T1Tf####

hist(FC_Data$zoox.cm2) 
FC_Data$zoox.cm2_log<-log10(FC_Data$zoox.cm2+1)
hist(FC_Data$zoox.cm2_log) #normal (use)



FC_stats_T1TF<-subset(FC_Data, Time.Point=="T1"|Time.Point=="TF")


#test adding traits
FC_stats_T1TF$tissue[FC_stats_T1TF$Species == "Montipora_capitata"] <- "thick"  
FC_stats_T1TF$tissue[FC_stats_T1TF$Species == "Porites_compressa"] <- "thick"  
FC_stats_T1TF$tissue[FC_stats_T1TF$Species == "Pavona_varians"] <- "thin"  
FC_stats_T1TF$tissue[FC_stats_T1TF$Species == "Pocillopora_acuta"] <- "thin"  
FC_stats_T1TF$tissue<-as.factor(FC_stats_T1TF$tissue)
FC_stats_T1TF$skeleton[FC_stats_T1TF$Species == "Montipora_capitata"] <- "porous"  
FC_stats_T1TF$skeleton[FC_stats_T1TF$Species == "Porites_compressa"] <- "porous"  
FC_stats_T1TF$skeleton[FC_stats_T1TF$Species == "Pavona_varians"] <- "porous"  
FC_stats_T1TF$skeleton[FC_stats_T1TF$Species == "Pocillopora_acuta"] <- "nonporous"  
 FC_stats_T1TF$skeleton<-as.factor(FC_stats_T1TF$skeleton)



CellCount_model<-lmer(zoox.cm2_log~Time.Point*Treatment*Species*skeleton+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF)
anova(CellCount_model) 
qqPlot(residuals(CellCount_model)) 



## T1TF mods
CellCount_model<-lmer(zoox.cm2_log~Time.Point*Treatment*Species+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF)
anova(CellCount_model) 
qqPlot(residuals(CellCount_model)) 

  emm<-emmeans(CellCount_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)

CellCount_model<-lmer(zoox.cm2_log~Time.Point*Treatment*Species*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF)
anova(CellCount_model) 




# by Species df: FC_stats_T1TF_Mcap, FC_stats_T1TF_Pcomp, FC_stats_T1TF_Pvar, FC_stats_T1TF_Pacu
FC_stats_T1TF_Mcap<-subset(FC_stats_T1TF, Species=="Montipora_capitata")
  FC_stats_T1TF_Mcap.C<-subset(FC_stats_T1TF_Mcap, Clade=="C")
  FC_stats_T1TF_Mcap.CD<-subset(FC_stats_T1TF_Mcap, Clade=="CD")
FC_stats_T1TF_Pcomp<-subset(FC_stats_T1TF, Species=="Porites_compressa")
  FC_stats_T1TF_Pcomp.C15cj<-subset(FC_stats_T1TF_Pcomp, Clade=="C15cj")
  FC_stats_T1TF_Pcomp.C15n<-subset(FC_stats_T1TF_Pcomp, Clade=="C15n")
FC_stats_T1TF_Pvar<-subset(FC_stats_T1TF, Species=="Pavona_varians")
  FC_stats_T1TF_Pvar.C1<-subset(FC_stats_T1TF_Pvar, Clade=="C1")
  FC_stats_T1TF_Pvar.C27<-subset(FC_stats_T1TF_Pvar, Clade=="C27")
FC_stats_T1TF_Pacu<-subset(FC_stats_T1TF, Species=="Pocillopora_acuta")
  FC_stats_T1TF_Pacu.CCC<-subset(FC_stats_T1TF_Pacu, Clade=="CCC")
  FC_stats_T1TF_Pacu.C42<-subset(FC_stats_T1TF_Pacu, Clade=="C42")
  
#mcap ####
#lmer
  FC_Mcap_model<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap)
  anova(FC_Mcap_model) 
FC_Mcap_model<-lmer(zoox.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap)
  anova(FC_Mcap_model) 
  qqPlot(residuals(FC_Mcap_model)) 
  emm<-emmeans(FC_Mcap_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

#T1 only
  FC_stats_Mcap.T1<-subset(FC_stats_T1TF_Mcap, Time.Point=="T1")
      FC_Mcap_model.T1<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.T1)
  anova(FC_Mcap_model.T1) 
    FC_Mcap_model.T1<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.T1)
  anova(FC_Mcap_model.T1) 
  qqPlot(residuals(FC_Mcap_model.T1)) 
  emm<-emmeans(FC_Mcap_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Mcap.TF<-subset(FC_stats_T1TF_Mcap, Time.Point=="TF")
  FC_Mcap_model.TF<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.TF)
  anova(FC_Mcap_model.TF) 
  FC_Mcap_model.TF<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.TF)
  anova(FC_Mcap_model.TF) 
  qqPlot(residuals(FC_Mcap_model.TF)) 
  emm<-emmeans(FC_Mcap_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
  
  
#mcap-C only
  FC_Mcap_model.C<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap.C)
  anova(FC_Mcap_model.C) 
  qqPlot(residuals(FC_Mcap_model.C)) 
    emm<-emmeans(FC_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  FC_Mcap_model.CD<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap.CD)
  anova(FC_Mcap_model.CD) 
  qqPlot(residuals(FC_Mcap_model.CD)) 
    emm<-emmeans(FC_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)*
    pairs(emm)
    
#Pcomp ####
#lmer
FC_Pcomp_model<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp)
  anova(FC_Pcomp_model) 
  qqPlot(residuals(FC_Pcomp_model)) 
  emm<-emmeans(FC_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

FC_Pcomp_model.Clade<-lmer(zoox.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp)
  anova(FC_Pcomp_model.Clade) 
  qqPlot(residuals(FC_Pcomp_model.Clade)) 
  emm<-emmeans(FC_Pcomp_model.Clade,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
 #T1 only
  FC_stats_Pcomp.T1<-subset(FC_stats_T1TF_Pcomp, Time.Point=="T1")
    FC_Pcomp_model.T1<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.T1)
  anova(FC_Pcomp_model.T1) 
    FC_Pcomp_model.T1<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.T1)
  anova(FC_Pcomp_model.T1) 
  qqPlot(residuals(FC_Pcomp_model.T1)) 
  emm<-emmeans(FC_Pcomp_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  
  #TF only
    FC_stats_Pcomp.TF<-subset(FC_stats_T1TF_Pcomp, Time.Point=="TF")
FC_Pcomp_model.TF<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.TF)
  anova(FC_Pcomp_model.TF) 
  FC_Pcomp_model.TF<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.TF)
  anova(FC_Pcomp_model.TF) 
  qqPlot(residuals(FC_Pcomp_model.TF)) 
  emm<-emmeans(FC_Pcomp_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
     
    
    
#Pcomp-C15cj only
  FC_Pcomp_model.C15cj<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp.C15cj)
  anova(FC_Pcomp_model.C15cj) 
  qqPlot(residuals(FC_Pcomp_model.C15cj)) 
    emm<-emmeans(FC_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C15cj only
  FC_Pcomp_model.C15n<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp.C15n)
  anova(FC_Pcomp_model.C15n) 
  qqPlot(residuals(FC_Pcomp_model.C15n)) 
    emm<-emmeans(FC_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pvar ####
#lmer
FC_Pvar_model<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar)
  anova(FC_Pvar_model) 
  qqPlot(residuals(FC_Pvar_model)) 
  emm<-emmeans(FC_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  FC_Pvar_model<-lmer(zoox.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar)
  anova(FC_Pvar_model) 
  qqPlot(residuals(FC_Pvar_model)) 
  emm<-emmeans(FC_Pvar_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

#T1 only
  FC_stats_Pvar.T1<-subset(FC_stats_T1TF_Pvar, Time.Point=="T1")
   FC_Pvar_model.T1<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.T1)
  anova(FC_Pvar_model.T1) 
    FC_Pvar_model.T1<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.T1)
  anova(FC_Pvar_model.T1) 
  qqPlot(residuals(FC_Pvar_model.T1)) 
  emm<-emmeans(FC_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Pvar.TF<-subset(FC_stats_T1TF_Pvar, Time.Point=="TF")
  FC_Pvar_model.TF<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.TF)
  anova(FC_Pvar_model.TF) 
  FC_Pvar_model.TF<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.TF)
  anova(FC_Pvar_model.TF) 
  qqPlot(residuals(FC_Pvar_model.TF)) 
  emm<-emmeans(FC_Pvar_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#Pvar-C only
  FC_Pvar_model.C1<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar.C1)
  anova(FC_Pvar_model.C1) 
  qqPlot(residuals(FC_Pvar_model.C1)) 
    emm<-emmeans(FC_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-CD only
  FC_Pvar_model.C27<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar.C27)
  anova(FC_Pvar_model.C27) 
  qqPlot(residuals(FC_Pvar_model.C27)) 
    emm<-emmeans(FC_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#Pacu ####
#lmer 
    FC_Pacu_model<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu)
  anova(FC_Pacu_model)
  emm<-emmeans(FC_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  
FC_Pacu_model<-lmer(zoox.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu)
  anova(FC_Pacu_model) 
  qqPlot(residuals(FC_Pacu_model)) 
  emm<-emmeans(FC_Pacu_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm) 

  #T1 only
  FC_stats_Pacu.T1<-subset(FC_stats_T1TF_Pacu, Time.Point=="T1")
  FC_Pacu_model.T1<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.T1)
  anova(FC_Pacu_model.T1)
    FC_Pacu_model.T1<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.T1)
  anova(FC_Pacu_model.T1) 
  qqPlot(residuals(FC_Pacu_model.T1)) 
  emm<-emmeans(FC_Pacu_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  emm<-emmeans(FC_Pacu_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Pacu.TF<-subset(FC_stats_T1TF_Pacu, Time.Point=="TF")
FC_Pacu_model.TF<-lmer(zoox.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.TF)
  anova(FC_Pacu_model.TF) 
  FC_Pacu_model.TF<-lmer(zoox.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.TF)
  anova(FC_Pacu_model.TF) 
  qqPlot(residuals(FC_Pacu_model.TF)) 
  emm<-emmeans(FC_Pacu_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
#Pacu-CCC only
  FC_Pacu_model.CCC<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu.CCC)
  anova(FC_Pacu_model.CCC) 
  qqPlot(residuals(FC_Pacu_model.CCC)) 
    emm<-emmeans(FC_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  FC_Pacu_model.C42<-lmer(zoox.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu.C42)
  anova(FC_Pacu_model.C42) 
  qqPlot(residuals(FC_Pacu_model.C42)) 
    emm<-emmeans(FC_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    

```

Line plots 
```{r} 
#just T0 #### 
FC_T0_mean <- ddply(FC_stats_T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_T0_mean



#plot all
FC_T0_mean_plot<-ggplot(data=FC_T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Algal Cell Counts"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));FC_T0_mean_plot

#by clade T0
FC_T0_mean.clade <- ddply(FC_stats_T0, c( "Species","Clade"), summarise, #summarize cell counts
                 N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_T0_mean.clade

FC_T0_mean.clade$Code<-paste(FC_T0_mean.clade$Species, FC_T0_mean.clade$Clade)

#plot all
FC_T0_mean_plot.c<-ggplot(data=FC_T0_mean.clade, aes(x=Species, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Code), size=4, show.legend = T)+
  geom_line(aes(color=Code), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Algal Cell Counts"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));FC_T0_mean_plot.c



#TFH only####
FC_TFH<-subset(FC_Data, Time.Point=="TF"&Treatment=="High") #Subset Pvar
FC_TFH_mean <- ddply(FC_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_TFH_mean
 


#means
FC_mean <- ddply(FC_Data, c( "Species","Treatment","Time.Point"), summarise, #summarize cell counts
                 N    = length(zoox.cm2[!is.na(zoox.cm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(zoox.cm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(zoox.cm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(zoox.cm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
FC_mean


#all at t1
FC_mean.T1<-subset(FC_mean, Time.Point=="T1")
# Notched box plot
T1.Biomass.plot<-ggplot(FC_mean.T1, aes(x=Species, y=mean, color=Treatment)) + 
  scale_color_manual(values=c("blue", "red"))+
     # coord_cartesian(ylim = c(0, 10))+
   theme_classic()+
  ggtitle("Algal Cell Density T1")+
 theme(legend.position="none") +# Remove legend
  geom_boxplot(notch=TRUE);T1.Biomass.plot





#### all species#
#plot all####
All_FC_plot<-ggplot(data=FC_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Cell counts"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));All_FC_plot


# Mcap   ####

Mcap_FC_lineplot<-ggplot(data=Mcap_FC_Sum, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
       #scale_y_log10()+
   #   ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_FC_lineplot

    #by clade FC_SumClade.mcap
FC_SumClade.mcap$Code<-paste(FC_SumClade.mcap$Treatment,FC_SumClade.mcap$Clade)
 Mcap_FC_lineplot.c<-ggplot(data=FC_SumClade.mcap, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
       #scale_y_log10()+
   #   ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_FC_lineplot.c

FC_Data.mcap<-subset(FC_Data, Species=="Montipora_capitata")
FC_Data.mcap<-subset(FC_Data.mcap, Time.Point=="T1"|Time.Point=="TF")

FC_Data.mcap$Code<-paste(FC_Data.mcap$Parent.ID, FC_Data.mcap$Treatment,FC_Data.mcap$Clade)

p<-mcap_FC_lineplot<-ggplot(data=FC_Data.mcap, aes(x=Time.Point, y=zoox.cm2, group = Code, color=Treatment)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
               # width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #  ylim(0, 4000000)+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("Mcap")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));mcap_FC_lineplot

p+facet_wrap(~Clade)


# Pcomp ####
  

Pcomp_FC_lineplot<-ggplot(data=Pcomp_FC_Sum, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #  ylim(0, 4000000)+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_FC_lineplot

#pcomp clades Pcomp_FC_SumClade
Pcomp_FC_SumClade$Code<-paste(Pcomp_FC_SumClade$Treatment,Pcomp_FC_SumClade$Clade)
Pcomp_FC_lineplot.c<-ggplot(data=Pcomp_FC_SumClade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "blue","darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #  ylim(0, 4000000)+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_FC_lineplot.c


FC_Data.pcomp<-subset(FC_Data, Species=="Porites_compressa")
FC_Data.pcomp<-subset(FC_Data.pcomp, Time.Point=="T1"|Time.Point=="TF")

FC_Data.pcomp$Code<-paste(FC_Data.pcomp$Parent.ID, FC_Data.pcomp$Treatment,FC_Data.pcomp$Clade)

p<-Pcomp_FC_lineplot<-ggplot(data=FC_Data.pcomp, aes(x=Time.Point, y=zoox.cm2, group = Code, color=Treatment)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
               # width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #  ylim(0, 4000000)+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_FC_lineplot

p+facet_wrap(~Clade)


# Pvar  ###

Pvar_FC_lineplot<-ggplot(data=Pvar_FC_Sum, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     #  scale_y_log10()+
  #  ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
     theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_FC_lineplot

#by clade Pvar_FC_SumClade
Pvar_FC_SumClade$Code<-paste(Pvar_FC_SumClade$Treatment, Pvar_FC_SumClade$Clade)

Pvar_FC_lineplot.c<-ggplot(data=Pvar_FC_SumClade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     #  scale_y_log10()+
  #  ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
     theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_FC_lineplot.c

FC_Data.pvar<-subset(FC_Data, Species=="Pavona_varians")
FC_Data.pvar<-subset(FC_Data.pvar, Time.Point=="T1"|Time.Point=="TF")

FC_Data.pvar$Code<-paste(FC_Data.pvar$Parent.ID, FC_Data.pvar$Treatment,FC_Data.pvar$Clade)

p<-pvar_FC_lineplot<-ggplot(data=FC_Data.pvar, aes(x=Time.Point, y=zoox.cm2, group = Code, color=Treatment)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
               # width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #  ylim(0, 4000000)+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P var")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));pvar_FC_lineplot

p+facet_wrap(~Clade)

# Pacu  ####

Pacu_FC_lineplot<-ggplot(data=Pacu_FC_Sum, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
     theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_FC_lineplot

   #by clade FC_SumClade.pacu
FC_SumClade.pacu$Code<-paste(FC_SumClade.pacu$Treatment,FC_SumClade.pacu$Clade)
 pacu_FC_lineplot.c<-ggplot(data=FC_SumClade.pacu, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
       #scale_y_log10()+
   #   ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));pacu_FC_lineplot.c

###### All plots together
Mcap_FC_lineplot<-Mcap_FC_lineplot+ theme(legend.position = "none") #remove legend
Pcomp_FC_lineplot<-Pcomp_FC_lineplot+ theme(legend.position = "none") #remove legend
Pvar_FC_lineplot<-Pvar_FC_lineplot+ theme(legend.position = "none") #remove legend
Pacu_FC_lineplot<-Pacu_FC_lineplot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_FC_lineplot, Pcomp_FC_lineplot, Pvar_FC_lineplot,Pacu_FC_lineplot, nrow = 1)


#clade together
Pcomp_FC_lineplot.c

Mcap_FC_lineplot.c<-Mcap_FC_lineplot.c+ theme(legend.position = "none") #remove legend
Pcomp_FC_lineplot.c<-Pcomp_FC_lineplot.c+ theme(legend.position = "none") #remove legend
Pvar_FC_lineplot.c<-Pvar_FC_lineplot.c+ theme(legend.position = "none") #remove legend
pacu_FC_lineplot.c<-pacu_FC_lineplot.c+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_FC_lineplot.c, Pcomp_FC_lineplot.c, Pvar_FC_lineplot.c,pacu_FC_lineplot.c, nrow = 1)
```

LIne plots by standardizing to biomass  for Ford
FC.biomass_Sum
```{r} 
 
FC_SumCladeSpT0<-subset(FC_SumCladeSp.bioFC_SumCladeSp.bio, Time.Point=="T0")
#plot all
FC_T0_mean_plot<-ggplot(data=FC_SumCladeSpT0, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Algal Cell Counts per biomass"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));FC_T0_mean_plot






 


# Mcap   ####
FC.biomass_SumMcap<-subset(FC.biomass_Sum, Species=="Montipora_capitata")

Mcap_FC_lineplot<-ggplot(data=FC.biomass_SumMcap, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
       #scale_y_log10()+
   #   ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_FC_lineplot

# Pcomp 
FC.biomass_SumPcomp<-subset(FC.biomass_Sum, Species=="Porites_compressa")

Pcomp_FC_lineplot<-ggplot(data=FC.biomass_SumPcomp, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #  ylim(0, 4000000)+ 
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_FC_lineplot

#pcomp clades Pcomp_FC_SumClade
# 
# Pcomp_FC_SumClade$Code<-paste(Pcomp_FC_SumClade$Treatment,Pcomp_FC_SumClade$Clade)
# Pcomp_FC_lineplot<-ggplot(data=Pcomp_FC_SumClade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
#   geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
#                 width=0.1, show.legend = T)+
#   geom_point(aes(color=Code), size=4, show.legend = T)+  
#   geom_line(aes(color=Code),linetype="dotted")+
#   scale_color_manual(values=c("dodgerblue3", "blue","darkred","red"))+
#    geom_point(shape = 1,size = 4,colour = "black")+
#   xlab("Time Point") + #Label the X Axis
#       # scale_y_log10()+
#   #  ylim(0, 4000000)+ 
#   theme_bw() + #Set the background color
#   theme(axis.line = element_line(color = 'black'), #Set the axes color
#         axis.title=element_text(size=14,face="bold"), #Set axis format
#         panel.border = element_blank(), #Set the border 
#         panel.grid.major = element_blank(), #Set the major gridlines
#         panel.grid.minor = element_blank(), #Set the minor gridlines
#         text = element_text(size=18),  # set element text
#         plot.background =element_blank(), #Set the plot background
#         legend.key = element_blank()) + #Set plot legend key
#   ylab(expression(paste("cells"))) +
#    theme(panel.grid.major = element_blank(), 
#         panel.grid.minor = element_blank(),
#         panel.background = element_rect(colour = "black", size=1))+
#         theme(aspect.ratio=1)+
#   ggtitle("P compressa")+
#   theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_FC_lineplot

# Pvar 
FC.biomass_SumPvar<-subset(FC.biomass_Sum, Species=="Pavona_varians")

Pvar_FC_lineplot<-ggplot(data=FC.biomass_SumPvar, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     #  scale_y_log10()+
  #  ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
     theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_FC_lineplot

# #by clade Pvar_FC_SumClade
# Pvar_FC_SumClade$Code<-paste(Pvar_FC_SumClade$Treatment, Pvar_FC_SumClade$Clade)
# 
# Pvar_FC_lineplotClade<-ggplot(data=Pvar_FC_SumClade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
#   geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
#                 width=0.1, show.legend = T)+
#   geom_point(aes(color=Code), size=4, show.legend = T)+  
#   geom_line(aes(color=Code),linetype="dotted")+
#   scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
#    geom_point(shape = 1,size = 4,colour = "black")+
#   xlab("Time Point") + #Label the X Axis
#      #  scale_y_log10()+
#   #  ylim(0, 4000000)+
#   theme_bw() + #Set the background color
#   theme(axis.line = element_line(color = 'black'), #Set the axes color
#         axis.title=element_text(size=14,face="bold"), #Set axis format
#         panel.border = element_blank(), #Set the border 
#         panel.grid.major = element_blank(), #Set the major gridlines
#         panel.grid.minor = element_blank(), #Set the minor gridlines
#         text = element_text(size=18),  # set element text
#         plot.background =element_blank(), #Set the plot background
#         legend.key = element_blank()) + #Set plot legend key
#   ylab(expression(paste("cells"))) +
#      theme(panel.grid.major = element_blank(), 
#         panel.grid.minor = element_blank(),
#         panel.background = element_rect(colour = "black", size=1))+
#         theme(aspect.ratio=1)+
#   ggtitle("P varians")+
#   theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_FC_lineplotClade


# Pacu 
FC.biomass_SumPacu<-subset(FC.biomass_Sum, Species=="Pocillopora_acuta")

Pacu_FC_lineplot<-ggplot(data=FC.biomass_SumPacu, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      # scale_y_log10()+
  #ylim(0, 4000000)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("cells"))) +
     theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_FC_lineplot
 
###### All plots together
Mcap_FC_lineplot<-Mcap_FC_lineplot+ theme(legend.position = "none") #remove legend
Pcomp_FC_lineplot<-Pcomp_FC_lineplot+ theme(legend.position = "none") #remove legend
Pvar_FC_lineplot<-Pvar_FC_lineplot+ theme(legend.position = "none") #remove legend
Pacu_FC_lineplot<-Pacu_FC_lineplot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_FC_lineplot, Pcomp_FC_lineplot, Pvar_FC_lineplot,Pacu_FC_lineplot, nrow = 1)



  
####### STATS #####
#FC_Data
hist(FC_Data$zoox.AFDWmg.cm2)
hist(log10(FC_Data$zoox.AFDWmg.cm2+1))
FC_Data$zoox.AFDWmg.cm2_log<-log10(FC_Data$zoox.AFDWmg.cm2+1)


#T0 only
#t0 only
FC_T0_model<-lmer(zoox.AFDWmg.cm2_log~Treatment*Species+(1|Tank.num), FC_stats_T0)
anova(FC_T0_model)  #species differ
qqPlot(residuals(FC_T0_model)) 
emm<-emmeans(FC_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)



FC_stats_T1TF<-subset(FC_Data, Time.Point=="T1"|Time.Point=="TF")

CellCount_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment*Species+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF)
anova(CellCount_model) 
qqPlot(residuals(CellCount_model)) 

  emm<-emmeans(CellCount_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)

CellCount_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment*Species*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF)
anova(CellCount_model) 




# by Species df: FC_stats_T1TF_Mcap, FC_stats_T1TF_Pcomp, FC_stats_T1TF_Pvar, FC_stats_T1TF_Pacu
FC_stats_T1TF_Mcap<-subset(FC_stats_T1TF, Species=="Montipora_capitata")
  FC_stats_T1TF_Mcap.C<-subset(FC_stats_T1TF_Mcap, Clade=="C")
  FC_stats_T1TF_Mcap.CD<-subset(FC_stats_T1TF_Mcap, Clade=="CD")
FC_stats_T1TF_Pcomp<-subset(FC_stats_T1TF, Species=="Porites_compressa")
  FC_stats_T1TF_Pcomp.C15cj<-subset(FC_stats_T1TF_Pcomp, Clade=="C15cj")
  FC_stats_T1TF_Pcomp.C15n<-subset(FC_stats_T1TF_Pcomp, Clade=="C15n")
FC_stats_T1TF_Pvar<-subset(FC_stats_T1TF, Species=="Pavona_varians")
  FC_stats_T1TF_Pvar.C1<-subset(FC_stats_T1TF_Pvar, Clade=="C1")
  FC_stats_T1TF_Pvar.C27<-subset(FC_stats_T1TF_Pvar, Clade=="C27")
FC_stats_T1TF_Pacu<-subset(FC_stats_T1TF, Species=="Pocillopora_acuta")
  FC_stats_T1TF_Pacu.CCC<-subset(FC_stats_T1TF_Pacu, Clade=="CCC")
  FC_stats_T1TF_Pacu.C42<-subset(FC_stats_T1TF_Pacu, Clade=="C42")
  
#mcap ####
#lmer
  FC_Mcap_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap)
  anova(FC_Mcap_model) 
FC_Mcap_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap)
  anova(FC_Mcap_model) 
  qqPlot(residuals(FC_Mcap_model)) 
  emm<-emmeans(FC_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

#T1 only
  FC_stats_Mcap.T1<-subset(FC_stats_T1TF_Mcap, Time.Point=="T1")
      FC_Mcap_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.T1)
  anova(FC_Mcap_model.T1) 
    FC_Mcap_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.T1)
  anova(FC_Mcap_model.T1) 
  qqPlot(residuals(FC_Mcap_model.T1)) 
  emm<-emmeans(FC_Mcap_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Mcap.TF<-subset(FC_stats_T1TF_Mcap, Time.Point=="TF")
  FC_Mcap_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.TF)
  anova(FC_Mcap_model.TF) 
  FC_Mcap_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Mcap.TF)
  anova(FC_Mcap_model.TF) 
  qqPlot(residuals(FC_Mcap_model.TF)) 
  emm<-emmeans(FC_Mcap_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
  
  
#mcap-C only
  FC_Mcap_model.C<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap.C)
  anova(FC_Mcap_model.C) 
  qqPlot(residuals(FC_Mcap_model.C)) 
    emm<-emmeans(FC_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  FC_Mcap_model.CD<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Mcap.CD)
  anova(FC_Mcap_model.CD) 
  qqPlot(residuals(FC_Mcap_model.CD)) 
    emm<-emmeans(FC_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)*
    pairs(emm)
    
#Pcomp ####
#lmer
FC_Pcomp_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp)
  anova(FC_Pcomp_model) 
  qqPlot(residuals(FC_Pcomp_model)) 
  emm<-emmeans(FC_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

FC_Pcomp_model.Clade<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp)
  anova(FC_Pcomp_model.Clade) 
  qqPlot(residuals(FC_Pcomp_model.Clade)) 
  emm<-emmeans(FC_Pcomp_model.Clade,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
 #T1 only
  FC_stats_Pcomp.T1<-subset(FC_stats_T1TF_Pcomp, Time.Point=="T1")
    FC_Pcomp_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.T1)
  anova(FC_Pcomp_model.T1) 
    FC_Pcomp_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.T1)
  anova(FC_Pcomp_model.T1) 
  qqPlot(residuals(FC_Pcomp_model.T1)) 
  emm<-emmeans(FC_Pcomp_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
    emm<-emmeans(FC_Pcomp_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Pcomp.TF<-subset(FC_stats_T1TF_Pcomp, Time.Point=="TF")
FC_Pcomp_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.TF)
  anova(FC_Pcomp_model.TF) 
  FC_Pcomp_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pcomp.TF)
  anova(FC_Pcomp_model.TF) 
  qqPlot(residuals(FC_Pcomp_model.TF)) 
  emm<-emmeans(FC_Pcomp_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
      emm<-emmeans(FC_Pcomp_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
    
    
#Pcomp-C15cj only
  FC_Pcomp_model.C15cj<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp.C15cj)
  anova(FC_Pcomp_model.C15cj) 
  qqPlot(residuals(FC_Pcomp_model.C15cj)) 
    emm<-emmeans(FC_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C15cj only
  FC_Pcomp_model.C15n<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pcomp.C15n)
  anova(FC_Pcomp_model.C15n) 
  qqPlot(residuals(FC_Pcomp_model.C15n)) 
    emm<-emmeans(FC_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pvar ####
#lmer
FC_Pvar_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar)
  anova(FC_Pvar_model) 
  qqPlot(residuals(FC_Pvar_model)) 
  emm<-emmeans(FC_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  FC_Pvar_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar)
  anova(FC_Pvar_model) 
  qqPlot(residuals(FC_Pvar_model)) 
  emm<-emmeans(FC_Pvar_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

#T1 only
  FC_stats_Pvar.T1<-subset(FC_stats_T1TF_Pvar, Time.Point=="T1")
   FC_Pvar_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.T1)
  anova(FC_Pvar_model.T1) 
    FC_Pvar_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.T1)
  anova(FC_Pvar_model.T1) 
  qqPlot(residuals(FC_Pvar_model.T1)) 
  emm<-emmeans(FC_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
    emm<-emmeans(FC_Pvar_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Pvar.TF<-subset(FC_stats_T1TF_Pvar, Time.Point=="TF")
  FC_Pvar_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.TF)
  anova(FC_Pvar_model.TF) 
  FC_Pvar_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pvar.TF)
  anova(FC_Pvar_model.TF) 
  qqPlot(residuals(FC_Pvar_model.TF)) 
  emm<-emmeans(FC_Pvar_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#Pvar-C only
  FC_Pvar_model.C1<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar.C1)
  anova(FC_Pvar_model.C1) 
  qqPlot(residuals(FC_Pvar_model.C1)) 
    emm<-emmeans(FC_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-CD only
  FC_Pvar_model.C27<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pvar.C27)
  anova(FC_Pvar_model.C27) 
  qqPlot(residuals(FC_Pvar_model.C27)) 
    emm<-emmeans(FC_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#Pacu ####
#lmer
    FC_Pacu_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu)
  anova(FC_Pacu_model)
  emm<-emmeans(FC_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  
FC_Pacu_model<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu)
  anova(FC_Pacu_model) 
  qqPlot(residuals(FC_Pacu_model)) 
  emm<-emmeans(FC_Pacu_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

  #T1 only
  FC_stats_Pacu.T1<-subset(FC_stats_T1TF_Pacu, Time.Point=="T1")
  FC_Pacu_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.T1)
  anova(FC_Pacu_model.T1)
    FC_Pacu_model.T1<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.T1)
  anova(FC_Pacu_model.T1) 
  qqPlot(residuals(FC_Pacu_model.T1)) 
  emm<-emmeans(FC_Pacu_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
   emm<-emmeans(FC_Pacu_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    FC_stats_Pacu.TF<-subset(FC_stats_T1TF_Pacu, Time.Point=="TF")
FC_Pacu_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.TF)
  anova(FC_Pacu_model.TF) 
  FC_Pacu_model.TF<-lmer(zoox.AFDWmg.cm2_log~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), FC_stats_Pacu.TF)
  anova(FC_Pacu_model.TF) 
  qqPlot(residuals(FC_Pacu_model.TF)) 
  emm<-emmeans(FC_Pacu_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
#Pacu-CCC only
  FC_Pacu_model.CCC<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu.CCC)
  anova(FC_Pacu_model.CCC) 
  qqPlot(residuals(FC_Pacu_model.CCC)) 
    emm<-emmeans(FC_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  FC_Pacu_model.C42<-lmer(zoox.AFDWmg.cm2_log~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), FC_stats_T1TF_Pacu.C42)
  anova(FC_Pacu_model.C42) 
  qqPlot(residuals(FC_Pacu_model.C42)) 
    emm<-emmeans(FC_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    

```







#Buoyant Weight/Calcification

calibration (not sure what this does)
```{r}        
BWCalData <- read.csv('Data/Bouyant_weight_calibration_curve.csv')
#Data with Standard weights in grams in deionized water, saltwater, and the temp that they were measured at
 
### Standard Cruve
#plot relationship between temp and Standard in fresh and salt water
plot(BWCalData$Temp, BWCalData$StandardSalt, col = 'red', ylab = 'Salt Weight (g)', xlab = 'Temp C')
par(new=TRUE)
plot(BWCalData$Temp, BWCalData$StandardFresh, col = 'blue',xaxt="n",yaxt="n",xlab="",ylab="")
axis(4)
mtext("'Fresh Weight (g)'",side=4,line=3)
legend("topleft",col=c("red","blue"),lty=1,legend=c("Salt","Fresh"), bty = "n")

#linear regression between temp and Standard
#Salt
StandardSaltModel <- lm(BWCalData$StandardSalt~BWCalData$Temp)
summary(StandardSaltModel)
summary(StandardSaltModel)$r.squared
StandardSaltModel$coef

#Fresh
StandardFreshModel <- lm(BWCalData$StandardFresh~BWCalData$Temp)
summary(StandardFreshModel)
summary(StandardFreshModel)$r.squared
StandardFreshModel$coef

```
Analysis 
```{r}    
 
#load coral weight data
BW.data <-read.csv('Data/BWdata_Final.csv') # this is a file I compiled with all dates

## Split data by species, change to numeric
Mcap_BW<- subset(BW.data, Species =="Montipora_capitata")
Mcap_BW$Temp.C <- as.numeric(as.character(Mcap_BW$Temp.C))
BW_Mcap <- Mcap_BW$Mass.g
Temp_Mcap <- Mcap_BW$Temp.C 

Pcomp_BW<- subset(BW.data, Species =="Porites_compressa")
Pcomp_BW$Temp.C <- as.numeric(as.character(Pcomp_BW$Temp.C))
BW_Pcomp <- Pcomp_BW$Mass.g
Temp_Pcomp <- Pcomp_BW$Temp.C 

Pvar_BW<- subset(BW.data, Species =="Pavona_varians")
Pvar_BW$Temp.C <- as.numeric(as.character(Pvar_BW$Temp.C))
BW_Pvar <- Pvar_BW$Mass.g
Temp_Pvar <- Pvar_BW$Temp.C 

Pacu_BW<- subset(BW.data, Species =="Pocillopora_acuta")
BW_Pacu <- Pacu_BW$Mass.g
Temp_Pacu <- Pacu_BW$Temp.C  

 
```
Montipora capitata
```{r}  
BWCalc_Mcap <- function(StandardAir= 39.092, Temp, BW, CoralDensity = 2.03){
  #Parameters---------------------------------------------------------------
  # StandardAir is the weight of the Standard in air (Default set at 39.092 grams weighed on balance)
  # Temp is the temperature of the water during the coral measurement
  # BW is the buoywant weight of the coral
  # CoralDensity <- 2.03 #g cm-3, set aragonite density for Montipora from literature 
  #Montipora Arag = 2.03 g cm-3 average from table 2 in Anthony 2003 Functional Ecology 17:246-259
  # Porites asteroides T Hughes 1987 1.69 at 5m (KB got 1.82)
  # below: Medellin-Maldonado et al 2016
  # Pavona varians 1.04 +-0.07
  # panama 8.5380° N, 80.7821° W, 
  # coasta rica 9.7489° N, 83.7534° W
  # mexico la entrega 15.7424° N, 96.1282° W
  # hawaii 19.8968° N, 155.5828° W
  # Pocillopora 1.78 +- 0.31
  
  
  # You can change the density to literatrue values for the specific coral species of interest in the function. 
  
 #Calculation------------------------------------------------------------
  #Step 1: correct the Standard weights for temperature
  # StandardFresh is the weight of the Standard in  fresh water at temp x
  # StandardSalt is the weight of the Standard in salt water at temp x
  
  # This is based on a calibration curve for Standards weighed in fresh and salt water at many temps
StandardFresh <- StandardFreshModel$coef[-1]*Temp + StandardFreshModel$coef[1] 
StandardSalt <- StandardSaltModel$coef[-1]*Temp + StandardSaltModel$coef[1] 
  
  # Step 2: Use weight in air and freshwater of the glass Standard to calculate
  # the density of the Standard (Davies eq. 4)
FreshDensity <- 1 #Fresh water has a density of 1 g/cm3
StandardDensity <- FreshDensity/(1-(StandardFresh/StandardAir)) 
  
  # Step 3: Calculate the density of seawater using the density of the Standard
  # (Spencer Davies eq. 3)
SWDensity <- StandardDensity*(1-(StandardSalt/StandardAir))
  
  # Step 4: Calculate the dry weight of the coral (Davies eq. 1)
CoralWeight <- BW_Mcap/(1-(SWDensity/CoralDensity))
  
  return(CoralWeight) #returns coral dry weights in g
}
   
Mcap_BW$Dry.Weigh.g <- BWCalc_Mcap(BW=BW_Mcap, Temp=Temp_Mcap) #use function to calculate dry weight
# hist(Mcap_BW$Dry.Weigh.g) #not normal
# Mcap_BW$Dry.Weigh.g_log<-log10(Mcap_BW$Dry.Weigh.g+1)
# hist(Mcap_BW$Dry.Weigh.g_log) #better still tail
boxplot(Mcap_BW$Dry.Weigh.g) #examine data
Mcap_BW <- Mcap_BW[!(Mcap_BW$Frag.ID == "797"),] # remove sample 797, error in BW record (impossible value)

# below, we are getting rid of columns we don't need anymore, and reorganizing the data by Fragment and clade/color and treatment. This way our time points wil be in the same row)
data_McapBW <- reshape(Mcap_BW, timevar = "TimePoint", drop = c("Mass.g","Temp.C", "Date","Tank", "X",  "Parent.ID", "Species","Time.Point", "Tank.num"), idvar=c("Frag.ID", "Treatment","Clade"), direction="wide")

# This calculates the growth rate, if you look it takes Timepoint1 subtracts timepoint0 and divides by timepoint 0 and then divides by number of days , times 100
data_McapBW$time1.growth <- (((data_McapBW$Dry.Weigh.g.Time1 - data_McapBW$Dry.Weigh.g.Time0)/data_McapBW$Dry.Weigh.g.Time0)*100)/data_McapBW$Days.Time1 #calculate growth rate for time1
data_McapBW$time2.growth <- (((data_McapBW$Dry.Weigh.g.Time2 - data_McapBW$Dry.Weigh.g.Time1)/data_McapBW$Dry.Weigh.g.Time1)*100)/data_McapBW$Days.Time2 #calculate growth rate for time2


 


# mean, standard dev, and sem
time1_McapBW <-ddply(data_McapBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time1.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_McapBW$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_McapBW <-ddply(data_McapBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_McapBW$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"
G_McapA <- rbind(time1_McapBW[1,],time2_McapBW[1,])# Greate a new column that we rename each row by treatment
G_McapH <- rbind(time1_McapBW[2,],time2_McapBW[2,])# Greate a new column that we rename each row by treatment
G_Mcap<-rbind(G_McapA, G_McapH)
# Stress.Recovery column 
 # make new column that renames "time" to Stress or Recovery
G_Mcap$newtime = ifelse(G_Mcap$Time == "Time1", "Post-Stress", "Post-Recovery")
G_Mcap <- within(G_Mcap, newtime <- factor(newtime, levels = c("Post-Stress", "Post-Recovery"))) # Set order of levels so plots in right order
 
 

Mcap_BW_plot<-ggplot(data=G_Mcap, aes(x=newtime, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .6)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Mcap_BW_plot









#by clade

# mean, standard dev, and sem
time1_McapBW.c <-ddply(data_McapBW, c("Treatment","Clade"), summarize, #
              N=length(na.omit(time1.growth)), # 
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #t
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_McapBW.c$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_McapBW.c <-ddply(data_McapBW, c( "Treatment","Clade"), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_McapBW.c$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"

G_Mcap.c<-rbind(time1_McapBW.c, time2_McapBW.c)

G_Mcap.c$Code<-paste(G_Mcap.c$Treatment,G_Mcap.c$Clade)

Mcap_BW_plot.c<-ggplot(data=G_Mcap.c, aes(x=Time, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .6)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Mcap_BW_plot.c

```
Porites compressa
```{r}  
   
################################     PORITES COMPRESSA
BWCalc_Pcomp <- function(StandardAir= 39.092, Temp, BW, CoralDensity = 1.82){
  #Parameters---------------------------------------------------------------
  # StandardAir is the weight of the Standard in air (Default set at 39.092 grams weighed on balance)
  # Temp is the temperature of the water during the coral measurement
  # BW is the buoywant weight of the coral
  # CoralDensity <- 2.03 #g cm-3, set aragonite density for Montipora from literature 
  # Montipora Arag = 2.03 g cm-3 average from table 2 in Anthony 2003 Functional Ecology 17:246-259
  
  # Porites asteroides (T Hughes 1987 1.69 at 5m) (KB got 1.82)
  
  # below: Medellin-Maldonado et al 2016
  # Pavona varians 1.04 +-0.07
  # panama 8.5380° N, 80.7821° W, 
  # coasta rica 9.7489° N, 83.7534° W
  # mexico la entrega 15.7424° N, 96.1282° W
  # hawaii 19.8968° N, 155.5828° W
  # Pocillopora 1.78 +- 0.31
  
  
  # You can change the density to literatrue values for the specific coral species of interest in the function. 
  
  #Calculation------------------------------------------------------------
  #Step 1: correct the Standard weights for temperature
  # StandardFresh is the weight of the Standard in  fresh water at temp x
  # StandardSalt is the weight of the Standard in salt water at temp x
  
  # This is based on a calibration curve for Standards weighed in fresh and salt water at many temps
  StandardFresh <- StandardFreshModel$coef[-1]*Temp + StandardFreshModel$coef[1] 
  StandardSalt <- StandardSaltModel$coef[-1]*Temp + StandardSaltModel$coef[1] 
  
  # Step 2: Use weight in air and freshwater of the glass Standard to calculate
  # the density of the Standard (Davies eq. 4)
  FreshDensity <- 1 #Fresh water has a density of 1 g/cm3
  StandardDensity <- FreshDensity/(1-(StandardFresh/StandardAir)) 
  
  # Step 3: Calculate the density of seawater using the density of the Standard
  # (Spencer Davies eq. 3)
  SWDensity <- StandardDensity*(1-(StandardSalt/StandardAir))
  
  # Step 4: Calculate the dry weight of the coral (Davies eq. 1)
  CoralWeight <- BW_Pcomp/(1-(SWDensity/CoralDensity))
  
  return(CoralWeight) #returns coral dry weights in g
}


Pcomp_BW$Dry.Weigh.g <- BWCalc_Pcomp(BW=BW_Pcomp, Temp=Temp_Pcomp) #use function to calculate dry weight
# hist(Pcomp_BW$Dry.Weigh.g) 
# Pcomp_BW$Dry.Weigh.g_log<-log10(Pcomp_BW$Dry.Weigh.g+1)
# hist(Pcomp_BW$Dry.Weigh.g_log) # normal
boxplot(Pcomp_BW$Dry.Weigh.g_log) #examine data

# below, we are getting rid of columns we don't need anymore, and reorganizing the data by Fragment and clade/color and treatment. This way our time points wil be in the same row)
data_PcompBW <- reshape(Pcomp_BW, timevar = "TimePoint", drop = c("Mass.g","Temp.C", "Date","Tank", "X", "Time.Point", "Parent.ID", "Species", "Tank.num"), idvar=c("Frag.ID", "Treatment","Clade"), direction="wide")

# This calculates the growth rate, if you look it takes Timepoint1 subtracts timepoint0 and divides by timepoint 0, times 100
data_PcompBW$time1.growth <- (((data_PcompBW$Dry.Weigh.g.Time1 - data_PcompBW$Dry.Weigh.g.Time0)/data_PcompBW$Dry.Weigh.g.Time0)*100)/data_PcompBW$Days.Time1 #calculate growth rate for time1
data_PcompBW$time2.growth <- (((data_PcompBW$Dry.Weigh.g.Time2 - data_PcompBW$Dry.Weigh.g.Time1)/data_PcompBW$Dry.Weigh.g.Time1)*100)/data_PcompBW$Days.Time2 #calculate growth rate for time2

data_PcompBW$time1.growth[data_PcompBW$time1.growth < 0] <- 0 
data_PcompBW$time2.growth[data_PcompBW$time2.growth < 0] <- 0 

# mean, standard dev, and sem
time1_PcompBW <-ddply(data_PcompBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time1.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_PcompBW$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_PcompBW <-ddply(data_PcompBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_PcompBW$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"
G_PcompA <- rbind(time1_PcompBW[1,],time2_PcompBW[1,])# Greate a new column that we rename each row by treatment
G_PcompH <- rbind(time1_PcompBW[2,],time2_PcompBW[2,])# Greate a new column that we rename each row by treatment
G_Pcomp<-rbind(G_PcompA, G_PcompH)
# Stress.Recovery column 
 # make new column that renames "time" to Stress or Recovery
G_Pcomp$newtime = ifelse(G_Pcomp$Time == "Time1", "Post-Stress", "Post-Recovery")
G_Pcomp <- within(G_Pcomp, newtime <- factor(newtime, levels = c("Post-Stress", "Post-Recovery"))) # Set order of levels so plots in right order



Pcomp_BW_plot<-ggplot(data=G_Pcomp, aes(x=newtime, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
 ylab(expression(paste(""))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+  
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Pcomp_BW_plot

#by clade

# mean, standard dev, and sem
time1_PcompBW.c <-ddply(data_PcompBW, c("Treatment","Clade"), summarize, #
              N=length(na.omit(time1.growth)), # 
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #t
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_PcompBW.c$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_PcompBW.c <-ddply(data_PcompBW, c( "Treatment","Clade"), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_PcompBW.c$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"

G_Pcomp.c<-rbind(time1_PcompBW.c, time2_PcompBW.c)

G_Pcomp.c$Code<-paste(G_Pcomp.c$Treatment,G_Pcomp.c$Clade)

Pcomp_BW_plot.c<-ggplot(data=G_Pcomp.c, aes(x=Time, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .6)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Pcomp_BW_plot.c

```
Pavona varians
```{r}  
BWCalc_Pvar <- function(StandardAir= 39.092, Temp, BW, CoralDensity = 1.04){
  #Parameters---------------------------------------------------------------
  # StandardAir is the weight of the Standard in air (Default set at 39.092 grams weighed on balance)
  # Temp is the temperature of the water during the coral measurement
  # BW is the buoywant weight of the coral
  # CoralDensity <- 2.03 #g cm-3, set aragonite density for Montipora from literature 
  # Montipora Arag = 2.03 g cm-3 average from table 2 in Anthony 2003 Functional Ecology 17:246-259
  
  # Porites asteroides (T Hughes 1987 1.69 at 5m) (KB got 1.82)
  
  # below: Medellin-Maldonado et al 2016
  # Pavona varians 1.04 +-0.07
  # panama 8.5380° N, 80.7821° W, 
  # coasta rica 9.7489° N, 83.7534° W
  # mexico la entrega 15.7424° N, 96.1282° W
  # hawaii 19.8968° N, 155.5828° W
  # Pocillopora 1.78 +- 0.31
  
  
  # You can change the density to literatrue values for the specific coral species of interest in the function. 
  
  #Calculation------------------------------------------------------------
  #Step 1: correct the Standard weights for temperature
  # StandardFresh is the weight of the Standard in  fresh water at temp x
  # StandardSalt is the weight of the Standard in salt water at temp x
  
  # This is based on a calibration curve for Standards weighed in fresh and salt water at many temps
  StandardFresh <- StandardFreshModel$coef[-1]*Temp + StandardFreshModel$coef[1] 
  StandardSalt <- StandardSaltModel$coef[-1]*Temp + StandardSaltModel$coef[1] 
  
  # Step 2: Use weight in air and freshwater of the glass Standard to calculate
  # the density of the Standard (Davies eq. 4)
  FreshDensity <- 1 #Fresh water has a density of 1 g/cm3
  StandardDensity <- FreshDensity/(1-(StandardFresh/StandardAir)) 
  
  # Step 3: Calculate the density of seawater using the density of the Standard
  # (Spencer Davies eq. 3)
  SWDensity <- StandardDensity*(1-(StandardSalt/StandardAir))
  
  # Step 4: Calculate the dry weight of the coral (Davies eq. 1)
  CoralWeight <- BW_Pvar/(1-(SWDensity/CoralDensity))
  
  return(CoralWeight) #returns coral dry weights in g
}

Pvar_BW$Dry.Weigh.g <- BWCalc_Pvar(BW=BW_Pvar, Temp=Temp_Pvar) #use function to calculate dry weight
hist(Pvar_BW$Dry.Weigh.g) #not normal

boxplot(Pvar_BW$Dry.Weigh.g) #examine data
# Pvar_BW$Dry.Weigh.g_log<-log10(Pvar_BW$Dry.Weigh.g+1)
# hist(Pvar_BW$Dry.Weigh.g_log) #not normal


# below, we are getting rid of columns we don't need anymore, and reorganizing the data by Fragment and clade/color and treatment. This way our time points wil be in the same row)
data_PvarBW <- reshape(Pvar_BW, timevar = "TimePoint", drop = c("Mass.g","Temp.C", "Date","Tank", "X",  "Parent.ID", "Species","Time.Point", "Tank.num"), idvar=c("Frag.ID", "Treatment","Clade"), direction="wide")

# This calculates the growth rate, if you look it takes Timepoint1 subtracts timepoint0 and divides by timepoint 0, times 100
data_PvarBW$time1.growth <- (((data_PvarBW$Dry.Weigh.g.Time1 - data_PvarBW$Dry.Weigh.g.Time0)/data_PvarBW$Dry.Weigh.g.Time0)*100)/data_PvarBW$Days.Time1 #calculate growth rate for time1
data_PvarBW$time2.growth <- (((data_PvarBW$Dry.Weigh.g.Time2 - data_PvarBW$Dry.Weigh.g.Time1)/data_PvarBW$Dry.Weigh.g.Time1)*100)/data_PvarBW$Days.Time2 #calculate growth rate for time2

data_PvarBW$time1.growth[data_PvarBW$time1.growth < 0] <- 0 # neg values to 0 (chipped frags)
data_PvarBW$time2.growth[data_PvarBW$time2.growth < 0] <- 0 


# mean, standard dev, and sem
time1_PvarBW <-ddply(data_PvarBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time1.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_PvarBW$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_PvarBW <-ddply(data_PvarBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_PvarBW$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"
G_PvarA <- rbind(time1_PvarBW[1,],time2_PvarBW[1,])# Greate a new column that we rename each row by treatment
G_PvarH <- rbind(time1_PvarBW[2,],time2_PvarBW[2,])# Greate a new column that we rename each row by treatment
G_Pvar<-rbind(G_PvarA, G_PvarH)
# Stress.Recovery column 
 # make new column that renames "time" to Stress or Recovery
G_Pvar$newtime = ifelse(G_Pvar$Time == "Time1", "Post-Stress", "Post-Recovery")
G_Pvar <- within(G_Pvar, newtime <- factor(newtime, levels = c("Post-Stress", "Post-Recovery"))) # Set order of levels so plots in right order



Pvar_BW_plot<-ggplot(data=G_Pvar, aes(x=newtime, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Pvar_BW_plot


#by clade

# mean, standard dev, and sem
time1_PvarBW.c <-ddply(data_PvarBW, c("Treatment","Clade"), summarize, #
              N=length(na.omit(time1.growth)), # 
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #t
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_PvarBW.c$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_PvarBW.c <-ddply(data_PvarBW, c( "Treatment","Clade"), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_PvarBW.c$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"

G_Pvar.c<-rbind(time1_PvarBW.c, time2_PvarBW.c)

G_Pvar.c$Code<-paste(G_Pvar.c$Treatment,G_Pvar.c$Clade)

Pvar_BW_plot.c<-ggplot(data=G_Pvar.c, aes(x=Time, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .6)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("P var")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Pvar_BW_plot.c

```
P acuta
```{r}  
BWCalc_Pacu <- function(StandardAir= 39.092, Temp, BW, CoralDensity = 1.78){
  #Parameters---------------------------------------------------------------
  # StandardAir is the weight of the Standard in air (Default set at 39.092 grams weighed on balance)
  # Temp is the temperature of the water during the coral measurement
  # BW is the buoywant weight of the coral
  # CoralDensity <- 2.03 #g cm-3, set aragonite density for Montipora from literature 
  # Montipora Arag = 2.03 g cm-3 average from table 2 in Anthony 2003 Functional Ecology 17:246-259
  
  # Porites asteroides (T Hughes 1987 1.69 at 5m) (KB got 1.82)
  
  # below: Medellin-Maldonado et al 2016
  # Pavona varians 1.04 +-0.07
  # panama 8.5380° N, 80.7821° W, 
  # coasta rica 9.7489° N, 83.7534° W
  # mexico la entrega 15.7424° N, 96.1282° W
  # hawaii 19.8968° N, 155.5828° W
  # Pocillopora 1.78 +- 0.31
  
  
  # You can change the density to literatrue values for the specific coral species of interest in the function. 
  
  #Calculation------------------------------------------------------------
  #Step 1: correct the Standard weights for temperature
  # StandardFresh is the weight of the Standard in  fresh water at temp x
  # StandardSalt is the weight of the Standard in salt water at temp x
  
  # This is based on a calibration curve for Standards weighed in fresh and salt water at many temps
  StandardFresh <- StandardFreshModel$coef[-1]*Temp + StandardFreshModel$coef[1] 
  StandardSalt <- StandardSaltModel$coef[-1]*Temp + StandardSaltModel$coef[1] 
  
  # Step 2: Use weight in air and freshwater of the glass Standard to calculate
  # the density of the Standard (Davies eq. 4)
  FreshDensity <- 1 #Fresh water has a density of 1 g/cm3
  StandardDensity <- FreshDensity/(1-(StandardFresh/StandardAir)) 
  
  # Step 3: Calculate the density of seawater using the density of the Standard
  # (Spencer Davies eq. 3)
  SWDensity <- StandardDensity*(1-(StandardSalt/StandardAir))
  
  # Step 4: Calculate the dry weight of the coral (Davies eq. 1)
  CoralWeight <- BW_Pacu/(1-(SWDensity/CoralDensity))
  
  return(CoralWeight) #returns coral dry weights in g
}

Pacu_BW$Dry.Weigh.g <- BWCalc_Pacu(BW=BW_Pacu, Temp=Temp_Pacu) #use function to calculate dry weight
# hist(Pacu_BW$Dry.Weigh.g) #not normal
# Pacu_BW$Dry.Weigh.g_log<-log10(Pacu_BW$Dry.Weigh.g+1)
# hist(Pacu_BW$Dry.Weigh.g_log) #better still tail
boxplot(Pacu_BW$Dry.Weigh.g) #examine data

# below, we are getting rid of columns we don't need anymore, and reorganizing the data by Fragment and clade/color and treatment. This way our time points wil be in the same row)
data_PacuBW <- reshape(Pacu_BW, timevar = "TimePoint", drop = c("Mass.g","Temp.C", "Date","Tank", "X",  "Parent.ID", "Species","Time.Point", "Tank.num"), idvar=c("Frag.ID", "Treatment","Clade"), direction="wide")

# This calculates the growth rate, if you look it takes Timepoint1 subtracts timepoint0 and divides by timepoint 0, times 100
data_PacuBW$time1.growth <- (((data_PacuBW$Dry.Weigh.g.Time1 - data_PacuBW$Dry.Weigh.g.Time0)/data_PacuBW$Dry.Weigh.g.Time0)*100)/data_PacuBW$Days.Time1 #calculate growth rate for time1
data_PacuBW$time2.growth <- (((data_PacuBW$Dry.Weigh.g.Time2 - data_PacuBW$Dry.Weigh.g.Time1)/data_PacuBW$Dry.Weigh.g.Time1)*100)/data_PacuBW$Days.Time2 #calculate growth rate for time2
data_PacuBW$time1.growth[data_PacuBW$time1.growth < 0] <- 0 # neg values to 0 (chipped frags)
data_PacuBW$time2.growth[data_PacuBW$time2.growth < 0] <- 0 



# mean, standard dev, and sem
time1_PacuBW <-ddply(data_PacuBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time1.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_PacuBW$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_PacuBW <-ddply(data_PacuBW, .( Treatment), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_PacuBW$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"
G_PacuA <- rbind(time1_PacuBW[1,],time2_PacuBW[1,])# Greate a new column that we rename each row by treatment
G_PacuH <- rbind(time1_PacuBW[2,],time2_PacuBW[2,])# Greate a new column that we rename each row by treatment
G_Pacu<-rbind(G_PacuA, G_PacuH)
# Stress.Recovery column 
 # make new column that renames "time" to Stress or Recovery
G_Pacu$newtime = ifelse(G_Pacu$Time == "Time1", "Post-Stress", "Post-Recovery")
G_Pacu <- within(G_Pacu, newtime <- factor(newtime, levels = c("Post-Stress", "Post-Recovery"))) # Set order of levels so plots in right order



Pacu_BW_plot<-ggplot(data=G_Pacu, aes(x=newtime, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste(" "))) + 
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
    ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("P acuta")+ 
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Pacu_BW_plot
 
#by clade

# mean, standard dev, and sem
time1_PacuBW.c <-ddply(data_PacuBW, c("Treatment","Clade"), summarize, #
              N=length(na.omit(time1.growth)), # 
              mean = (mean(time1.growth, na.rm=TRUE)) ,  #t
              sd = sd(time1.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time1.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time1_PacuBW.c$Time <- "Time1"  # this puts these data in our "time1" dataframe

time2_PacuBW.c <-ddply(data_PacuBW, c( "Treatment","Clade"), summarize, #For each subset of a data frame, apply function then combine results into a data frame.
              N=length(na.omit(time2.growth)), # the sample size of the light column summarized by Tank number
              mean = (mean(time2.growth, na.rm=TRUE)) ,  #take the average of the light column summarized by Tank number
              sd = sd(time2.growth, na.rm=TRUE) ,# the standard deviation of the temp column summarized by Tank number
              sem = (sd(time2.growth,na.rm=T)/sqrt(N))) #calculate the SEM as the sd/sqrt of the count or data length
time2_PacuBW.c$Time <- "Time2"  # this puts these data in our "time1" dataframe

#save this dataframe as "G"

G_Pacu.c<-rbind(time1_PacuBW.c, time2_PacuBW.c)

G_Pacu.c$Code<-paste(G_Pacu.c$Treatment,G_Pacu.c$Clade)

Pacu_BW_plot.c<-ggplot(data=G_Pacu.c, aes(x=Time, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-sem, ymax=mean+sem),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .6)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("% Change Dry.Weigh.g"))) +
  ggtitle("P acu")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.25));Pacu_BW_plot.c

```
Plots together
```{r}
###### All plots together 
Mcap_BW_plot<-Mcap_BW_plot+ theme(legend.position = "none") #remove legend
Pcomp_BW_plot<-Pcomp_BW_plot+ theme(legend.position = "none") #remove legend
Pvar_BW_plot<-Pvar_BW_plot+ theme(legend.position = "none") #remove legend
Pacu_BW_plot<-Pacu_BW_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_BW_plot, Pcomp_BW_plot, Pvar_BW_plot,Pacu_BW_plot, nrow = 1)



G_Mcap$Species<-"Montipora_capitata"
G_Pcomp$Species<-"Porites_compressa"
G_Pvar$Species<-"Pavona_varians"
G_Pacu$Species<-"Pocillopora_acuta"

T1Growth<-rbind(G_Mcap, G_Pcomp,G_Pvar,G_Pacu)



#all at t1
Growth_mean.T1<-subset(T1Growth, Time=="Time1")
# Notched box plot
T1.Growth.plot<-ggplot(Growth_mean.T1, aes(x=Species, y=mean, color=Treatment)) + 
  scale_color_manual(values=c("blue", "red"))+
     # coord_cartesian(ylim = c(0, 10))+
   theme_classic()+
  ggtitle("Calcification T1")+
 theme(legend.position="none") +# Remove legend
  geom_boxplot(notch=TRUE);T1.Growth.plot


#all at tF
Growth_mean.TF<-subset(T1Growth, Time=="Time2")
# Notched box plot
TF.Growth.plot<-ggplot(Growth_mean.TF, aes(x=Species, y=mean, color=Treatment)) + 
  scale_color_manual(values=c("blue", "red"))+
     # coord_cartesian(ylim = c(0, 10))+
   theme_classic()+
  ggtitle("Calcification TF")+
 theme(legend.position="none") +# Remove legend
  geom_boxplot(notch=TRUE);TF.Growth.plot
``` 
 
stats
```{r}        
Growth<- rbind(data_McapBW, data_PcompBW, data_PvarBW, data_PacuBW)
GrowthKeep<- c("Frag.ID","time1.growth","time2.growth")
Growth <- Growth[GrowthKeep]

metaKeep<- c("Frag.ID","Parent.ID","Treatment","Clade","Species","Tank.num") #get rid of that X column
metaK <- meta[metaKeep]
 Growth2<-merge(Growth, metaK) #merge metadata


Growth_m <- melt(Growth2, id=c("Frag.ID","Treatment","Parent.ID","Species","Tank.num","Clade")) #melt
names(Growth_m)[names(Growth_m) == "value"] <- "percent.change"
names(Growth_m)[names(Growth_m) == "variable"] <- "Time.point"
Growth_m2<-na.omit(Growth_m) #get rid of NAs

Growth3<-Growth_m2

Growth3$Tank.num<-as.factor(as.character(Growth3$Tank.num))
Growth3$Parent.ID<-as.factor(as.character(Growth3$Parent.ID))
Growth3$percent.change<-as.numeric(as.character(Growth3$percent.change))




hist(Growth3$percent.change) 
# Growth3$percent.change_log<-log10(Growth3$percent.change+1)
# hist(Growth3$percent.change_log) # 
Growth3$percent.change_sqrt<-sqrt(Growth3$percent.change)
hist(Growth3$percent.change_sqrt) # 
# Growth3$percent.change_cube<-Growth3$percent.change^(1/3)
# hist(Growth3$percent.change_cube) 

#T0 only (ambi)
Growth3_T1Ambient<-subset(Growth3, Time.point=="time1.growth"&Treatment=="Ambient")
hist(Growth3_T1Ambient$percent.change_sqrt) 

#t0 only
Growth3_T1Ambient_model<-lmer(percent.change~Species+(1|Tank.num), Growth3_T1Ambient)
anova(Growth3_T1Ambient_model)  #species differ
qqPlot(residuals(Growth3_T1Ambient_model)) 
emm<-emmeans(Growth3_T1Ambient_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)


#t0 only by speices?
Growth3_T1Ambient_stats_T0.mcap<-subset(Growth3_T1Ambient, Species=="Montipora_capitata")
Growth3_T1Ambient_stats_T0.pcomp<-subset(Growth3_T1Ambient, Species=="Porites_compressa")
Growth3_T1Ambient_stats_T0.pvar<-subset(Growth3_T1Ambient, Species=="Pavona_varians")
Growth3_T1Ambient_stats_T0.pacu<-subset(Growth3_T1Ambient, Species=="Pocillopora_acuta")

#mcap
Growth3_T1Ambient_T0_model<-lmer(percent.change~Clade+(1|Tank.num), Growth3_T1Ambient_stats_T0.mcap)
anova(Growth3_T1Ambient_T0_model)  #species differ
qqPlot(residuals(Growth3_T1Ambient_T0_model)) 
emm<-emmeans(Growth3_T1Ambient_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
Growth3_T1Ambient_T0_model<-lmer(percent.change~Clade+(1|Tank.num), Growth3_T1Ambient_stats_T0.pcomp)
anova(Growth3_T1Ambient_T0_model)  #species differ
qqPlot(residuals(Growth3_T1Ambient_T0_model)) 
emm<-emmeans(Growth3_T1Ambient_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
Growth3_T1Ambient_T0_model<-lmer(percent.change~Clade+(1|Tank.num), Growth3_T1Ambient_stats_T0.pvar)
anova(Growth3_T1Ambient_T0_model)  #species differ
qqPlot(residuals(Growth3_T1Ambient_T0_model)) 
emm<-emmeans(Growth3_T1Ambient_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
Growth3_T1Ambient_T0_model<-lmer(percent.change~Clade+(1|Tank.num), Growth3_T1Ambient_stats_T0.pacu)
anova(Growth3_T1Ambient_T0_model)  #species differ
qqPlot(residuals(Growth3_T1Ambient_T0_model)) 
emm<-emmeans(Growth3_T1Ambient_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)


#### T1TF


BW_model<-lmer(percent.change_sqrt~Time.point*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3)
anova(BW_model) 
qqPlot(residuals(BW_model)) 
  emm<-emmeans(BW_model,  ~ Time.point*Treatment|Species, adjust="Tukey")
  cld(emm)
  pairs(emm)
 
BW_model<-lmer(percent.change_sqrt~Time.point*Treatment*Species*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3)
anova(BW_model) 
#lmer

# by Species df: Growth3_Mcap, Growth3_Pcomp, Growth3_Pvar, Growth3_Pacu
Growth3_Mcap<-subset(Growth3, Species=="Montipora_capitata")
  Growth3_Mcap.C<-subset(Growth3_Mcap, Clade=="C")
  Growth3_Mcap.CD<-subset(Growth3_Mcap, Clade=="CD")
    Growth3_Mcap.T1<-subset(Growth3_Mcap, Time.point=="time1.growth")
    Growth3_Mcap.TF<-subset(Growth3_Mcap, Time.point=="time2.growth")

Growth3_Pcomp<-subset(Growth3, Species=="Porites_compressa")
  Growth3_Pcomp.C15cj<-subset(Growth3_Pcomp, Clade=="C15cj")
  Growth3_Pcomp.C15n<-subset(Growth3_Pcomp, Clade=="C15n")
    Growth3_Pcomp.T1<-subset(Growth3_Pcomp, Time.point=="time1.growth")
    Growth3_Pcomp.TF<-subset(Growth3_Pcomp, Time.point=="time2.growth")
    
Growth3_Pvar<-subset(Growth3, Species=="Pavona_varians")
  Growth3_Pvar.C1<-subset(Growth3_Pvar, Clade=="C1")
  Growth3_Pvar.C27<-subset(Growth3_Pvar, Clade=="C27")
    Growth3_Pvar.T1<-subset(Growth3_Pvar, Time.point=="time1.growth")
    Growth3_Pvar.TF<-subset(Growth3_Pvar, Time.point=="time2.growth")
    
Growth3_Pacu<-subset(Growth3, Species=="Pocillopora_acuta")
  Growth3_Pacu.CCC<-subset(Growth3_Pacu, Clade=="CCC")
  Growth3_Pacu.C42<-subset(Growth3_Pacu, Clade=="C42")
    Growth3_Pacu.T1<-subset(Growth3_Pacu, Time.point=="time1.growth")
    Growth3_Pacu.TF<-subset(Growth3_Pacu, Time.point=="time2.growth")



#lmer
percent.change_stats_model<-lmer(percent.change_sqrt~Time.Point*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3)
anova(percent.change_stats_model) 
qqPlot(residuals(percent.change_stats_model)) 

percent.change_sqrt_stats_modelC<-lmer(percent.change_sqrt~Time.Point*Treatment*Species*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3)
anova(percent.change_sqrt_stats_modelC) 

emm<-emmeans(percent.change_sqrt_stats_model,  ~ Days*Treatment|Species, adjust="Tukey")
 cld(emm)
 pairs(emm)
  
#mcap
#lmer
 percent.change_sqrt_Mcap_model<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Mcap)
  anova(percent.change_sqrt_Mcap_model) 
  
percent.change_sqrt_Mcap_model<-lmer(percent.change_sqrt~Time.point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Mcap)
  anova(percent.change_sqrt_Mcap_model) 
  qqPlot(residuals(percent.change_sqrt_Mcap_model)) 
  emm<-emmeans(percent.change_sqrt_Mcap_model,  ~ Time.point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

  #T1 only 
     Biomass_Mcap_model.T1<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Mcap.T1)
  anova(Biomass_Mcap_model.T1) 
    Biomass_Mcap_model.T1<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Mcap.T1)
  anova(Biomass_Mcap_model.T1) 
  qqPlot(residuals(Biomass_Mcap_model.T1)) 
  emm<-emmeans(Biomass_Mcap_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
  Biomass_Mcap_model.TF<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Mcap.TF)
  anova(Biomass_Mcap_model.TF) 
  Biomass_Mcap_model.TF<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Mcap.TF)
  anova(Biomass_Mcap_model.TF) 
  qqPlot(residuals(Biomass_Mcap_model.TF)) 
  emm<-emmeans(Biomass_Mcap_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  
  
  
  
#mcap-C only
  percent.change_sqrt_Mcap_model.C<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Mcap.C)
  anova(percent.change_sqrt_Mcap_model.C) 
  qqPlot(residuals(percent.change_sqrt_Mcap_model.C)) 
    emm<-emmeans(percent.change_sqrt_Mcap_model.C,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  percent.change_sqrt_Mcap_model.CD<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Mcap.CD)
  anova(percent.change_sqrt_Mcap_model.CD) 
  qqPlot(residuals(percent.change_sqrt_Mcap_model.CD)) 
    emm<-emmeans(percent.change_sqrt_Mcap_model.CD,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pcomp ####
#lmer 
    percent.change_sqrt_Pcomp_model<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pcomp)
  anova(percent.change_sqrt_Pcomp_model) 
  
percent.change_sqrt_Pcomp_model<-lmer(percent.change_sqrt~Time.point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pcomp)
  anova(percent.change_sqrt_Pcomp_model) 
  qqPlot(residuals(percent.change_sqrt_Pcomp_model)) 
  emm<-emmeans(percent.change_sqrt_Pcomp_model,  ~ Time.point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)


#T1 only 
   Biomass_Pcomp_model.T1<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Pcomp.T1)
  anova(Biomass_Pcomp_model.T1) 
    Biomass_Pcomp_model.T1<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Pcomp.T1)
  anova(Biomass_Pcomp_model.T1) 
  qqPlot(residuals(Biomass_Pcomp_model.T1)) 
  emm<-emmeans(Biomass_Pcomp_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
  Biomass_Pcomp_model.TF<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Pcomp.TF)
  anova(Biomass_Pcomp_model.TF) 
  Biomass_Pcomp_model.TF<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Pcomp.TF)
  anova(Biomass_Pcomp_model.TF) 
  qqPlot(residuals(Biomass_Pcomp_model.TF)) 
  emm<-emmeans(Biomass_Pcomp_model.TF,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm) 

  
    
#Pcomp-C15cj only
  percent.change_sqrt_Pcomp_model.C15cj<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pcomp.C15cj)
  anova(percent.change_sqrt_Pcomp_model.C15cj) 
  qqPlot(residuals(percent.change_sqrt_Pcomp_model.C15cj)) 
    emm<-emmeans(percent.change_sqrt_Pcomp_model.C15cj,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C27 only
  percent.change_sqrt_Pcomp_model.C15n<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pcomp.C15n)
  anova(percent.change_sqrt_Pcomp_model.C15n) 
  qqPlot(residuals(percent.change_sqrt_Pcomp_model.C15n)) 
    emm<-emmeans(percent.change_sqrt_Pcomp_model.C15n,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pvar ####
#lmer
    percent.change_sqrt_Pvar_model<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pvar)
  anova(percent.change_sqrt_Pvar_model) 
percent.change_sqrt_Pvar_model<-lmer(percent.change_sqrt~Time.point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pvar)
  anova(percent.change_sqrt_Pvar_model) 
  qqPlot(residuals(percent.change_sqrt_Pvar_model)) 
  emm<-emmeans(percent.change_sqrt_Pvar_model,  ~ Time.point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  
  #T1 only 
   Biomass_Pvar_model.T1<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Pvar.T1)
  anova(Biomass_Pvar_model.T1) 
    Biomass_Pvar_model.T1<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Pvar.T1)
  anova(Biomass_Pvar_model.T1) 
  qqPlot(residuals(Biomass_Pvar_model.T1)) 
  emm<-emmeans(Biomass_Pvar_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Biomass_Pvar_model.TF<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Pvar.TF)
  anova(Biomass_Pvar_model.TF) 
  Biomass_Pvar_model.TF<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Pvar.TF)
  anova(Biomass_Pvar_model.TF) 
  qqPlot(residuals(Biomass_Pvar_model.TF)) 
  emm<-emmeans(Biomass_Pvar_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

  
#Pvar-C1 only
  percent.change_sqrt_Pvar_model.C1<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pvar.C1)
  anova(percent.change_sqrt_Pvar_model.C1) 
  qqPlot(residuals(percent.change_sqrt_Pvar_model.C1)) 
    emm<-emmeans(percent.change_sqrt_Pvar_model.C1,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  percent.change_sqrt_Pvar_model.C27<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pvar.C27)
  anova(percent.change_sqrt_Pvar_model.C27) 
  qqPlot(residuals(percent.change_sqrt_Pvar_model.C27)) 
    emm<-emmeans(percent.change_sqrt_Pvar_model.C27,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#Pacu ####
#lmer
    percent.change_sqrt_Pacu_model<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pacu)
  anova(percent.change_sqrt_Pacu_model) 
percent.change_sqrt_Pacu_model<-lmer(percent.change_sqrt~Time.point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pacu)
  anova(percent.change_sqrt_Pacu_model) 
  qqPlot(residuals(percent.change_sqrt_Pacu_model)) 
  emm<-emmeans(percent.change_sqrt_Pacu_model,  ~ Time.point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

  #T1 only 
   Growth_Pacu_model.T1<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Pacu.T1)
  anova(Growth_Pacu_model.T1) 
    Growth_Pacu_model.T1<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Pacu.T1)
  anova(Growth_Pacu_model.T1) 
  qqPlot(residuals(Growth_Pacu_model.T1)) 
  emm<-emmeans(Growth_Pacu_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
  Growth_Pacu_model.TF<-lmer(percent.change_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Growth3_Pacu.TF)
  anova(Growth_Pacu_model.TF)
  Growth_Pacu_model.TF<-lmer(percent.change_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Growth3_Pacu.TF)
  anova(Growth_Pacu_model.TF) 
  qqPlot(residuals(Growth_Pacu_model.TF)) 
  emm<-emmeans(Growth_Pacu_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
#Pacu-CCC only
  percent.change_sqrt_Pacu_model.CCC<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pacu.CCC)
  anova(percent.change_sqrt_Pacu_model.CCC) 
  qqPlot(residuals(percent.change_sqrt_Pacu_model.CCC)) 
    emm<-emmeans(percent.change_sqrt_Pacu_model.CCC,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  percent.change_sqrt_Pacu_model.C42<-lmer(percent.change_sqrt~Time.point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), Growth3_Pacu.C42)
  anova(percent.change_sqrt_Pacu_model.C42) 
  qqPlot(residuals(percent.change_sqrt_Pacu_model.C42)) 
    emm<-emmeans(percent.change_sqrt_Pacu_model.C42,  ~ Time.point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    






















# make DF for BW for Physio, Cast so 2 columns 

Growth.Percent.day<-merge(Growth, meta, all=T)

```



#Chl-a  
dfs: Slurry=airbrush, SA=wax dip, 
SHOULD YOU STANDARDIZE TO CELLS INSTEAD
```{r}      
 
 # Plate 1

Chla_plate1<- read.csv("Data/Chla_plate1.csv")

#merge 
ChlaData1 <- merge(meta, Chla_plate1)
ChlaData1 <- merge(ChlaData1, Slurry)
ChlaData1 <- merge(ChlaData1, SA)
ChlaData1$Parent.ID<-as.factor(as.character(ChlaData1$Parent.ID))
ChlaData1$Tank.num<-as.factor(as.character(ChlaData1$Tank.num))
ChlaData1$Surface.area<-as.numeric(as.character(ChlaData1$Surface.area))


ChlaData1$totChla1<-ChlaData1$Rep1*ChlaData1$TotalVolume
ChlaData1$chlaSA1 <- ChlaData1$totChla1/ChlaData1$Surface.area

ChlaData1$totChla2<-ChlaData1$Rep2*ChlaData1$TotalVolume
ChlaData1$chlaSA2 <- ChlaData1$totChla2/ChlaData1$Surface.area

plate1<-plot(ChlaData1$chlaSA1,ChlaData1$chlaSA2)
ChlaData1<-ChlaData1[!(ChlaData1$Frag.ID=="314"),] #redid plate 8

# Plate 2
Chla_plate2<- read.csv("Data/Chla_plate2.csv")

#merge 
ChlaData2 <- merge(meta, Chla_plate2)
ChlaData2 <- merge(ChlaData2, Slurry)
ChlaData2 <- merge(ChlaData2, SA)
ChlaData2$Parent.ID<-as.factor(as.character(ChlaData2$Parent.ID))
ChlaData2$Tank.num<-as.factor(as.character(ChlaData2$Tank.num))
ChlaData2$Surface.area<-as.numeric(as.character(ChlaData2$Surface.area))

ChlaData2$totChla1<-ChlaData2$Rep1*ChlaData2$TotalVolume
ChlaData2$chlaSA1 <- ChlaData2$totChla1/ChlaData2$Surface.area

ChlaData2$totChla2<-ChlaData2$Rep2*ChlaData2$TotalVolume
ChlaData2$chlaSA2 <- ChlaData2$totChla2/ChlaData2$Surface.area

plate2<-plot(ChlaData2$chlaSA1,ChlaData2$chlaSA2)
ChlaData2<-ChlaData2[!(ChlaData2$Frag.ID=="3476"),] #redid plate 8
ChlaData2<-ChlaData2[!(ChlaData2$Frag.ID=="N211"),] #redid plate 8

# Plate 3
Chla_plate3<- read.csv("Data/Chla_plate3.csv")

#merge 
ChlaData3 <- merge(meta, Chla_plate3)
ChlaData3 <- merge(ChlaData3, Slurry)
ChlaData3 <- merge(ChlaData3, SA)
ChlaData3$Parent.ID<-as.factor(as.character(ChlaData3$Parent.ID))
ChlaData3$Tank.num<-as.factor(as.character(ChlaData3$Tank.num))
ChlaData3$Surface.area<-as.numeric(as.character(ChlaData3$Surface.area))

ChlaData3$totChla1<-ChlaData3$Rep1*ChlaData3$TotalVolume
ChlaData3$chlaSA1 <- ChlaData3$totChla1/ChlaData3$Surface.area

ChlaData3$totChla2<-ChlaData3$Rep2*ChlaData3$TotalVolume
ChlaData3$chlaSA2 <- ChlaData3$totChla2/ChlaData3$Surface.area

plate3<-plot(ChlaData3$chlaSA1,ChlaData3$chlaSA2) #check
ChlaData3<-ChlaData3[!(ChlaData3$Frag.ID=="N158"),] #redid plate 8

# Plate 4 
Chla_plate4<- read.csv("Data/test_plate4.csv")

#merge 
ChlaData4 <- merge(meta, Chla_plate4)
ChlaData4 <- merge(ChlaData4, Slurry)
ChlaData4 <- merge(ChlaData4, SA)
ChlaData4$Parent.ID<-as.factor(as.character(ChlaData4$Parent.ID))
ChlaData4$Tank.num<-as.factor(as.character(ChlaData4$Tank.num))
ChlaData4$Surface.area<-as.numeric(as.character(ChlaData4$Surface.area))


ChlaData4$totChla1<-ChlaData4$Rep1*ChlaData4$TotalVolume
ChlaData4$chlaSA1 <- ChlaData4$totChla1/ChlaData4$Surface.area

ChlaData4$totChla2<-ChlaData4$Rep2*ChlaData4$TotalVolume
ChlaData4$chlaSA2 <- ChlaData4$totChla2/ChlaData4$Surface.area

plate4<-plot(ChlaData4$chlaSA1,ChlaData4$chlaSA2)
ChlaData4<-ChlaData4[!(ChlaData4$Frag.ID=="N30"),] #redid plate 8

# Plate 5 20190319
Chla_plate5<- read.csv("Data/Chla_20190319_plate5.csv")

#merge 
ChlaData5 <- merge(meta, Chla_plate5)
ChlaData5 <- merge(ChlaData5, Slurry)
ChlaData5 <- merge(ChlaData5, SA)
ChlaData5$Parent.ID<-as.factor(as.character(ChlaData5$Parent.ID))
ChlaData5$Tank.num<-as.factor(as.character(ChlaData5$Tank.num))
ChlaData5$Surface.area<-as.numeric(as.character(ChlaData5$Surface.area))


ChlaData5$totChla1<-ChlaData5$Rep1*ChlaData5$TotalVolume
ChlaData5$chlaSA1 <- ChlaData5$totChla1/ChlaData5$Surface.area

ChlaData5$totChla2<-ChlaData5$Rep2*ChlaData5$TotalVolume
ChlaData5$chlaSA2 <- ChlaData5$totChla2/ChlaData5$Surface.area

plate5<-plot(ChlaData5$chlaSA1,ChlaData5$chlaSA2) #some not close, check 



# Plate 6 20190321
Chla_plate6<- read.csv("Data/Chla_plate6.csv")

#merge 
ChlaData6 <- merge(meta, Chla_plate6)
ChlaData6 <- merge(ChlaData6, Slurry)
ChlaData6 <- merge(ChlaData6, SA)
ChlaData6$Parent.ID<-as.factor(as.character(ChlaData6$Parent.ID))
ChlaData6$Tank.num<-as.factor(as.character(ChlaData6$Tank.num))
ChlaData6$Surface.area<-as.numeric(as.character(ChlaData6$Surface.area))

 
ChlaData6$totChla1<-ChlaData6$Rep1*ChlaData6$TotalVolume
ChlaData6$chlaSA1 <- ChlaData6$totChla1/ChlaData6$Surface.area

ChlaData6$totChla2<-ChlaData6$Rep2*ChlaData6$TotalVolume
ChlaData6$chlaSA2 <- ChlaData6$totChla2/ChlaData6$Surface.area

plate6<-plot(ChlaData6$chlaSA1,ChlaData6$chlaSA2) #some not close, check 
ChlaData6<-ChlaData6[!(ChlaData6$Frag.ID=="3484"),] #redid plate 8

# Plate 8 20190321
Chla_plate8<- read.csv("Data/Chla_plate8.csv")

#merge 
ChlaData8 <- merge(meta, Chla_plate8)
ChlaData8 <- merge(ChlaData8, Slurry)
ChlaData8 <- merge(ChlaData8, SA)
ChlaData8$Parent.ID<-as.factor(as.character(ChlaData8$Parent.ID))
ChlaData8$Tank.num<-as.factor(as.character(ChlaData8$Tank.num))
ChlaData8$Surface.area<-as.numeric(as.character(ChlaData8$Surface.area))

 
ChlaData8$totChla1<-ChlaData8$Rep1*ChlaData8$TotalVolume
ChlaData8$chlaSA1 <- ChlaData8$totChla1/ChlaData8$Surface.area

ChlaData8$totChla2<-ChlaData8$Rep2*ChlaData8$TotalVolume
ChlaData8$chlaSA2 <- ChlaData8$totChla2/ChlaData8$Surface.area

plate8<-plot(ChlaData8$chlaSA1,ChlaData8$chlaSA2) #some not close, check 
  
Chla<-rbind(ChlaData1, ChlaData2, ChlaData3, ChlaData4, ChlaData5, ChlaData6,ChlaData8)

chlatest<-merge(meta, Chla, all = T) 
  
```

means for plots 
```{r}     
  
chlatest<-merge(meta, Chla, all.x = T)

duplicated(Chla) #look for duplicate entries
Chla<-unique(Chla) #remove any duplicate entries 

Chla$Chla_RepDiff<-Chla$chlaSA1-Chla$chlaSA2
Chla$ChlaSA<-(Chla$chlaSA1+Chla$chlaSA2)/2
checkChla<-merge(Chla,meta, all.y=T)
duplicated(checkChla)
#write.csv(checkChla,"checkChla.csv")

#2285, 3491, N141 Remove sample where reps are >2 apart
#Chla<-Chla[!(Chla$Frag.ID=="N138"),]

 
#make slightly neg values 0 
Chla$ChlaSA[Chla$ChlaSA < 0] <- 0 

# 
Chla_mean <- ddply(Chla, c("Treatment", "Species", "Time.Point"), summarise, #summarize cell counts
                   N    = length(ChlaSA[!is.na(ChlaSA)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(ChlaSA, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(ChlaSA, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(ChlaSA, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Chla_mean #display table

# divide by species
Mcap_chla<-subset(Chla_mean, Species =="Montipora_capitata")
Pcomp_chla<-subset(Chla_mean, Species =="Porites_compressa")
Pvar_chla<-subset(Chla_mean, Species =="Pavona_varians")
Pacu_chla<-subset(Chla_mean, Species =="Pocillopora_acuta")

#by clade
Chla_meanClade <- ddply(Chla, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize cell counts
                   N    = length(ChlaSA[!is.na(ChlaSA)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(ChlaSA, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(ChlaSA, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(ChlaSA, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Chla_meanClade #display table
# divide by species
Mcap_chla.Clade<-subset(Chla_meanClade, Species =="Montipora_capitata")
Pcomp_chla.Clade<-subset(Chla_meanClade, Species =="Porites_compressa")
Pvar_chla.Clade<-subset(Chla_meanClade, Species =="Pavona_varians")
Pacu_chla.Clade<-subset(Chla_meanClade, Species =="Pocillopora_acuta")

#just T0 ####
Chla_T0<-subset(Chla, Time.Point=="T0")
Chla_T0_mean <- ddply(Chla_T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(ChlaSA[!is.na(ChlaSA)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(ChlaSA, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(ChlaSA, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(ChlaSA, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Chla_T0_mean

#plot all
Chla_T0_mean_plot<-ggplot(data=Chla_T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Chl-a"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));Chla_T0_mean_plot


#T0 by clade
Chla_T0_mean.c <- ddply(Chla_T0, c( "Species","Clade"), summarise, #summarize cell counts
                 N    = length(ChlaSA[!is.na(ChlaSA)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(ChlaSA, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(ChlaSA, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(ChlaSA, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Chla_T0_mean.c$Code<-paste(Chla_T0_mean.c$Species, Chla_T0_mean.c$Clade)

#plot all
Chla_T0_mean_plot<-ggplot(data=Chla_T0_mean.c, aes(x=Species, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Code), size=4, show.legend = T)+
  geom_line(aes(color=Code), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Chl-a"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));Chla_T0_mean_plot






#TFH only####
Chla_TFH<-subset(Chla, Time.Point=="TF"&Treatment=="High") #Subset Pvar
Chla_TFH_mean <- ddply(Chla_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(ChlaSA[!is.na(ChlaSA)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(ChlaSA, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(ChlaSA, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(ChlaSA, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Chla_TFH_mean


#### all species#
#plot all
All_Chla_plot<-ggplot(data=Chla_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Chl-a"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));All_Chla_plot


#Mcap plot ####

Mcap_Chla_plot<-ggplot(data=Mcap_chla, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Chla_plot

#clade Mcap_chla.Clade
Mcap_chla.Clade$Code<-paste(Mcap_chla.Clade$Treatment,Mcap_chla.Clade$Clade)

Mcap_Chla_plot.c<-ggplot(data=Mcap_chla.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Chla_plot.c


#Pcomp plot ####

Pcomp_Chla_plot<-ggplot(data=Pcomp_chla, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Chla_plot

#clade Pcomp_chla.Clade
Pcomp_chla.Clade$Code<-paste(Pcomp_chla.Clade$Treatment,Pcomp_chla.Clade$Clade)

Pcomp_Chla_plot.c<-ggplot(data=Pcomp_chla.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P comp")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Chla_plot.c





#Pvar plot ####

Pvar_Chla_plot<-ggplot(data=Pvar_chla, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Chla_plot

#pvar by clade Pvar_chla.Clade
Pvar_chla.Clade$Code<-paste(Pvar_chla.Clade$Treatment, Pvar_chla.Clade$Clade)
Pvar_Chla_plot<-ggplot(data=Pvar_chla.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "blue","darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P varians")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Chla_plot


#Pacu plot ####

Pacu_Chla_plot<-ggplot(data=Pacu_chla, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Chla_plot

#clade Pvar_chla.Clade
Pacu_chla.Clade$Code<-paste(Pacu_chla.Clade$Treatment,Pacu_chla.Clade$Clade)

Pacu_Chla_plot.c<-ggplot(data=Pacu_chla.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      #ylim(0, 8)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("(µg chl-a cm" ^ "-2"*")"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acu")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Chla_plot.c






```

Plots together
```{r}  
###### All plots together
Mcap_Chla_plot<-Mcap_Chla_plot+ theme(legend.position = "none") #remove legend
Pcomp_Chla_plot<-Pcomp_Chla_plot+ theme(legend.position = "none") #remove legend
Pvar_Chla_plot<-Pvar_Chla_plot+ theme(legend.position = "none") #remove legend
Pacu_Chla_plot<-Pacu_Chla_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_Chla_plot, Pcomp_Chla_plot, Pvar_Chla_plot,Pacu_Chla_plot, nrow = 1)
```
 
stats  
```{r}   

#t0
Chla_stats_T0<-Chla
Chla_stats_T0<-subset(Chla_stats_T0, Time.Point=="T0")
hist (Chla_stats_T0$ChlaSA) 
Chla_stats_T0$ChlaSA_log<-log10(Chla_stats_T0$ChlaSA+1)
hist(Chla_stats_T0$ChlaSA_log) 

#t0 only
Chla_T0_model<-lmer(ChlaSA_log~Treatment*Species+(1|Tank.num), Chla_stats_T0)
anova(Chla_T0_model)  #species differ
qqPlot(residuals(Chla_T0_model)) 
emm<-emmeans(Chla_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)

#mcap
Chla_stats_T0.mcap<-subset(Chla_stats_T0, Species=="Montipora_capitata")
Chla_T0_model.c<-lmer(ChlaSA_log~Clade+(1|Tank.num), Chla_stats_T0.mcap)
anova(Chla_T0_model.c)  #species differ
qqPlot(residuals(Chla_T0_model.c)) 
emm<-emmeans(Chla_T0_model.c,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#Pcomp
Chla_stats_T0.pcomp<-subset(Chla_stats_T0, Species=="Porites_compressa")
Chla_T0_model.c<-lmer(ChlaSA_log~Clade+(1|Tank.num), Chla_stats_T0.pcomp)
anova(Chla_T0_model.c)  #species differ
qqPlot(residuals(Chla_T0_model.c)) 
emm<-emmeans(Chla_T0_model.c,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
Chla_stats_T0.pvar<-subset(Chla_stats_T0, Species=="Pavona_varians")
Chla_T0_model.c<-lmer(ChlaSA_log~Clade+(1|Tank.num), Chla_stats_T0.pvar)
anova(Chla_T0_model.c)  #species differ
qqPlot(residuals(Chla_T0_model.c)) 
emm<-emmeans(Chla_T0_model.c,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
Chla_stats_T0.pacu<-subset(Chla_stats_T0, Species=="Porites_compressa")
Chla_T0_model.c<-lmer(ChlaSA_log~Clade+(1|Tank.num), Chla_stats_T0.pacu)
anova(Chla_T0_model.c)  #species differ
qqPlot(residuals(Chla_T0_model.c)) 
emm<-emmeans(Chla_T0_model.c,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)





#Chla transform
hist (Chla$ChlaSA) 
# Chla$ChlaSA_log<-log10(Chla$ChlaSA+1)
# hist(Chla$ChlaSA_log)
Chla$ChlaSA_quart<-Chla$ChlaSA^(1/4)
hist(Chla$ChlaSA_quart) #best

Chla_stats_T1TF<-subset(Chla, Time.Point=="T1"|Time.Point=="TF")

hist (Chla_stats_T1TF$ChlaSA) 
Chla_stats_T1TF$ChlaSA_log<-log10(Chla_stats_T1TF$ChlaSA+1)
hist(Chla_stats_T1TF$ChlaSA_log) #pos skew this ok?
 # Chla_stats_T1TF$ChlaSA_sqrt<-sqrt(Chla_stats_T1TF$ChlaSA) 
 # hist(Chla_stats_T1TF$ChlaSA_sqrt) #nope
# 
# Chla_stats_T1TF$ChlaSA_cube<-Chla_stats_T1TF$ChlaSA^(1/3)
# hist(Chla_stats_T1TF$ChlaSA_cube) #better but no
# shapiro.test(Chla_stats_T1TF$ChlaSA_cube)


Chla_model<-lmer(ChlaSA_quart~Time.Point*Treatment*Species+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF)
anova(Chla_model) 
qqPlot(residuals(Chla_model)) 
emm<-emmeans(Chla_model,  ~Species, adjust="Tukey")
cld(emm)
pairs(emm)

emm<-emmeans(Chla_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)

Chla_model<-lmer(ChlaSA_quart~Time.Point*Treatment*Species*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF)
anova(Chla_model) 
qqPlot(residuals(Chla_model)) 





# by Species df: Chla_stats_T1TF_Mcap, Chla_stats_T1TF_Pcomp, Chla_stats_T1TF_Pvar, Chla_stats_T1TF_Pacu
Chla_stats_T1TF_Mcap<-subset(Chla_stats_T1TF, Species=="Montipora_capitata")
  Chla_stats_T1TF_Mcap.C<-subset(Chla_stats_T1TF_Mcap, Clade=="C")
  Chla_stats_T1TF_Mcap.CD<-subset(Chla_stats_T1TF_Mcap, Clade=="CD")
Chla_stats_T1TF_Pcomp<-subset(Chla_stats_T1TF, Species=="Porites_compressa")
  Chla_stats_T1TF_Pcomp.C15cj<-subset(Chla_stats_T1TF_Pcomp, Clade=="C15cj")
  Chla_stats_T1TF_Pcomp.C15n<-subset(Chla_stats_T1TF_Pcomp, Clade=="C15n")
Chla_stats_T1TF_Pvar<-subset(Chla_stats_T1TF, Species=="Pavona_varians")
  Chla_stats_T1TF_Pvar.C1<-subset(Chla_stats_T1TF_Pvar, Clade=="C1")
  Chla_stats_T1TF_Pvar.C27<-subset(Chla_stats_T1TF_Pvar, Clade=="C27")
Chla_stats_T1TF_Pacu<-subset(Chla_stats_T1TF, Species=="Pocillopora_acuta")
  Chla_stats_T1TF_Pacu.CCC<-subset(Chla_stats_T1TF_Pacu, Clade=="CCC")
  Chla_stats_T1TF_Pacu.C42<-subset(Chla_stats_T1TF_Pacu, Clade=="C42")
   
#mcap ####
#lmer
  Chla_Mcap_model<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Mcap)
  anova(Chla_Mcap_model) 
  qqPlot(residuals(Chla_Mcap_model)) 
  emm<-emmeans(Chla_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Chla_Mcap_model<-lmer(ChlaSA_quart~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Mcap)
  anova(Chla_Mcap_model) 
  qqPlot(residuals(Chla_Mcap_model)) 
  emm<-emmeans(Chla_Mcap_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

  #T1 only
  Chla_stats_Mcap.T1<-subset(Chla_stats_T1TF_Mcap, Time.Point=="T1")
  Chla_Mcap_model.T1<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Mcap.T1)
  anova(Chla_Mcap_model.T1) 
    Chla_Mcap_model.T1<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Mcap.T1)
  anova(Chla_Mcap_model.T1) 
  qqPlot(residuals(Chla_Mcap_model.T1)) 
  emm<-emmeans(Chla_Mcap_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Chla_stats_Mcap.TF<-subset(Chla_stats_T1TF_Mcap, Time.Point=="TF")

  Chla_Mcap_model.TF<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Mcap.TF)
  anova(Chla_Mcap_model.TF) 
  Chla_Mcap_model.TF<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Mcap.TF)
  anova(Chla_Mcap_model.TF) 
  qqPlot(residuals(Chla_Mcap_model.TF)) 
  emm<-emmeans(Chla_Mcap_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
#mcap-C only
  Chla_Mcap_model.C<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Mcap.C)
  anova(Chla_Mcap_model.C) 
  qqPlot(residuals(Chla_Mcap_model.C)) 
    emm<-emmeans(Chla_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  Chla_Mcap_model.CD<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Mcap.CD)
  anova(Chla_Mcap_model.CD) 
  qqPlot(residuals(Chla_Mcap_model.CD)) 
    emm<-emmeans(Chla_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)*
    pairs(emm)
    
#Pcomp ####
#lmer
Chla_Pcomp_model<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pcomp)
  anova(Chla_Pcomp_model) 
  qqPlot(residuals(Chla_Pcomp_model)) 
  emm<-emmeans(Chla_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Chla_Pcomp_model.Clade<-lmer(ChlaSA_quart~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pcomp)
  anova(Chla_Pcomp_model.Clade) 
  qqPlot(residuals(Chla_Pcomp_model.Clade)) 
  emm<-emmeans(Chla_Pcomp_model.Clade,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
 #T1 only
  Chla_stats_Pcomp.T1<-subset(Chla_stats_T1TF_Pcomp, Time.Point=="T1")
  Chla_Pcomp_model.T1<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pcomp.T1)
  anova(Chla_Pcomp_model.T1) 
    Chla_Pcomp_model.T1<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pcomp.T1)
  anova(Chla_Pcomp_model.T1) 
  qqPlot(residuals(Chla_Pcomp_model.T1)) 
  emm<-emmeans(Chla_Pcomp_model.T1,  ~ Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Chla_stats_Pcomp.TF<-subset(Chla_stats_T1TF_Pcomp, Time.Point=="TF")

  Chla_Pcomp_model.TF<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pcomp.TF)
  anova(Chla_Pcomp_model.TF) 
  Chla_Pcomp_model.TF<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pcomp.TF)
  anova(Chla_Pcomp_model.TF) 
  qqPlot(residuals(Chla_Pcomp_model.TF)) 
  emm<-emmeans(Chla_Pcomp_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)      
  
  
#Pcomp-C15cj only
  Chla_Pcomp_model.C15cj<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pcomp.C15cj)
  anova(Chla_Pcomp_model.C15cj) 
  qqPlot(residuals(Chla_Pcomp_model.C15cj)) 
    emm<-emmeans(Chla_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C15cj only
  Chla_Pcomp_model.C15n<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pcomp.C15n)
  anova(Chla_Pcomp_model.C15n) 
  qqPlot(residuals(Chla_Pcomp_model.C15n)) 
    emm<-emmeans(Chla_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pvar ####
#lmer 
    Chla_Pvar_model<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pvar)
  anova(Chla_Pvar_model) 
   emm<-emmeans(Chla_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Chla_Pvar_model<-lmer(ChlaSA_quart~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pvar)
  anova(Chla_Pvar_model) 
  qqPlot(residuals(Chla_Pvar_model)) 
  emm<-emmeans(Chla_Pvar_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

 #T1 only
  Chla_stats_Pvar.T1<-subset(Chla_stats_T1TF_Pvar, Time.Point=="T1")
      Chla_Pvar_model.T1<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pvar.T1)
  anova(Chla_Pvar_model.T1) 
    Chla_Pvar_model.T1<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pvar.T1)
  anova(Chla_Pvar_model.T1) 
  qqPlot(residuals(Chla_Pvar_model.T1)) 
  emm<-emmeans(Chla_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Chla_stats_Pvar.TF<-subset(Chla_stats_T1TF_Pvar, Time.Point=="TF")
Chla_Pvar_model.TF<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pvar.TF)
  anova(Chla_Pvar_model.TF) 
  Chla_Pvar_model.TF<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pvar.TF)
  anova(Chla_Pvar_model.TF) 
  qqPlot(residuals(Chla_Pvar_model.TF)) 
  emm<-emmeans(Chla_Pvar_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#Pvar-C only
  Chla_Pvar_model.C1<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pvar.C1)
  anova(Chla_Pvar_model.C1) 
  qqPlot(residuals(Chla_Pvar_model.C1)) 
    emm<-emmeans(Chla_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  Chla_Pvar_model.C27<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pvar.C27)
  anova(Chla_Pvar_model.C27) 
  qqPlot(residuals(Chla_Pvar_model.C27)) 
    emm<-emmeans(Chla_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#Pacu ####
#lmer
    Chla_Pacu_model<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pacu)
  anova(Chla_Pacu_model)
  emm<-emmeans(Chla_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

  
Chla_Pacu_model<-lmer(ChlaSA_quart~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pacu)
  anova(Chla_Pacu_model) 
  qqPlot(residuals(Chla_Pacu_model)) 
  emm<-emmeans(Chla_Pacu_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

   #T1 only
  Chla_stats_Pacu.T1<-subset(Chla_stats_T1TF_Pacu, Time.Point=="T1")
      Chla_Pacu_model.T1<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pacu.T1)
  anova(Chla_Pacu_model.T1)
    Chla_Pacu_model.T1<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pacu.T1)
  anova(Chla_Pacu_model.T1) 
  qqPlot(residuals(Chla_Pacu_model.T1)) 
  emm<-emmeans(Chla_Pacu_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Chla_stats_Pacu.TF<-subset(Chla_stats_T1TF_Pacu, Time.Point=="TF")
  Chla_Pacu_model.TF<-lmer(ChlaSA_quart~Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pacu.TF)
  anova(Chla_Pacu_model.TF) 
  Chla_Pacu_model.TF<-lmer(ChlaSA_quart~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Chla_stats_Pacu.TF)
  anova(Chla_Pacu_model.TF) 
  qqPlot(residuals(Chla_Pacu_model.TF)) 
  emm<-emmeans(Chla_Pacu_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#Pacu-CCC only
  Chla_Pacu_model.CCC<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pacu.CCC)
  anova(Chla_Pacu_model.CCC) 
  qqPlot(residuals(Chla_Pacu_model.CCC)) 
    emm<-emmeans(Chla_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  Chla_Pacu_model.C42<-lmer(ChlaSA_quart~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Chla_stats_T1TF_Pacu.C42)
  anova(Chla_Pacu_model.C42) 
  qqPlot(residuals(Chla_Pacu_model.C42)) 
    emm<-emmeans(Chla_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    

```


#PAM 
```{r}      
#Load PAM data
Time0 <- read.csv("Data/PAM_20170320.csv", header=T) #load data
Time0<-merge(Time0, meta)
Time1 <- read.csv("Data/PAM_20170321.csv", header=T) #load data
Time1<-merge(Time1, meta)
Time2 <- read.csv("Data/PAM_20170322.csv", header=T) #load data
Time2<-merge(Time2, meta)
Time3 <- read.csv("Data/PAM_20170323.csv", header=T) #load data
Time3<-merge(Time3, meta)
#Time3b <- read.csv("Data/PAM_new_20170323b.csv", header=T) #load data
Time4 <- read.csv("Data/PAM_20170406.csv", header=T) #load data
Time4<-merge(Time4, meta)
Time5 <- read.csv("Data/PAM_20170413.csv", header=T) #load data
Time5<-merge(Time5, meta)
Time6 <- read.csv("Data/PAM_6test.csv", header=T) #load data had to remove rows with no data bc wouldn't upload
Time6<-merge(Time6, meta)
Time7 <- read.csv("Data/PAM_20170427.csv", header=T) #load data
Time7<-merge(Time7, meta)
Time8 <- read.csv("Data/PAM_20170504.csv", header=T) #load data
Time8<-merge(Time8, meta)
Time9 <- read.csv("Data/PAM_20170511.csv", header=T) #load data
Time9<-merge(Time9, meta)
Time10 <- read.csv("Data/PAM_20170517.csv", header=T) #load data
Time10<-merge(Time10, meta)
 
# combine all data files
PAMdata<-rbind(Time0, Time1, Time2, Time3, Time4, Time5, Time6, Time7, Time8, Time9, Time10)
# F0/FM: change F0, yield, and FM to numeric
PAMdata$F0<-as.numeric(as.character(PAMdata$F0))
PAMdata$FM<-as.numeric(as.character(PAMdata$FM))
PAMdata$Tank<-as.factor(as.character(PAMdata$Tank))
PAMdata$Tank.num<-as.factor(as.character(PAMdata$Tank.num))

# Date - change date to R format and then to numeric
PAMdata$Date <- as.Date(PAMdata$Date, format="%e-%b-%y") 
#PAMdata$Date[PAMdata$Date<"2017-03-24"]<-"2017-03-20" # make all T0 same starte date to get average
PAMdata$Days <- as.numeric(PAMdata$Date - as.Date("2017-03-20"))
PAMdata$Days[PAMdata$Days<4]<- 0  #If you want to make T0 all the same start time do this


# make yield ratio
PAMdata$Yield <- PAMdata$Yield/1000
str(PAMdata) # check

#check yield calculations versus records and build dataframe
checks <- (PAMdata[,(1:9)]) #add samples to dataframe
checks$Yield.Check <- PAMdata$Yield - ((PAMdata$FM-PAMdata$F0)/PAMdata$FM)
checks$checks <- ifelse(abs(checks$Yield.Check-checks$Yield) < 1, TRUE, FALSE) # check to see if Yield matches check
checks[checks$checks==FALSE,]#pull out FALSE

# check for outliers
#boxplot(checks$Yield.Check, main="Times") #check F0r outliers

#Check notes manulaly and remove data points as needed
#check for duplicate rows
DUP<-duplicated(PAMdata) #look for duplicate entries
PAMdata<-unique(PAMdata) #remove any duplicate entries 
#write.csv(PAMdata,"PAMdatacheck.csv")

# if NA in YIELD remove 
PAMdata<-PAMdata[!is.na(PAMdata$Yield), ]




# Many frags were too low to PAM (no signal) but corals were alive. Change fv.fm to 0.1, a minimum baseline to indicate the lack of photosynthetic yield. 0.1 is below the threshold of any PAM signal in a readable coral 

LowSig<-read.csv("Data/PAM_lowSignalSamps.csv") #read in df with low sig samps

#remove samples in 'extra;
#testmer<-merge(meta, LowSig, all.y=T)
LowSig$Date <- as.Date(LowSig$Date, format="%e-%b-%y") #update date
LowSig<-LowSig[!(LowSig$REMOVE=="REMOVE"),] #remove the REMOVES

PAMdata2<- left_join(PAMdata, LowSig, by=c("Date","Frag.ID")) %>%  #merge df based on frag * date
  rowwise() 
# Change Yields in lowsigs to 0.1
PAMdata2 <- within(PAMdata2, Yield[Low.Sig == 'Yes' ] <- '0.1')

PAMdata2$Yield<-as.numeric(PAMdata2$Yield)
PAMdata2$Parent.ID<-as.factor(as.character(PAMdata2$Parent.ID))


```
Stats  
```{r}         
#remove notes 

PAMdata2_stats<-PAMdata2[,c("Frag.ID","Date","Yield","Parent.ID","Treatment","Species","Tank.num","Days","Clade")] # keep only columns you need
PAMdata2_stats$Days<-as.factor(as.character(PAMdata2_stats$Days))
PAMdata2_stats$Yield<-as.numeric(PAMdata2_stats$Yield)
PAMdata2_stats$Parent.ID<-as.factor(as.character(PAMdata2_stats$Parent.ID))

# Historgam
hist(PAMdata2_stats$Yield)

#transform
PAMdata2_stats$Yield_sq<-(PAMdata2_stats$Yield)^2
hist(PAMdata2_stats$Yield_sq)

PAMdata2_stats$Yield_cu<-(PAMdata2_stats$Yield)^3
hist(PAMdata2_stats$Yield_cu) #beter


#t0
PAM_stats_T0<-subset(PAMdata2_stats, Days=="0")
hist (PAM_stats_T0$Yield_cu) 

#t0 only
PAM_stats_T0_model<-lmer(Yield_cu~Treatment*Species+(1|Tank.num), PAM_stats_T0)
anova(PAM_stats_T0_model)  #species differ
qqPlot(residuals(PAM_stats_T0_model)) 
emm<-emmeans(PAM_stats_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)



#t0 only by speices?
PAM_stats_T0.mcap<-subset(PAM_stats_T0, Species=="Montipora_capitata")
PAM_stats_T0.pcomp<-subset(PAM_stats_T0, Species=="Porites_compressa")
PAM_stats_T0.pvar<-subset(PAM_stats_T0, Species=="Pavona_varians")
PAM_stats_T0.pacu<-subset(PAM_stats_T0, Species=="Pocillopora_acuta")

#mcap
PAM_T0_model<-lmer(Yield_cu~Clade+(1|Tank.num), PAM_stats_T0.mcap)
anova(PAM_T0_model)  #species differ
qqPlot(residuals(PAM_T0_model)) 
emm<-emmeans(PAM_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
PAM_T0_model<-lmer(Yield_cu~Clade+(1|Tank.num), PAM_stats_T0.pcomp)
anova(PAM_T0_model)  #species differ
qqPlot(residuals(PAM_T0_model)) 
emm<-emmeans(PAM_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
PAM_T0_model<-lmer(Yield_cu~Clade+(1|Tank.num), PAM_stats_T0.pvar)
anova(PAM_T0_model)  #species differ
qqPlot(residuals(PAM_T0_model)) 
emm<-emmeans(PAM_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
PAM_T0_model<-lmer(Yield_cu~Clade+(1|Tank.num), PAM_stats_T0.pacu)
anova(PAM_T0_model)  #species differ
qqPlot(residuals(PAM_T0_model)) 
emm<-emmeans(PAM_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)






##T1TF ####
#lmer with ^3
PAMdata2_stats_model<-lmer(Yield_cu~Days*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats)
anova(PAMdata2_stats_model) 
qqPlot(residuals(PAMdata2_stats_model)) 

emm<-emmeans(PAMdata2_stats_model,  ~ Days*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)



#lmer

PAMdata2_stats_Mcap<-subset(PAMdata2_stats, Species=="Montipora_capitata")
PAMdata2_stats_Pcomp<-subset(PAMdata2_stats, Species=="Porites_compressa")
PAMdata2_stats_Pvar<-subset(PAMdata2_stats, Species=="Pavona_varians")
PAMdata2_stats_Pacu<-subset(PAMdata2_stats, Species=="Pocillopora_acuta")

# by Species df: PAMdata2_stats_Mcap, PAMdata2_stats_Pcomp, PAMdata2_stats_Pvar, PAMdata2_stats_Pacu
PAMdata2_stats_Mcap<-subset(PAMdata2_stats, Species=="Montipora_capitata")
  PAMdata2_stats_Mcap.C<-subset(PAMdata2_stats_Mcap, Clade=="C")
  PAMdata2_stats_Mcap.CD<-subset(PAMdata2_stats_Mcap, Clade=="CD")
    PAMdata2_stats_Mcap.T1<-subset(PAMdata2_stats_Mcap, Days==24)
    PAMdata2_stats_Mcap.TF<-subset(PAMdata2_stats_Mcap, Days==52)

PAMdata2_stats_Pcomp<-subset(PAMdata2_stats, Species=="Porites_compressa")
  PAMdata2_stats_Pcomp.C15cj<-subset(PAMdata2_stats_Pcomp, Clade=="C15cj")
  PAMdata2_stats_Pcomp.C15n<-subset(PAMdata2_stats_Pcomp, Clade=="C15n")
    PAMdata2_stats_Pcomp.T1<-subset(PAMdata2_stats_Pcomp, Days==24)
    PAMdata2_stats_Pcomp.TF<-subset(PAMdata2_stats_Pcomp, Days==52)
    
PAMdata2_stats_Pvar<-subset(PAMdata2_stats, Species=="Pavona_varians")
  PAMdata2_stats_Pvar.C1<-subset(PAMdata2_stats_Pvar, Clade=="C1")
  PAMdata2_stats_Pvar.C27<-subset(PAMdata2_stats_Pvar, Clade=="C27")
    PAMdata2_stats_Pvar.T1<-subset(PAMdata2_stats_Pvar, Days==24)
    PAMdata2_stats_Pvar.TF<-subset(PAMdata2_stats_Pvar, Days==52)
    
PAMdata2_stats_Pacu<-subset(PAMdata2_stats, Species=="Pocillopora_acuta")
  PAMdata2_stats_Pacu.CCC<-subset(PAMdata2_stats_Pacu, Clade=="CCC")
  PAMdata2_stats_Pacu.C42<-subset(PAMdata2_stats_Pacu, Clade=="C42")
    PAMdata2_stats_Pacu.T1<-subset(PAMdata2_stats_Pacu, Days==24)
    PAMdata2_stats_Pacu.TF<-subset(PAMdata2_stats_Pacu, Days==52)



#lmer
Yield_cu_stats_model<-lmer(Yield_cu~Days*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats)
anova(Yield_cu_stats_model) 
qqPlot(residuals(Yield_cu_stats_model)) 

Yield_cu_stats_modelC<-lmer(Yield_cu~Days*Treatment*Species*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats)
anova(Yield_cu_stats_modelC) 

emm<-emmeans(Yield_cu_stats_model,  ~ Days*Treatment|Species, adjust="Tukey")
 cld(emm)
 pairs(emm)
  
#mcap ####
#lmer
 Yield_cu_Mcap_model<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Mcap)
  anova(Yield_cu_Mcap_model) 
    emm<-emmeans(Yield_cu_Mcap_model,  ~ Days*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Yield_cu_Mcap_model<-lmer(Yield_cu~Days*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Mcap)
  anova(Yield_cu_Mcap_model) 
  qqPlot(residuals(Yield_cu_Mcap_model)) 
  emm<-emmeans(Yield_cu_Mcap_model,  ~ Days*Treatment*Clade, adjust="Tukey")
  cld(emm)
  mcappamdsf<-as.data.frame(pairs(emm))

  #T1 only 
    Biomass_Mcap_model.T1<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Mcap.T1)
  anova(Biomass_Mcap_model.T1) 
    Biomass_Mcap_model.T1<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Mcap.T1)
  anova(Biomass_Mcap_model.T1) 
  qqPlot(residuals(Biomass_Mcap_model.T1)) 
  emm<-emmeans(Biomass_Mcap_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
    emm<-emmeans(Biomass_Mcap_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Biomass_Mcap_model.TF<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Mcap.TF)
  anova(Biomass_Mcap_model.TF) 
  Biomass_Mcap_model.TF<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Mcap.TF)
  anova(Biomass_Mcap_model.TF) 
  qqPlot(residuals(Biomass_Mcap_model.TF)) 
  emm<-emmeans(Biomass_Mcap_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #C only T1
  PAMdata2_stats_Mcap.C.T1<-subset(PAMdata2_stats_Mcap.C, Days=="24")
   PAMdata2_stats_Mcap.C.T1.model<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Mcap.C.T1)
  anova(PAMdata2_stats_Mcap.C.T1.model) 
  qqPlot(residuals(PAMdata2_stats_Mcap.C.T1.model)) 
  emm<-emmeans(PAMdata2_stats_Mcap.C.T1.model,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  #CD only T1
  PAMdata2_stats_Mcap.CD.T1<-subset(PAMdata2_stats_Mcap.CD, Days=="24")
   PAMdata2_stats_Mcap.CD.T1.model<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Mcap.CD.T1)
  anova(PAMdata2_stats_Mcap.CD.T1.model) 
  qqPlot(residuals(PAMdata2_stats_Mcap.CD.T1.model)) 
  emm<-emmeans(PAMdata2_stats_Mcap.CD.T1.model,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  
#mcap-C only
  Yield_cu_Mcap_model.C<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Mcap.C)
  anova(Yield_cu_Mcap_model.C) 
  qqPlot(residuals(Yield_cu_Mcap_model.C)) 
    emm<-emmeans(Yield_cu_Mcap_model.C,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  Yield_cu_Mcap_model.CD<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Mcap.CD)
  anova(Yield_cu_Mcap_model.CD) 
  qqPlot(residuals(Yield_cu_Mcap_model.CD)) 
    emm<-emmeans(Yield_cu_Mcap_model.CD,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#########Pcomp ####
#lmer 
    Yield_cu_Pcomp_model<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pcomp)
  anova(Yield_cu_Pcomp_model) 
   emm<-emmeans(Yield_cu_Pcomp_model,  ~ Days*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Yield_cu_Pcomp_model<-lmer(Yield_cu~Days*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pcomp)
  anova(Yield_cu_Pcomp_model) 
  qqPlot(residuals(Yield_cu_Pcomp_model)) 
  emm<-emmeans(Yield_cu_Pcomp_model,  ~ Days*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Yield_cu_Pcomp_model.Clade<-lmer(Yield_cu~Days*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pcomp)
  anova(Yield_cu_Pcomp_model.Clade) 
  qqPlot(residuals(Yield_cu_Pcomp_model.Clade)) 
  emm<-emmeans(Yield_cu_Pcomp_model.Clade,  ~ Days*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#T1 only
    set.seed(30)
      Yield_cu_Pcomp_model.T1<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pcomp.T1)
  anova(Yield_cu_Pcomp_model.T1) 
    Yield_cu_Pcomp_model.T1<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pcomp.T1)
  anova(Yield_cu_Pcomp_model.T1) 
  qqPlot(residuals(Yield_cu_Pcomp_model.T1)) 
  emm<-emmeans(Yield_cu_Pcomp_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
  Yield_cu_Pcomp_model.TF<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pcomp.TF)
  anova(Yield_cu_Pcomp_model.TF) 
  Yield_cu_Pcomp_model.TF<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pcomp.TF)
  anova(Yield_cu_Pcomp_model.TF) 
  qqPlot(residuals(Yield_cu_Pcomp_model.TF)) 
  emm<-emmeans(Yield_cu_Pcomp_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)   
    
#Pcomp-C15cj only
  Yield_cu_Pcomp_model.C15cj<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pcomp.C15cj)
  anova(Yield_cu_Pcomp_model.C15cj) 
  qqPlot(residuals(Yield_cu_Pcomp_model.C15cj)) 
    emm<-emmeans(Yield_cu_Pcomp_model.C15cj,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C27 only
  Yield_cu_Pcomp_model.C15n<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pcomp.C15n)
  anova(Yield_cu_Pcomp_model.C15n) 
  qqPlot(residuals(Yield_cu_Pcomp_model.C15n)) 
    emm<-emmeans(Yield_cu_Pcomp_model.C15n,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
###Pvar #####
#lmer
    Yield_cu_Pvar_model<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pvar)
  anova(Yield_cu_Pvar_model) 
  qqPlot(residuals(Yield_cu_Pvar_model)) 
  emm<-emmeans(Yield_cu_Pvar_model,  ~ Days*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Yield_cu_Pvar_model<-lmer(Yield_cu~Days*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pvar)
  anova(Yield_cu_Pvar_model) 
  qqPlot(residuals(Yield_cu_Pvar_model)) 
  emm<-emmeans(Yield_cu_Pvar_model,  ~ Days*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)
    emm<-emmeans(Yield_cu_Pvar_model,  ~Treatment*Clade|Days, adjust="Tukey")

  
  #T1 only 
  Yield_cu_Pvar_model.T1<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pvar.T1)
  anova(Yield_cu_Pvar_model.T1) 
    Yield_cu_Pvar_model.T1<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pvar.T1)
  anova(Yield_cu_Pvar_model.T1) 
  qqPlot(residuals(Yield_cu_Pvar_model.T1)) 
  emm<-emmeans(Yield_cu_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Yield_cu_Pvar_model.TF<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pvar.TF)
  anova(Yield_cu_Pvar_model.TF) 
  Yield_cu_Pvar_model.TF<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pvar.TF)
  anova(Yield_cu_Pvar_model.TF) 
  qqPlot(residuals(Yield_cu_Pvar_model.TF)) 
  emm<-emmeans(Yield_cu_Pvar_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

  
#Pvar-C1 only
  Yield_cu_Pvar_model.C1<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pvar.C1)
  anova(Yield_cu_Pvar_model.C1) 
  qqPlot(residuals(Yield_cu_Pvar_model.C1)) 
    emm<-emmeans(Yield_cu_Pvar_model.C1,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  Yield_cu_Pvar_model.C27<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pvar.C27)
  anova(Yield_cu_Pvar_model.C27) 
  qqPlot(residuals(Yield_cu_Pvar_model.C27)) 
    emm<-emmeans(Yield_cu_Pvar_model.C27,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#####Pacu####
#lmer
    Yield_cu_Pacu_model<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pacu)
  anova(Yield_cu_Pacu_model) 
   qqPlot(residuals(Yield_cu_Pacu_model)) 
  emm<-emmeans(Yield_cu_Pacu_model,  ~ Days*Treatment, adjust="Tukey")
  cld(emm)
    pairs(emm)

Yield_cu_Pacu_model<-lmer(Yield_cu~Days*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pacu)
  anova(Yield_cu_Pacu_model) 
  qqPlot(residuals(Yield_cu_Pacu_model)) 
  emm<-emmeans(Yield_cu_Pacu_model,  ~ Treatment*Clade|Days, adjust="Tukey")
  cld(emm)
  pairs(emm)

  #T1 only 
      Yield_cu_Pacu_model.T1<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pacu.T1)
  anova(Yield_cu_Pacu_model.T1) 
    Yield_cu_Pacu_model.T1<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pacu.T1)
  anova(Yield_cu_Pacu_model.T1) 
  qqPlot(residuals(Yield_cu_Pacu_model.T1)) 
  emm<-emmeans(Yield_cu_Pacu_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
  Yield_cu_Pacu_model.TF<-lmer(Yield_cu~Treatment+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pacu.TF)
  anova(Yield_cu_Pacu_model.TF) 
  Yield_cu_Pacu_model.TF<-lmer(Yield_cu~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PAMdata2_stats_Pacu.TF)
  anova(Yield_cu_Pacu_model.TF) 
  qqPlot(residuals(Yield_cu_Pacu_model.TF)) 
  emm<-emmeans(Yield_cu_Pacu_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
#Pacu-CCC only
  Yield_cu_Pacu_model.CCC<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pacu.CCC)
  anova(Yield_cu_Pacu_model.CCC) 
  qqPlot(residuals(Yield_cu_Pacu_model.CCC)) 
    emm<-emmeans(Yield_cu_Pacu_model.CCC,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  Yield_cu_Pacu_model.C42<-lmer(Yield_cu~Days*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PAMdata2_stats_Pacu.C42)
  anova(Yield_cu_Pacu_model.C42) 
  qqPlot(residuals(Yield_cu_Pacu_model.C42)) 
    emm<-emmeans(Yield_cu_Pacu_model.C42,  ~ Days*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    



#set up df for physi
  keepPAM<-c("Frag.ID", "Parent.ID","Species","Tank.num","Treatment","Days","Yield_cu","Clade") #keep cols you need
PAMdata2_stats<-PAMdata2_stats[keepPAM] #keep cols you want
PAMdata2_stats$Parent.ID<-as.factor(as.character(PAMdata2_stats$Parent.ID))
#PAMdata2_physio<-dcast(PAMdata2_stats, Frag.ID+Parent.ID+Species+Tank.num+Treatment~Days,fun.aggregate = mean) #cast

# names(PAMdata2_physio)[names(PAMdata2_physio) == "0"] <- "T0.PAM"
# names(PAMdata2_physio)[names(PAMdata2_physio) == "24"] <- "T1.PAM"
# names(PAMdata2_physio)[names(PAMdata2_physio) == "52"] <- "TF.PAM"


 

```
Plots
```{r}      
PAMdata2_mean <- ddply(PAMdata2, c("Treatment", "Species", "Days"), summarise, #summarize cell counts
                   N    = length(Yield[!is.na(Yield)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Yield, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Yield, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                  max = max(Yield, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PAMdata2_mean #display table

# divide by Clade
Mcap_PAM_mean<-subset(PAMdata2_mean, Species =="Montipora_capitata")
Pcomp_PAM_mean<-subset(PAMdata2_mean, Species =="Porites_compressa")
Pvar_PAM_mean<-subset(PAMdata2_mean, Species =="Pavona_varians")
Pacu_PAM_mean<-subset(PAMdata2_mean, Species =="Pocillopora_acuta")


PAMdata2_meanClade <- ddply(PAMdata2, c("Treatment", "Species", "Days","Clade"), summarise, #summarize cell counts
                   N    = length(Yield[!is.na(Yield)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Yield, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Yield, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                  max = max(Yield, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PAMdata2_meanClade #display table

# divide by clade
Mcap_PAM_mean.clade<-subset(PAMdata2_meanClade, Species =="Montipora_capitata")
Pcomp_PAM_mean.clade<-subset(PAMdata2_meanClade, Species =="Porites_compressa")
Pvar_PAM_mean.clade<-subset(PAMdata2_meanClade, Species =="Pavona_varians")
Pacu_PAM_mean.clade<-subset(PAMdata2_meanClade, Species =="Pocillopora_acuta")


#just T0 ####
PAM_T0<-subset(PAMdata2, Days=="0")
PAM_T0_mean <- ddply(PAM_T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(Yield[!is.na(Yield)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(Yield, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(Yield, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Yield, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PAM_T0_mean

#plot all
PAM_T0_mean_plot<-ggplot(data=PAM_T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("fv/fm"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));PAM_T0_mean_plot

#t0 by clade
PAM_T0_mean.c <- ddply(PAM_T0, c( "Species","Clade"), summarise, #summarize cell counts
                 N    = length(Yield[!is.na(Yield)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(Yield, na.rm=TRUE), #calculate mean of response variable, removing NA's
                  sd   = sd(Yield, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Yield, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PAM_T0_mean.c$Code<-paste(PAM_T0_mean.c$Species,PAM_T0_mean.c$Clade)

#plot all
PAM_T0_mean_plot.c<-ggplot(data=PAM_T0_mean.c, aes(x=Species, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Code), size=4, show.legend = T)+
  geom_line(aes(color=Code), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("fv/fm"))) +
  ggtitle("Time 0")+
  theme(plot.title = element_text(size=20, face = "italic"));PAM_T0_mean_plot.c




#Mcap plot ####

Mcap_PAM_plot<-ggplot(data=Mcap_PAM_mean, aes(x=Days, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_PAM_plot

#by clade for mcap


Mcap_PAM_mean.clade$Code<-paste(Mcap_PAM_mean.clade$Clade, Mcap_PAM_mean.clade$Treatment)

Mcap_PAM_plot<-ggplot(data=Mcap_PAM_mean.clade, aes(x=Days, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred","blue","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
   #   ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("M capitata")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_PAM_plot





#Pcomp plot####

Pcomp_PAM_plot<-ggplot(data=Pcomp_PAM_mean, aes(x=Days, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
    theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P compressa")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_PAM_plot


#by clade for Pcomp


Pcomp_PAM_mean.clade$Code<-paste(Pcomp_PAM_mean.clade$Clade, Pcomp_PAM_mean.clade$Treatment)

Pcomp_PAM_plot<-ggplot(data=Pcomp_PAM_mean.clade, aes(x=Days, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred","blue","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
   #   ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P comp")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_PAM_plot





#Pvar plot ####

Pvar_PAM_plot<-ggplot(data=Pvar_PAM_mean, aes(x=Days, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
  ggtitle("P varians")+
    theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_PAM_plot

# pvar by clade Pvar_PAM_mean.clade
Pvar_PAM_mean.clade$Code<-paste(Pvar_PAM_mean.clade$Treatment,Pvar_PAM_mean.clade$Clade)
Pvar_PAM_plot<-ggplot(data=Pvar_PAM_mean.clade, aes(x=Days, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
  ggtitle("P varians")+
    theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_PAM_plot



#Pacu plot ####
Pacu_PAM_mean<-Pacu_PAM_mean[!(Pacu_PAM_mean$N<5),] #remove time points if n<5

Pacu_PAM_plot<-ggplot(data=Pacu_PAM_mean, aes(x=Days, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, 1)+
 scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
    theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_PAM_plot


#by clade for Pacu


Pacu_PAM_mean.clade$Code<-paste(Pacu_PAM_mean.clade$Clade, Pacu_PAM_mean.clade$Treatment)

Pacu_PAM_plot<-ggplot(data=Pacu_PAM_mean.clade, aes(x=Days, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred","blue","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
   #   ylim(0, 1)+
   scale_x_continuous(name="Days", breaks=c(0,10,20,30,40,50,60))+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("fv/fm"))) +
   theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ggtitle("P acuta")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_PAM_plot


```
Plots together
```{r}
###### All plots together
Mcap_PAM_plot<-Mcap_PAM_plot+ theme(legend.position = "none") #remove legend
Pcomp_PAM_plot<-Pcomp_PAM_plot+ theme(legend.position = "none") #remove legend
Pvar_PAM_plot<-Pvar_PAM_plot+ theme(legend.position = "none") #remove legend
Pacu_PAM_plot<-Pacu_PAM_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_PAM_plot, Pcomp_PAM_plot, Pvar_PAM_plot,Pacu_PAM_plot, nrow = 1)
```

#Protein
```{r}     
Protein <- read.csv("Data/Protein_TT17_20190214.csv")
prottest<-merge(meta, Protein, all=T)
keepPr<-c("Frag.ID", "mg.prot.ml") #keep cols you need
Protein<-Protein[keepPr]

Protein<-merge(Protein, Slurry) #merge with slurry
Protein<-merge(Protein, SA) # merge with SA
Protein$Surface.area<-as.numeric(as.character(Protein$Surface.area))
Protein<-merge(Protein, meta) #merge with metadata
Protein$Parent.ID<-as.factor(as.character(Protein$Parent.ID))
Protein$Tank.num<-as.factor(as.character(Protein$Tank.num))

# calculate total prot per total vol of slurry
Protein$prot.ml<- Protein$mg.prot.ml*Protein$TotalVolume

# create a new column to calculate per surface area (mg/mm2)
Protein$mg.mm2 <- Protein$prot.ml/Protein$Surface.area

PRotcheck<-merge(Protein, meta, all=T)
#write.csv(PRotcheck, "Proteincheck.csv")

#calc means
Protein_mean <- ddply(Protein, c("Treatment", "Species", "Time.Point"), summarise, #summarize prot
                   N    = length(mg.mm2[!is.na(mg.mm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(mg.mm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(mg.mm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(mg.mm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Protein_mean

Protein_meanCLADE <- ddply(Protein, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize prot
                   N    = length(mg.mm2[!is.na(mg.mm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(mg.mm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(mg.mm2, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(mg.mm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Protein_meanCLADE

#stats

hist(Protein$mg.mm2)
Protein$mg.mm2_log<-log10(Protein$mg.mm2+1)
hist(Protein$mg.mm2_log)
Protein$mg.mm2_sqrt<-sqrt(Protein$mg.mm2)
hist(Protein$mg.mm2_sqrt) #better

 
```
Stats
```{r}    
 
#t0
Prot_stats_T0<-subset(Protein, Time.Point=="T0")
hist (Prot_stats_T0$mg.mm2_sqrt) 

#t0 only
Prot_T0_model<-lmer(mg.mm2_sqrt~Treatment*Species+(1|Tank.num), Prot_stats_T0)
anova(Prot_T0_model)  #species differ
qqPlot(residuals(Prot_T0_model)) 
emm<-emmeans(Prot_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)

#t0 only by speices?
Prot_stats_T0.mcap<-subset(Prot_stats_T0, Species=="Montipora_capitata")
Prot_stats_T0.pcomp<-subset(Prot_stats_T0, Species=="Porites_compressa")
Prot_stats_T0.pvar<-subset(Prot_stats_T0, Species=="Pavona_varians")
Prot_stats_T0.pacu<-subset(Prot_stats_T0, Species=="Pocillopora_acuta")

#mcap
Prot_T0_model<-lmer(mg.mm2_sqrt~Clade+(1|Tank.num), Prot_stats_T0.mcap)
anova(Prot_T0_model)  #species differ
qqPlot(residuals(Prot_T0_model)) 
emm<-emmeans(Prot_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
Prot_T0_model<-lmer(mg.mm2_sqrt~Clade+(1|Tank.num), Prot_stats_T0.pcomp)
anova(Prot_T0_model)  #species differ
qqPlot(residuals(Prot_T0_model)) 
emm<-emmeans(Prot_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
Prot_T0_model<-lmer(mg.mm2_sqrt~Clade+(1|Tank.num), Prot_stats_T0.pvar)
anova(Prot_T0_model)  #species differ
qqPlot(residuals(Prot_T0_model)) 
emm<-emmeans(Prot_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
Prot_T0_model<-lmer(mg.mm2_sqrt~Clade+(1|Tank.num), Prot_stats_T0.pacu)
anova(Prot_T0_model)  #species differ
qqPlot(residuals(Prot_T0_model)) 
emm<-emmeans(Prot_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)




#T1TF ####
Prot_stats_T1TF<-subset(Protein, Time.Point=="T1"|Time.Point=="TF")



Protein_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment*Species+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF)
anova(Protein_model) 
qqPlot(residuals(Protein_model)) #not awful

  emm<-emmeans(Protein_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)

  emm<-emmeans(Protein_model,  ~ Species*Treatment|Time.Point, adjust="Tukey")
cld(emm) 
pairs(emm)

Protein_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment*Species*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF)
anova(Protein_model) 
qqPlot(residuals(Protein_model)) #not awful

  emm<-emmeans(Protein_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
cld(emm)
pairs(emm)


# by Species df: Prot_stats_T1TF_Mcap, Prot_stats_T1TF_Pcomp, Prot_stats_T1TF_Pvar, Prot_stats_T1TF_Pacu
Prot_stats_T1TF_Mcap<-subset(Prot_stats_T1TF, Species=="Montipora_capitata")
  Prot_stats_T1TF_Mcap.C<-subset(Prot_stats_T1TF_Mcap, Clade=="C")
  Prot_stats_T1TF_Mcap.CD<-subset(Prot_stats_T1TF_Mcap, Clade=="CD")
Prot_stats_T1TF_Pcomp<-subset(Prot_stats_T1TF, Species=="Porites_compressa")
  Prot_stats_T1TF_Pcomp.C15cj<-subset(Prot_stats_T1TF_Pcomp, Clade=="C15cj")
  Prot_stats_T1TF_Pcomp.C15n<-subset(Prot_stats_T1TF_Pcomp, Clade=="C15n")
Prot_stats_T1TF_Pvar<-subset(Prot_stats_T1TF, Species=="Pavona_varians")
  Prot_stats_T1TF_Pvar.C1<-subset(Prot_stats_T1TF_Pvar, Clade=="C1")
  Prot_stats_T1TF_Pvar.C27<-subset(Prot_stats_T1TF_Pvar, Clade=="C27")
Prot_stats_T1TF_Pacu<-subset(Prot_stats_T1TF, Species=="Pocillopora_acuta")
  Prot_stats_T1TF_Pacu.CCC<-subset(Prot_stats_T1TF_Pacu, Clade=="CCC")
  Prot_stats_T1TF_Pacu.C42<-subset(Prot_stats_T1TF_Pacu, Clade=="C42")
  
#mcap ####
#lmer
  Prot_Mcap_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Mcap)
  anova(Prot_Mcap_model) 
Prot_Mcap_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Mcap)
  anova(Prot_Mcap_model) 
  qqPlot(residuals(Prot_Mcap_model)) 
  emm<-emmeans(Prot_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
 #T1 only
  Prot_stats_Mcap.T1<-subset(Prot_stats_T1TF_Mcap, Time.Point=="T1")
  Prot_Mcap_model.T1<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Mcap.T1)
  anova(Prot_Mcap_model.T1) 
    Prot_Mcap_model.T1<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Mcap.T1)
  anova(Prot_Mcap_model.T1) 
  qqPlot(residuals(Prot_Mcap_model.T1)) 
  emm<-emmeans(Prot_Mcap_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Prot_stats_Mcap.TF<-subset(Prot_stats_T1TF_Mcap, Time.Point=="TF")
Prot_Mcap_model.TF<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Mcap.TF)
  anova(Prot_Mcap_model.TF) 
  Prot_Mcap_model.TF<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Mcap.TF)
  anova(Prot_Mcap_model.TF) 
  qqPlot(residuals(Prot_Mcap_model.TF)) 
  emm<-emmeans(Prot_Mcap_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#mcap-C only
  Prot_Mcap_model.C<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Mcap.C)
  anova(Prot_Mcap_model.C) 
  qqPlot(residuals(Prot_Mcap_model.C)) 
    emm<-emmeans(Prot_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  Prot_Mcap_model.CD<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Mcap.CD)
  anova(Prot_Mcap_model.CD) 
  qqPlot(residuals(Prot_Mcap_model.CD)) 
    emm<-emmeans(Prot_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)*
    pairs(emm)
    
#Pcomp ####
#lmer
Prot_Pcomp_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pcomp)
  anova(Prot_Pcomp_model) 
  qqPlot(residuals(Prot_Pcomp_model)) 
  emm<-emmeans(Prot_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)


Prot_Pcomp_model.Clade<-lmer(mg.mm2_sqrt~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pcomp)
  anova(Prot_Pcomp_model.Clade) 
  qqPlot(residuals(Prot_Pcomp_model.Clade)) 
  emm<-emmeans(Prot_Pcomp_model.Clade,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)

  #T1 only
  Prot_stats_Pcomp.T1<-subset(Prot_stats_T1TF_Pcomp, Time.Point=="T1")
   Prot_Pcomp_model.T1<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pcomp.T1)
  anova(Prot_Pcomp_model.T1) 
    Prot_Pcomp_model.T1<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pcomp.T1)
  anova(Prot_Pcomp_model.T1) 
  qqPlot(residuals(Prot_Pcomp_model.T1)) 
  emm<-emmeans(Prot_Pcomp_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Prot_stats_Pcomp.TF<-subset(Prot_stats_T1TF_Pcomp, Time.Point=="TF")
Prot_Pcomp_model.TF<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pcomp.TF)
  anova(Prot_Pcomp_model.TF) 
  Prot_Pcomp_model.TF<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pcomp.TF)
  anova(Prot_Pcomp_model.TF) 
  qqPlot(residuals(Prot_Pcomp_model.TF)) 
  emm<-emmeans(Prot_Pcomp_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)     
    
        
    
#Pcomp-C15cj only
  Prot_Pcomp_model.C15cj<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pcomp.C15cj)
  anova(Prot_Pcomp_model.C15cj) 
  qqPlot(residuals(Prot_Pcomp_model.C15cj)) 
    emm<-emmeans(Prot_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C15cj only
  Prot_Pcomp_model.C15n<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pcomp.C15n)
  anova(Prot_Pcomp_model.C15n) 
  qqPlot(residuals(Prot_Pcomp_model.C15n)) 
    emm<-emmeans(Prot_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#Pvar ####
#lmer 
    Prot_Pvar_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pvar)
  anova(Prot_Pvar_model) 
  emm<-emmeans(Prot_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
Prot_Pvar_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pvar)
  anova(Prot_Pvar_model) 
  qqPlot(residuals(Prot_Pvar_model)) 
  emm<-emmeans(Prot_Pvar_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

 #T1 only
  Prot_stats_Pvar.T1<-subset(Prot_stats_T1TF_Pvar, Time.Point=="T1")
  Prot_Pvar_model.T1<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pvar.T1)
  anova(Prot_Pvar_model.T1) 
    Prot_Pvar_model.T1<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pvar.T1)
  anova(Prot_Pvar_model.T1) 
  qqPlot(residuals(Prot_Pvar_model.T1)) 
  emm<-emmeans(Prot_Pvar_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Prot_stats_Pvar.TF<-subset(Prot_stats_T1TF_Pvar, Time.Point=="TF")
Prot_Pvar_model.TF<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pvar.TF)
  anova(Prot_Pvar_model.TF) 
  Prot_Pvar_model.TF<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pvar.TF)
  anova(Prot_Pvar_model.TF) 
  qqPlot(residuals(Prot_Pvar_model.TF)) 
  emm<-emmeans(Prot_Pvar_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
    
#Pvar-C1 only
  Prot_Pvar_model.C1<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pvar.C1)
  anova(Prot_Pvar_model.C1) 
  qqPlot(residuals(Prot_Pvar_model.C1)) 
    emm<-emmeans(Prot_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  Prot_Pvar_model.C27<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pvar.C27)
  anova(Prot_Pvar_model.C27) 
  qqPlot(residuals(Prot_Pvar_model.C27)) 
    emm<-emmeans(Prot_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#Pacu ####
#lmer
    Prot_Pacu_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pacu)
  anova(Prot_Pacu_model)
   emm<-emmeans(Prot_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
   cld(emm)
    pairs(emm)
Prot_Pacu_model<-lmer(mg.mm2_sqrt~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pacu)
  anova(Prot_Pacu_model) 
  qqPlot(residuals(Prot_Pacu_model)) 
  emm<-emmeans(Prot_Pacu_model,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
  cld(emm)
  pairs(emm)

 #T1 only
  Prot_stats_Pacu.T1<-subset(Prot_stats_T1TF_Pacu, Time.Point=="T1")
  Prot_Pacu_model.T1<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pacu.T1)
  anova(Prot_Pacu_model.T1) 
    Prot_Pacu_model.T1<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pacu.T1)
  anova(Prot_Pacu_model.T1) 
  qqPlot(residuals(Prot_Pacu_model.T1)) 
  emm<-emmeans(Prot_Pacu_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    Prot_stats_Pacu.TF<-subset(Prot_stats_T1TF_Pacu, Time.Point=="TF")
 Prot_Pacu_model.TF<-lmer(mg.mm2_sqrt~Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pacu.TF)
  anova(Prot_Pacu_model.TF) 
  Prot_Pacu_model.TF<-lmer(mg.mm2_sqrt~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), Prot_stats_Pacu.TF)
  anova(Prot_Pacu_model.TF) 
  qqPlot(residuals(Prot_Pacu_model.TF)) 
  emm<-emmeans(Prot_Pacu_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
#Pacu-CCC only
  Prot_Pacu_model.CCC<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pacu.CCC)
  anova(Prot_Pacu_model.CCC) 
  qqPlot(residuals(Prot_Pacu_model.CCC)) 
    emm<-emmeans(Prot_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  Prot_Pacu_model.C42<-lmer(mg.mm2_sqrt~Time.Point*Treatment+(1|Parent.ID)+(1|Tank.num), Prot_stats_T1TF_Pacu.C42)
  anova(Prot_Pacu_model.C42) 
  qqPlot(residuals(Prot_Pacu_model.C42)) 
    emm<-emmeans(Prot_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
```
plots
```{r}  

#just T0 ####
Protein_T0_mean <- ddply(Prot_stats_T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(mg.mm2[!is.na(mg.mm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(mg.mm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(mg.mm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(mg.mm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
) 
Protein_T0_mean


#TFH only####
Protein_TFH<-subset(Protein, Time.Point=="TF"&Treatment=="High") #Subset Pvar
Protein_TFH_mean <- ddply(Protein_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(mg.mm2[!is.na(mg.mm2)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(mg.mm2, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(mg.mm2, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(mg.mm2, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Protein_TFH_mean

#plot all
Protein_TFH_plot<-ggplot(data=Protein_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("mg.mm2"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));Protein_TFH_plot





#### all species#
#plot all
All_Chla_plot<-ggplot(data=Chla_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Chl-a"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));All_Chla_plot







#### by species ####
Mcap_Protein_mean<-subset(Protein_mean, Species=="Montipora_capitata")
Pcomp_Protein_mean<-subset(Protein_mean, Species=="Porites_compressa")
Pvar_Protein_mean<-subset(Protein_mean, Species=="Pavona_varians")
Pacu_Protein_mean<-subset(Protein_mean, Species=="Pocillopora_acuta")

  
#Mcap
Mcap_Protein_plot<-ggplot(data=Mcap_Protein_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("M capitata")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Protein_plot

#Mcap by clade
Protein_meanCLADE.Mcap<-subset(Protein_meanCLADE, Species=="Montipora_capitata")
Protein_meanCLADE.Mcap$Code<-paste(Protein_meanCLADE.Mcap$Treatment,Protein_meanCLADE.Mcap$Clade)

Mcap_Protein_plot<-ggplot(data=Protein_meanCLADE.Mcap, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("Mcap")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Protein_plot


#Pcomp ####
Pcomp_Protein_plot<-ggplot(data=Pcomp_Protein_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("P compressa")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Protein_plot

#Pcomp by clade
Protein_meanCLADE.Pcomp<-subset(Protein_meanCLADE, Species=="Porites_compressa")
Protein_meanCLADE.Pcomp$Code<-paste(Protein_meanCLADE.Pcomp$Treatment,Protein_meanCLADE.Pcomp$Clade)

Pcomp_Protein_plot<-ggplot(data=Protein_meanCLADE.Pcomp, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("P compressa")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Protein_plot



#Pvar ####
Pvar_Protein_plot<-ggplot(data=Pvar_Protein_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("P varians")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Protein_plot

#Pvar by clade
Protein_meanCLADE.Pvar<-subset(Protein_meanCLADE, Species=="Pavona_varians")
Protein_meanCLADE.Pvar$Code<-paste(Protein_meanCLADE.Pvar$Treatment,Protein_meanCLADE.Pvar$Clade)

Pvar_Protein_plot<-ggplot(data=Protein_meanCLADE.Pvar, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("P var")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Protein_plot


#Pacu ####
Pacu_Protein_plot<-ggplot(data=Pacu_Protein_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
      ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("P acuta")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Protein_plot

#Pacu by clade
Protein_meanCLADE.Pacu<-subset(Protein_meanCLADE, Species=="Porites_compressa")
Protein_meanCLADE.Pacu$Code<-paste(Protein_meanCLADE.Pacu$Treatment,Protein_meanCLADE.Pacu$Clade)

Pacu_Protein_plot<-ggplot(data=Protein_meanCLADE.Pacu, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
     # ylim(0, .7)+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("mg/mm2"))) +
  ggtitle("P acuta")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Protein_plot



###### All plots together
Mcap_Protein_plot<-Mcap_Protein_plot+ theme(legend.position = "none") #remove legend
Pcomp_Protein_plot<-Pcomp_Protein_plot+ theme(legend.position = "none") #remove legend
Pvar_Protein_plot<-Pvar_Protein_plot+ theme(legend.position = "none") #remove legend
Pacu_Protein_plot<-Pacu_Protein_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_Protein_plot, Pcomp_Protein_plot, Pvar_Protein_plot,Pacu_Protein_plot, nrow = 1)
```








#Resp:photosynthesis
```{r}     
#load data respirometry_processed.csv
PR  <- read.csv("Data/respirometry_processed_Final.csv")
#PR<-PR[,c("Frag.ID","Date","Yield","Parent.ID","Treatment","Species","Tank.num","Days")] # keep only columns you need


#subset metadata for what you need 
metaPR<-meta
metaPR<-metaPR[,c("Frag.ID","Parent.ID","Treatment","Species","Tank.num")] # keep only columns you need
metaPR$Parent.ID<-as.factor(as.character(metaPR$Parent.ID))
metaPR$Tank.num<-as.factor(as.character(metaPR$Tank.num))

#subset to add metadata bc merg isnt' wroking
PR_T0<-subset(PR, Time.Point=="T0")
PR_T0m<-merge(PR_T0, metaPR, all.y=T) #this weeds out 'extra' frags
PR_T0m<-PR_T0m[!is.na(PR_T0m$PR), ] #remove rows with no PR
duplicated(PR_T0m$Frag.ID) #check for duplicated rows per frag (for redos)
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N94" & PR_T0m$round==2),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N211" & PR_T0m$round==4),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N209" & PR_T0m$round==2),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N197" & PR_T0m$round==4),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N181" & PR_T0m$round==8),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N104" & PR_T0m$round==6),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="422" & PR_T0m$round==4),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="3442" & PR_T0m$round==4),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="284" & PR_T0m$round==1),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="284" & PR_T0m$round==11),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="1736" & PR_T0m$channel==8),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="1556" & PR_T0m$round==2),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="1279" & PR_T0m$round==1),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="1226" & PR_T0m$round==8),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="1144" & PR_T0m$round==4),]  #remove the dups
PR_T0m<-PR_T0m[!(PR_T0m$Frag.ID=="N92" & PR_T0m$round==4),]  #remove the dups
duplicated(PR_T0m$Frag.ID) #check for duplicated rows per frag (for redos)



PR_T1<-subset(PR, Time.Point=="T1")
PR_T1m<-merge(PR_T1, metaPR, all.y=T) #this weeds out 'extra' frags
PR_T1m<-PR_T1m[!is.na(PR_T1m$PR), ] #remove rows with no PR
duplicated(PR_T1m$Frag.ID) #check for duplicated rows per frag (for redos)
PR_T1m<-PR_T1m[!(PR_T1m$Frag.ID=="1413" & PR_T1m$round==2),]  #remove the dups
PR_T1m<-PR_T1m[!(PR_T1m$Frag.ID=="477" & PR_T1m$Photo==2.339480e-04),]  #remove the dups
PR_T1m<-PR_T1m[!(PR_T1m$Frag.ID=="3383" & PR_T1m$round==12),]  #remove the dups
PR_T1m<-PR_T1m[!(PR_T1m$Frag.ID=="1791" & PR_T1m$round==13),]  #remove the dups

PR_TF<-subset(PR, Time.Point=="TF")
PR_TFm<-merge(PR_TF, metaPR, all.y=T) #this weeds out 'extra' frags
PR_TFm<-PR_TFm[!is.na(PR_TFm$PR), ] #remove rows with no PR
duplicated(PR_TFm$Frag.ID) #check for duplicated rows per frag (for redos)
PR_TFm<-PR_TFm[!(PR_TFm$Frag.ID=="3481" & PR_TFm$round==11),]  #remove the PR is no possible, algae note

PR.df<-rbind(PR_T0m,PR_T1m)
PR.df<-rbind(PR.df,PR_TFm)

#add the clades in 
metaPR<-meta[,c("Frag.ID","Clade")] # keep only columns you need
PR.df<-merge(PR.df, metaPR)

######## FOR NOW - if you want to change pos R to 0 and neg P to 0
PR.df_B<-PR.df
# PR.df_B$Photo[PR.df_B$Photo < 0] <- 0
# PR.df_B$Resp[PR.df_B$Resp > 0] <- 0
 

PR.df_B_Mcap<-subset(PR.df_B, Species=="Montipora_capitata")
PR.df_B_Pcomp<-subset(PR.df_B, Species=="Porites_compressa")
PR.df_B_Pvar<-subset(PR.df_B, Species=="Pavona_varians")
PR.df_B_Pacu<-subset(PR.df_B, Species=="Pocillopora_acuta")

```
Plots
Photosynthesis
```{r}     
Photo_mean <- ddply(PR.df_B, c("Treatment", "Species", "Time.Point"), summarise, #summarize cell counts
                   N    = length(Photo[!is.na(Photo)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Photo, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Photo, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Photo, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Photo_mean #display table

Photo_meanCLADE <- ddply(PR.df_BPR.df_B.T0, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize cell counts
                   N    = length(Photo[!is.na(Photo)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Photo, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Photo, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Photo, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Photo_meanCLADE 

#just T0 ####
PR.df_BPR.df_B.T0<-subset(PR.df_B, Time.Point=="T0")

PR.df_BPR.df_B.T0_mean <- ddply(PR.df_BPR.df_B.T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(Photo[!is.na(Photo)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(Photo, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Photo, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Photo, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PR.df_BPR.df_B.T0_mean 

 
#plot all
Protein_T0_mean_plot<-ggplot(data=PR.df_BPR.df_B.T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Photosynthesis"))) +
  ggtitle("Photo T0")+
  theme(plot.title = element_text(size=20, face = "italic"));Protein_T0_mean_plot


 

#TFH only####
Photo_TFH<-subset(PR.df_B, Time.Point=="TF"&Treatment=="High") #Subset Pvar
Photo_TFH_mean <- ddply(Photo_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(Photo[!is.na(Photo)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(Photo, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Photo, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Photo, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Photo_TFH_mean

#plot all
Photo_TFH_plot<-ggplot(data=Photo_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Photo"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));Photo_TFH_plot









# divide by species ####
Mcap_Photo_mean<-subset(Photo_mean, Species =="Montipora_capitata")
Pcomp_Photo_mean<-subset(Photo_mean, Species =="Porites_compressa")
Pvar_Photo_mean<-subset(Photo_mean, Species =="Pavona_varians")
Pacu_Photo_mean<-subset(Photo_mean, Species =="Pocillopora_acuta")

#Mcap plot

Mcap_Photo_plot<-ggplot(data=Mcap_Photo_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Mcap P")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Photo_plot


#Pcomp plot

Pcomp_Photo_plot<-ggplot(data=Pcomp_Photo_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
  ylab(expression(paste("umol/sec/cm2"))) +
  ggtitle("Pcomp P")+
          theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Photo_plot


#pcomp clade Photo_meanCLADE
Photo_meanCLADE.pcomp<-subset(Photo_meanCLADE, Species=="Porites_compressa")
Photo_meanCLADE.pcomp$Code<-paste(Photo_meanCLADE.pcomp$Treatment,Photo_meanCLADE.pcomp$Clade)

Pcomp_Photo_plot<-ggplot(data=Photo_meanCLADE.pcomp, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+  
  geom_line(aes(color=Code),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
  ylab(expression(paste("umol/sec/cm2"))) +
  ggtitle("Pcomp P")+
          theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Photo_plot


#Pvar plot

Pvar_Photo_plot<-ggplot(data=Pvar_Photo_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
          theme(aspect.ratio=1)+
  ggtitle("Pvar P")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Photo_plot

#Pacu plot

Pacu_Photo_plot<-ggplot(data=Pacu_Photo_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
    ggtitle("Pacu P")+
   
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Photo_plot

```
P Plots together
```{r}
###### All plots together
Mcap_Photo_plot<-Mcap_Photo_plot+ theme(legend.position = "none") #remove legend
Pcomp_Photo_plot<-Pcomp_Photo_plot+ theme(legend.position = "none") #remove legend
Pvar_Photo_plot<-Pvar_Photo_plot+ theme(legend.position = "none") #remove legend
Pacu_Photo_plot<-Pacu_Photo_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_Photo_plot, Pcomp_Photo_plot, Pvar_Photo_plot,Pacu_Photo_plot, nrow = 1)
library(gridExtra)

```
Plots by Clades 
```{r}
#Mcap 
Photo_mean.Clade <- ddply(PR.df_B, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize cell counts
                   N    = length(Photo[!is.na(Photo)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Photo, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Photo, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Photo, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Photo_mean.Clade #display table

# divide by species
Mcap_Photo_mean.Clade<-subset(Photo_mean.Clade, Species =="Montipora_capitata")
  Mcap_Photo_mean.Clade$Code<-paste(Mcap_Photo_mean.Clade$Clade, Mcap_Photo_mean.Clade$Treatment)
Pcomp_Photo_mean.Clade<-subset(Photo_mean.Clade, Species =="Porites_compressa")
  Pcomp_Photo_mean.Clade$Code<-paste(Pcomp_Photo_mean.Clade$Clade, Pcomp_Photo_mean.Clade$Treatment)
Pvar_Photo_mean.Clade<-subset(Photo_mean.Clade, Species =="Pavona_varians")
  Pvar_Photo_mean.Clade$Code<-paste(Pvar_Photo_mean.Clade$Clade, Pvar_Photo_mean.Clade$Treatment)
Pacu_Photo_mean.Clade<-subset(Photo_mean.Clade, Species =="Pocillopora_acuta")
  Pacu_Photo_mean.Clade$Code<-paste(Pacu_Photo_mean.Clade$Clade, Pacu_Photo_mean.Clade$Treatment)


library(RColorBrewer)

#Mcap by clade
Mcap_Photo_mean.Clade$Code<-paste(Mcap_Photo_mean.Clade$Treatment,Mcap_Photo_mean.Clade$Clade)

Mcap_Photo_plot.Clade<-ggplot(data=Mcap_Photo_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3", "blue","darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Mcap Photosynthesis")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Photo_plot.Clade


#Pcomp by clade
Pcomp_Photo_mean.Clade$Code<-paste(Pcomp_Photo_mean.Clade$Treatment,Pcomp_Photo_mean.Clade$Clade)

Pcomp_Photo_plot.Clade<-ggplot(data=Pcomp_Photo_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pcomp Photosynthesis")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Photo_plot.Clade

#Pvar by clade
Pvar_Photo_mean.Clade$Code<-paste(Pvar_Photo_mean.Clade$Treatment,Pvar_Photo_mean.Clade$Clade)

Pvar_Photo_plot.Clade<-ggplot(data=Pvar_Photo_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pvar Photosynthesis")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Photo_plot.Clade

#Pacu by clade
Pacu_Photo_mean.Clade$Code<-paste(Pacu_Photo_mean.Clade$Treatment,Pacu_Photo_mean.Clade$Clade)

Pacu_Photo_plot.Clade<-ggplot(data=Pacu_Photo_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pacu Photosynthesis")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Photo_plot.Clade

Mcap_Photo_plot.Clade<-Mcap_Photo_plot.Clade+ theme(legend.position = "none") #remove legend
Pcomp_Photo_plot.Clade<-Pcomp_Photo_plot.Clade+ theme(legend.position = "none") #remove legend
Pvar_Photo_plot.Clade<-Pvar_Photo_plot.Clade+ theme(legend.position = "none") #remove legend
Pacu_Photo_plot.Clade<-Pacu_Photo_plot.Clade+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_Photo_plot.Clade, Pcomp_Photo_plot.Clade, Pvar_Photo_plot.Clade,Pacu_Photo_plot.Clade, nrow = 1)



```

Photosynthesis stats 
```{r}      
#df PR.df_B, use all time points bc repeated measures 

hist(PR.df_B$Photo)

#t0
Photo_stats_T0<-subset(PR.df_B, Time.Point=="T0")
hist (Photo_stats_T0$Photo) 

#t0 only 
Photo_stats_T0_model<-lmer(Photo~Treatment*Species+(1|Tank.num), Photo_stats_T0)
anova(Photo_stats_T0_model)  #species differ
qqPlot(residuals(Photo_stats_T0_model)) 
emm<-emmeans(Photo_stats_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)
emm<-emmeans(Photo_stats_T0_model,  ~ Species*Treatment, adjust="Tukey")
cld(emm)
pairs(emm)
 

#t0 only by speices?
Photo_stats_T0.mcap<-subset(Photo_stats_T0, Species=="Montipora_capitata")
Photo_stats_T0.pcomp<-subset(Photo_stats_T0, Species=="Porites_compressa")
Photo_stats_T0.pvar<-subset(Photo_stats_T0, Species=="Pavona_varians")
Photo_stats_T0.pacu<-subset(Photo_stats_T0, Species=="Pocillopora_acuta")

#mcap
Photo_T0_model<-lmer(Photo~Clade+(1|Tank.num), Photo_stats_T0.mcap)
anova(Photo_T0_model)  #species differ
qqPlot(residuals(Photo_T0_model)) 
emm<-emmeans(Photo_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
Photo_T0_model<-lmer(Photo~Clade+(1|Tank.num), Photo_stats_T0.pcomp)
anova(Photo_T0_model)  #species differ
qqPlot(residuals(Photo_T0_model)) 
emm<-emmeans(Photo_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
Photo_T0_model<-lmer(Photo~Clade+(1|Tank.num), Photo_stats_T0.pvar)
anova(Photo_T0_model)  #species differ
qqPlot(residuals(Photo_T0_model)) 
emm<-emmeans(Photo_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
Photo_T0_model<-lmer(Photo~Clade+(1|Tank.num), Photo_stats_T0.pacu)
anova(Photo_T0_model)  #species differ
qqPlot(residuals(Photo_T0_model)) 
emm<-emmeans(Photo_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)


#T1TF####
#lmer
Photo_stats_model<-lmer(Photo~Time.Point*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B)
anova(Photo_stats_model) 
qqPlot(residuals(Photo_stats_model)) 
Photo_stats_modelC<-lmer(Photo~Time.Point*Treatment*Species*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B)
anova(Photo_stats_modelC) 

emm<-emmeans(Photo_stats_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
 cld(emm)
 pairs(emm)

# by Species df: PR.df_B_Mcap, PR.df_B_Pcomp, PR.df_B_Pvar, PR.df_B_Pacu
PR.df_B_Mcap<-subset(PR.df_B, Species=="Montipora_capitata")
  PR.df_B_Mcap.C<-subset(PR.df_B_Mcap, Clade=="C")
  PR.df_B_Mcap.CD<-subset(PR.df_B_Mcap, Clade=="CD")
PR.df_B_Pcomp<-subset(PR.df_B, Species=="Porites_compressa")
  PR.df_B_Pcomp.C15cj<-subset(PR.df_B_Pcomp, Clade=="C15cj")
  PR.df_B_Pcomp.C15n<-subset(PR.df_B_Pcomp, Clade=="C15n")
PR.df_B_Pvar<-subset(PR.df_B, Species=="Pavona_varians")
  PR.df_B_Pvar.C1<-subset(PR.df_B_Pvar, Clade=="C1")
  PR.df_B_Pvar.C27<-subset(PR.df_B_Pvar, Clade=="C27")
PR.df_B_Pacu<-subset(PR.df_B, Species=="Pocillopora_acuta")
  PR.df_B_Pacu.CCC<-subset(PR.df_B_Pacu, Clade=="CCC")
  PR.df_B_Pacu.C42<-subset(PR.df_B_Pacu, Clade=="C42")
  
#mcap####
#lmer   
Photo_Mcap_model<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(Photo_Mcap_model) 
  qqPlot(residuals(Photo_Mcap_model)) 
  emm<-emmeans(Photo_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  Photo_Mcap_model<-lmer(Photo~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(Photo_Mcap_model) 
  qqPlot(residuals(Photo_Mcap_model)) 
  emm<-emmeans(Photo_Mcap_model,  ~ Clade*Treatment*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

   #T1 only
  PR.df_B_Mcap.T1<-subset(PR.df_B_Mcap, Time.Point=="T1")
      PR.df_B_Mcap_model.T1<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.T1)
  anova(PR.df_B_Mcap_model.T1) 
    PR.df_B_Mcap_model.T1<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.T1)
  anova(PR.df_B_Mcap_model.T1) 
  qqPlot(residuals(PR.df_B_Mcap_model.T1)) 
  emm<-emmeans(PR.df_B_Mcap_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Mcap.TF<-subset(PR.df_B_Mcap, Time.Point=="TF")
  PR.df_B_Mcap_model.TF<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.TF)
  anova(PR.df_B_Mcap_model.TF) 
  PR.df_B_Mcap_model.TF<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.TF)
  anova(PR.df_B_Mcap_model.TF) 
  qqPlot(residuals(PR.df_B_Mcap_model.TF)) 
  emm<-emmeans(PR.df_B_Mcap_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
  
  
  
#mcap-C only
  Photo_Mcap_model.C<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap.C)
  anova(Photo_Mcap_model.C) 
  qqPlot(residuals(Photo_Mcap_model.C)) 
    emm<-emmeans(Photo_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  Photo_Mcap_model.CD<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap.CD)
  anova(Photo_Mcap_model.CD) 
  qqPlot(residuals(Photo_Mcap_model.CD)) 
    emm<-emmeans(Photo_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
####Pcomp ####
#lmer 
Photo_Pcomp_model<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(Photo_Pcomp_model) 
  qqPlot(residuals(Photo_Pcomp_model)) 
  emm<-emmeans(Photo_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Photo_Pcomp_model.Clade<-lmer(Photo~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(Photo_Pcomp_model.Clade) 
  qqPlot(residuals(Photo_Pcomp_model.Clade)) 
  emm<-emmeans(Photo_Pcomp_model.Clade,  ~ Treatment*Clade|Time.Point, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
     #T1 only
  PR.df_B_Pcomp.T1<-subset(PR.df_B_Pcomp, Time.Point=="T1")
   PR.df_B_Pcomp_model.T1<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.T1)
  anova(PR.df_B_Pcomp_model.T1) 
    PR.df_B_Pcomp_model.T1<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.T1)
  anova(PR.df_B_Pcomp_model.T1) 
  qqPlot(residuals(PR.df_B_Pcomp_model.T1)) 
  emm<-emmeans(PR.df_B_Pcomp_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pcomp.TF<-subset(PR.df_B_Pcomp, Time.Point=="TF")
  PR.df_B_Pcomp_model.TF<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.TF)
  anova(PR.df_B_Pcomp_model.TF) 
  PR.df_B_Pcomp_model.TF<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.TF)
  anova(PR.df_B_Pcomp_model.TF) 
  qqPlot(residuals(PR.df_B_Pcomp_model.TF)) 
  emm<-emmeans(PR.df_B_Pcomp_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
    
#Pcomp-C15cj only
  Photo_Pcomp_model.C15cj<-1-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp.C15cj)
  anova(Photo_Pcomp_model.C15cj) 
  qqPlot(residuals(Photo_Pcomp_model.C15cj)) 
    emm<-emmeans(Photo_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C27 only
  Photo_Pcomp_model.C15n<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp.C15n)
  anova(Photo_Pcomp_model.C15n) 
  qqPlot(residuals(Photo_Pcomp_model.C15n)) 
    emm<-emmeans(Photo_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#####Pvar ####
#lmer
    Photo_Pvar_model<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar)
  anova(Photo_Pvar_model) 
    emm<-emmeans(Photo_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Photo_Pvar_model<-lmer(Photo~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar)
  anova(Photo_Pvar_model) 
  qqPlot(residuals(Photo_Pvar_model)) 
  emm<-emmeans(Photo_Pvar_model,  ~ Treatment*Clade|Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

   #T1 only
  PR.df_B_Pvar.T1<-subset(PR.df_B_Pvar, Time.Point=="T1")
      PR.df_B_Pvar_model.T1<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.T1)
  anova(PR.df_B_Pvar_model.T1) 
    PR.df_B_Pvar_model.T1<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.T1)
  anova(PR.df_B_Pvar_model.T1) 
  qqPlot(residuals(PR.df_B_Pvar_model.T1)) 
  emm<-emmeans(PR.df_B_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pvar.TF<-subset(PR.df_B_Pvar, Time.Point=="TF")
PR.df_B_Pvar_model.TF<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.TF)
  anova(PR.df_B_Pvar_model.TF) 
  PR.df_B_Pvar_model.TF<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.TF)
  anova(PR.df_B_Pvar_model.TF) 
  qqPlot(residuals(PR.df_B_Pvar_model.TF)) 
  emm<-emmeans(PR.df_B_Pvar_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
#Pvar-C only
  Photo_Pvar_model.C1<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar.C1)
  anova(Photo_Pvar_model.C1) 
  qqPlot(residuals(Photo_Pvar_model.C1)) 
    emm<-emmeans(Photo_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-CD only
  Photo_Pvar_model.C27<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar.C27)
  anova(Photo_Pvar_model.C27) 
  qqPlot(residuals(Photo_Pvar_model.C27)) 
    emm<-emmeans(Photo_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#####Pacu ####
#lmer
    Photo_Pacu_model<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu)
  anova(Photo_Pacu_model) 
  emm<-emmeans(Photo_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Photo_Pacu_model<-lmer(Photo~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu)
  anova(Photo_Pacu_model) 
  qqPlot(residuals(Photo_Pacu_model)) 
  emm<-emmeans(Photo_Pacu_model,  ~ Treatment*Clade|Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

   #T1 only
  PR.df_B_Pacu.T1<-subset(PR.df_B_Pacu, Time.Point=="T1")
      PR.df_B_Pacu_model.T1<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.T1)
  anova(PR.df_B_Pacu_model.T1)
    PR.df_B_Pacu_model.T1<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.T1)
  anova(PR.df_B_Pacu_model.T1) 
  qqPlot(residuals(PR.df_B_Pacu_model.T1)) 
  emm<-emmeans(PR.df_B_Pacu_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pacu.TF<-subset(PR.df_B_Pacu, Time.Point=="TF")
  PR.df_B_Pacu_model.TF<-lmer(Photo~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.TF)
  anova(PR.df_B_Pacu_model.TF) 
  PR.df_B_Pacu_model.TF<-lmer(Photo~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.TF)
  anova(PR.df_B_Pacu_model.TF) 
  qqPlot(residuals(PR.df_B_Pacu_model.TF)) 
  emm<-emmeans(PR.df_B_Pacu_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#Pacu-CCC only
  Photo_Pacu_model.CCC<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu.CCC)
  anova(Photo_Pacu_model.CCC) 
  qqPlot(residuals(Photo_Pacu_model.CCC)) 
    emm<-emmeans(Photo_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  Photo_Pacu_model.C42<-lmer(Photo~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu.C42)
  anova(Photo_Pacu_model.C42) 
  qqPlot(residuals(Photo_Pacu_model.C42)) 
    emm<-emmeans(Photo_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
    
```
Respiration
```{r}   
Resp_mean <- ddply(PR.df_B, c("Treatment", "Species", "Time.Point"), summarise, #summarize cell counts
                   N    = length(Resp[!is.na(Resp)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Resp, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Resp, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Resp, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Resp_mean #display table
 
# divide by species
Mcap_Resp_mean<-subset(Resp_mean, Species =="Montipora_capitata")
Pcomp_Resp_mean<-subset(Resp_mean, Species =="Porites_compressa")
Pvar_Resp_mean<-subset(Resp_mean, Species =="Pavona_varians")
Pacu_Resp_mean<-subset(Resp_mean, Species =="Pocillopora_acuta")

#Mcap plot

Mcap_Resp_plot<-ggplot(data=Mcap_Resp_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Mcap Resp")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Resp_plot


#Pcomp plot

Pcomp_Resp_plot<-ggplot(data=Pcomp_Resp_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  ggtitle("Pcomp Resp")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Resp_plot

#Pvar plot

Pvar_Resp_plot<-ggplot(data=Pvar_Resp_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  ggtitle("Pvar Resp")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Resp_plot

#Pacu plot

Pacu_Resp_plot<-ggplot(data=Pacu_Resp_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  ggtitle("Pacu Resp")+
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Resp_plot

```

Plots by Clades
```{r}
#t0 only
PR.df_BPR.df_B.T0_mean <- ddply(PR.df_BPR.df_B.T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(Resp[!is.na(Resp)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(Resp, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Resp, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Resp, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PR.df_BPR.df_B.T0_mean 


#plot all
Resp_T0_mean_plot<-ggplot(data=PR.df_BPR.df_B.T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Respiration"))) +
  ggtitle("Respiration T0")+
  theme(plot.title = element_text(size=20, face = "italic"));Resp_T0_mean_plot


#TFH only####
Resp_TFH<-subset(PR.df_B, Time.Point=="TF"&Treatment=="High") #Subset Pvar
Resp_TFH_mean <- ddply(Resp_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(Resp[!is.na(Resp)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(Resp, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(Resp, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(Resp, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Resp_TFH_mean

#plot all
Resp_TFH_plot<-ggplot(data=Resp_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("Resp"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));Resp_TFH_plot


 Resp_mean <- ddply(PR.df_B, c("Treatment", "Species", "Time.Point"), summarise, #summarize cell counts
                   N    = length(Resp[!is.na(Resp)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Resp, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Resp, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Resp, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Resp_mean#display table




Resp_mean.Clade <- ddply(PR.df_B, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize cell counts
                   N    = length(Resp[!is.na(Resp)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(Resp, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(Resp, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(Resp, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
Resp_mean.Clade #display table

# divide by species
Mcap_Resp_mean.Clade<-subset(Resp_mean.Clade, Species =="Montipora_capitata")
  Mcap_Resp_mean.Clade$Code<-paste(Mcap_Resp_mean.Clade$Clade, Mcap_Resp_mean.Clade$Treatment)
Pcomp_Resp_mean.Clade<-subset(Resp_mean.Clade, Species =="Porites_compressa")
  Pcomp_Resp_mean.Clade$Code<-paste(Pcomp_Resp_mean.Clade$Clade, Pcomp_Resp_mean.Clade$Treatment)
Pvar_Resp_mean.Clade<-subset(Resp_mean.Clade, Species =="Pavona_varians")
  Pvar_Resp_mean.Clade$Code<-paste(Pvar_Resp_mean.Clade$Clade, Pvar_Resp_mean.Clade$Treatment)
Pacu_Resp_mean.Clade<-subset(Resp_mean.Clade, Species =="Pocillopora_acuta")
  Pacu_Resp_mean.Clade$Code<-paste(Pacu_Resp_mean.Clade$Clade, Pacu_Resp_mean.Clade$Treatment)


library(RColorBrewer)

#Mcap by clade
Mcap_Resp_mean.Clade$Code<-paste(Mcap_Resp_mean.Clade$Treatment,Mcap_Resp_mean.Clade$Clade)

Mcap_Resp_plot.Clade<-ggplot(data=Mcap_Resp_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3", "blue","darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(), 
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Mcap Respiration")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_Resp_plot.Clade


#Pcomp by clade
Pcomp_Resp_mean.Clade$Code<-paste(Pcomp_Resp_mean.Clade$Treatment,Pcomp_Resp_mean.Clade$Clade)

Pcomp_Resp_plot.Clade<-ggplot(data=Pcomp_Resp_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pcomp Respiration")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_Resp_plot.Clade

#Pvar by clade
Pvar_Resp_mean.Clade$Code<-paste(Pvar_Resp_mean.Clade$Treatment,Pvar_Resp_mean.Clade$Clade)

Pvar_Resp_plot.Clade<-ggplot(data=Pvar_Resp_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pvar Respiration")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_Resp_plot.Clade

#Pacu by clade
Pacu_Resp_mean.Clade$Code<-paste(Pacu_Resp_mean.Clade$Treatment,Pacu_Resp_mean.Clade$Clade)

Pacu_Resp_plot.Clade<-ggplot(data=Pacu_Resp_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pacu Respiration")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_Resp_plot.Clade

Mcap_Resp_plot.Clade<-Mcap_Resp_plot.Clade+ theme(legend.position = "none") #remove legend
Pcomp_Resp_plot.Clade<-Pcomp_Resp_plot.Clade+ theme(legend.position = "none") #remove legend
Pvar_Resp_plot.Clade<-Pvar_Resp_plot.Clade+ theme(legend.position = "none") #remove legend
Pacu_Resp_plot.Clade<-Pacu_Resp_plot.Clade+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_Resp_plot.Clade, Pcomp_Resp_plot.Clade, Pvar_Resp_plot.Clade,Pacu_Resp_plot.Clade, nrow = 1)



```
R Plots together 
```{r} 
###### All plots together
Mcap_Resp_plot<-Mcap_Resp_plot+ theme(legend.position = "none") #remove legend
Pcomp_Resp_plot<-Pcomp_Resp_plot+ theme(legend.position = "none") #remove legend
Pvar_Resp_plot<-Pvar_Resp_plot+ theme(legend.position = "none") #remove legend
Pacu_Resp_plot<-Pacu_Resp_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_Resp_plot, Pcomp_Resp_plot, Pvar_Resp_plot,Pacu_Resp_plot, nrow = 1)

```
Resp stats
```{r}  
#df PR.df_B 
 
hist(PR.df_B$Resp) #normal

#t0
Resp_stats_T0<-subset(PR.df_B, Time.Point=="T0")
hist (Resp_stats_T0$Resp) 

#t0 only
Resp_stats_T0_model<-lmer(Resp~Treatment*Species+(1|Tank.num), Resp_stats_T0)
anova(Resp_stats_T0_model)  #species differ
qqPlot(residuals(Resp_stats_T0_model)) 
emm<-emmeans(Resp_stats_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)


#t0 only by speices?
Resp_stats_T0.mcap<-subset(Resp_stats_T0, Species=="Montipora_capitata")
Resp_stats_T0.pcomp<-subset(Resp_stats_T0, Species=="Porites_compressa")
Resp_stats_T0.pvar<-subset(Resp_stats_T0, Species=="Pavona_varians")
Resp_stats_T0.pacu<-subset(Resp_stats_T0, Species=="Pocillopora_acuta")

#mcap
Resp_T0_model<-lmer(Resp~Clade+(1|Tank.num), Resp_stats_T0.mcap)
anova(Resp_T0_model)  #species differ
qqPlot(residuals(Resp_T0_model)) 
emm<-emmeans(Resp_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
Resp_T0_model<-lmer(Resp~Clade+(1|Tank.num), Resp_stats_T0.pcomp)
anova(Resp_T0_model)  #species differ
qqPlot(residuals(Resp_T0_model)) 
emm<-emmeans(Resp_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
Resp_T0_model<-lmer(Resp~Clade+(1|Tank.num), Resp_stats_T0.pvar)
anova(Resp_T0_model)  #species differ
qqPlot(residuals(Resp_T0_model)) 
emm<-emmeans(Resp_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
Resp_T0_model<-lmer(Resp~Clade+(1|Tank.num), Resp_stats_T0.pacu)
anova(Resp_T0_model)  #species differ
qqPlot(residuals(Resp_T0_model)) 
emm<-emmeans(Resp_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)
#T1TF####
#lmer
Resp_stats_model<-lmer(Resp~Time.Point*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B)
anova(Resp_stats_model) 
qqPlot(residuals(Resp_stats_model)) 

Resp_stats_modelC<-lmer(Resp~Time.Point*Treatment*Species*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B)
anova(Resp_stats_modelC) 

emm<-emmeans(Resp_stats_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
 cld(emm)
 pairs(emm)
   
#mcap #### 
#lmer
 Resp_Mcap_model<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(Resp_Mcap_model) 
Resp_Mcap_model<-lmer(Resp~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(Resp_Mcap_model) 
  qqPlot(residuals(Resp_Mcap_model)) 
  emm<-emmeans(Resp_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  Resp_Mcap_model<-lmer(Resp~Time.Point*Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(Resp_Mcap_model) 
  qqPlot(residuals(Resp_Mcap_model)) 
  emm<-emmeans(Resp_Mcap_model,  ~ Clade*Treatment*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

   #T1 only
      PR.df_B_Mcap_model.T1<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.T1)
  anova(PR.df_B_Mcap_model.T1) 
    PR.df_B_Mcap_model.T1<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.T1)
  anova(PR.df_B_Mcap_model.T1) 
  qqPlot(residuals(PR.df_B_Mcap_model.T1)) 
  emm<-emmeans(PR.df_B_Mcap_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm) 
  pairs(emm)
  
  #TF only
    PR.df_B_Mcap_model.TF<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.TF)
  anova(PR.df_B_Mcap_model.TF) 
  PR.df_B_Mcap_model.TF<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.TF)
  anova(PR.df_B_Mcap_model.TF) 
  qqPlot(residuals(PR.df_B_Mcap_model.TF)) 
  emm<-emmeans(PR.df_B_Mcap_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#mcap-C only
  Resp_Mcap_model.C<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap.C)
  anova(Resp_Mcap_model.C) 
  qqPlot(residuals(Resp_Mcap_model.C)) 
    emm<-emmeans(Resp_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  Resp_Mcap_model.CD<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap.CD)
  anova(Resp_Mcap_model.CD) 
  qqPlot(residuals(Resp_Mcap_model.CD)) 
    emm<-emmeans(Resp_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
######Pcomp ####
#lmer
Resp_Pcomp_model<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(Resp_Pcomp_model) 
  qqPlot(residuals(Resp_Pcomp_model)) 
  emm<-emmeans(Resp_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Resp_Pcomp_model.Clade<-lmer(Resp~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(Resp_Pcomp_model.Clade) 
  qqPlot(residuals(Resp_Pcomp_model.Clade)) 
  emm<-emmeans(Resp_Pcomp_model.Clade,  ~ Treatment*Clade*Time.Point, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
  #T1 only
        PR.df_B_Pcomp_model.T1<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.T1)
  anova(PR.df_B_Pcomp_model.T1) 
    PR.df_B_Pcomp_model.T1<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.T1)
  anova(PR.df_B_Pcomp_model.T1) 
  qqPlot(residuals(PR.df_B_Pcomp_model.T1)) 
  emm<-emmeans(PR.df_B_Pcomp_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pcomp_model.TF<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.TF)
  anova(PR.df_B_Pcomp_model.TF) 
  PR.df_B_Pcomp_model.TF<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.TF)
  anova(PR.df_B_Pcomp_model.TF) 
  qqPlot(residuals(PR.df_B_Pcomp_model.TF)) 
  emm<-emmeans(PR.df_B_Pcomp_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)      
    
#Pcomp-C15cj only
  Resp_Pcomp_model.C15cj<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp.C15cj)
  anova(Resp_Pcomp_model.C15cj) 
  qqPlot(residuals(Resp_Pcomp_model.C15cj)) 
    emm<-emmeans(Resp_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C27 only
  Resp_Pcomp_model.C15n<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp.C15n)
  anova(Resp_Pcomp_model.C15n) 
  qqPlot(residuals(Resp_Pcomp_model.C15n)) 
    emm<-emmeans(Resp_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#####Pvar ####
#lmer
Resp_Pvar_model<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar)
  anova(Resp_Pvar_model) 
  qqPlot(residuals(Resp_Pvar_model)) 
  emm<-emmeans(Resp_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

Resp_Pvar_model<-lmer(Resp~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar)
  anova(Resp_Pvar_model) 
  qqPlot(residuals(Resp_Pvar_model)) 
  emm<-emmeans(Resp_Pvar_model,  ~ Treatment*Clade*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
   #T1 only
     PR.df_B_Pvar_model.T1<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.T1)
  anova(PR.df_B_Pvar_model.T1)
    PR.df_B_Pvar_model.T1<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.T1)
  anova(PR.df_B_Pvar_model.T1) 
  qqPlot(residuals(PR.df_B_Pvar_model.T1)) 
  emm<-emmeans(PR.df_B_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
     
    PR.df_B_Pvar_model.TF<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.TF)
  anova(PR.df_B_Pvar_model.TF) 
  PR.df_B_Pvar_model.TF<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.TF)
  anova(PR.df_B_Pvar_model.TF) 
  qqPlot(residuals(PR.df_B_Pvar_model.TF)) 
  emm<-emmeans(PR.df_B_Pvar_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
    
  
#Pvar-C1 only
  Resp_Pvar_model.C1<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar.C1)
  anova(Resp_Pvar_model.C1) 
  qqPlot(residuals(Resp_Pvar_model.C1)) 
    emm<-emmeans(Resp_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  Resp_Pvar_model.C27<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar.C27)
  anova(Resp_Pvar_model.C27) 
  qqPlot(residuals(Resp_Pvar_model.C27)) 
    emm<-emmeans(Resp_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

#####Pacu ####
#lmer
Resp_Pacu_model<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu)
  anova(Resp_Pacu_model) 
  qqPlot(residuals(Resp_Pacu_model)) 
  emm<-emmeans(Resp_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
Resp_Pacu_model<-lmer(Resp~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu)
  anova(Resp_Pacu_model) 
  qqPlot(residuals(Resp_Pacu_model)) 
  emm<-emmeans(Resp_Pacu_model,  ~ Treatment*Clade*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm) 
 
   #T1 only
      PR.df_B_Pacu_model.T1<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.T1)
  anova(PR.df_B_Pacu_model.T1) 
    PR.df_B_Pacu_model.T1<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.T1)
  anova(PR.df_B_Pacu_model.T1) 
  qqPlot(residuals(PR.df_B_Pacu_model.T1)) 
  emm<-emmeans(PR.df_B_Pacu_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pacu_model.TF<-lmer(Resp~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.TF)
  anova(PR.df_B_Pacu_model.TF) 
  PR.df_B_Pacu_model.TF<-lmer(Resp~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.TF)
  anova(PR.df_B_Pacu_model.TF) 
  qqPlot(residuals(PR.df_B_Pacu_model.TF)) 
  emm<-emmeans(PR.df_B_Pacu_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
   
#Pacu-CCC only
  Resp_Pacu_model.CCC<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu.CCC)
  anova(Resp_Pacu_model.CCC) 
  qqPlot(residuals(Resp_Pacu_model.CCC)) 
    emm<-emmeans(Resp_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  Resp_Pacu_model.C42<-lmer(Resp~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu.C42)
  anova(Resp_Pacu_model.C42) 
  qqPlot(residuals(Resp_Pacu_model.C42)) 
    emm<-emmeans(Resp_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
    
```

P:R
```{r}   

#t0 only
PR.df_PR_B.T0_mean <- ddply(PR.df_BPR.df_B.T0, c( "Species"), summarise, #summarize cell counts
                 N    = length(PR[!is.na(PR)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(PR, na.rm=TRUE), #calculate mean of response variable, removing NA's
                 sd   = sd(PR, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(PR, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PR.df_PR_B.T0_mean 


#plot all
PR_T0_mean_plot<-ggplot(data=PR.df_PR_B.T0_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  #xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("PR"))) +
  ggtitle("PR T0")+
  theme(plot.title = element_text(size=20, face = "italic"));PR_T0_mean_plot


#TFH only####
PR_TFH<-subset(PR.df_B, Time.Point=="TF"&Treatment=="High") #Subset Pvar
PR_TFH_mean <- ddply(PR_TFH, c( "Species"), summarise, #summarize cell counts
                 N    = length(PR[!is.na(PR)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                 mean = mean(PR, na.rm=TRUE), #calculate mean of PRonse variable, removing NA's
                 sd   = sd(PR, na.rm=TRUE), #calculate standard deviation
                 se   = sd / sqrt(N), #calculate standard error
                 max = max(PR, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PR_TFH_mean

#plot all
PR_TFH_plot<-ggplot(data=PR_TFH_mean, aes(x=Species, y=mean, group = Species, color=Species)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = F)+
  geom_point(aes(color=Species), size=4, show.legend = T)+
  geom_line(aes(color=Species), linetype=2, show.legend = T)+
  #scale_color_manual(values=c("dodgerblue3", "darkred"))+
  xlab("mg.mm2") + #Label the X Axis
  #ylim(0, 11) + #set Y limits
  #scale_y_log10()+
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("PR"))) +
  ggtitle("Time F, High only")+
  theme(plot.title = element_text(size=20, face = "italic"));PR_TFH_plot



### by speices ###
PR_mean <-  ddply(PR.df_B, c("Treatment", "Species", "Time.Point"), summarise, #summarize cell counts
                    N    = length(PR[!is.na(PR)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(PR, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(PR, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(PR, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PR_mean #display table

# divide by species
Mcap_PR_mean<-subset(PR_mean, Species =="Montipora_capitata")
Pcomp_PR_mean<-subset(PR_mean, Species =="Porites_compressa")
Pvar_PR_mean<-subset(PR_mean, Species =="Pavona_varians")
Pacu_PR_mean<-subset(PR_mean, Species =="Pocillopora_acuta")

#Mcap plot

Mcap_PR_plot<-ggplot(data=Mcap_PR_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1))+
        theme(aspect.ratio=1)+
  ylab(expression(paste("umol/sec/cm2"))) +
  ggtitle("Mcap PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_PR_plot


#Pcomp plot

Pcomp_PR_plot<-ggplot(data=Pcomp_PR_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pcomp PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_PR_plot

#Pvar plot

Pvar_PR_plot<-ggplot(data=Pvar_PR_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pvar PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_PR_plot

#Pacu plot

Pacu_PR_plot<-ggplot(data=Pacu_PR_mean, aes(x=Time.Point, y=mean, group = Treatment, color=Treatment)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
                width=0.1, show.legend = T)+
  geom_point(aes(color=Treatment), size=4, show.legend = T)+  
  geom_line(aes(color=Treatment),linetype="dotted")+
  scale_color_manual(values=c("dodgerblue3", "darkred"))+
   geom_point(shape = 1,size = 4,colour = "black")+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pacu PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_PR_plot
 
```
PR Plots together
```{r}
###### All plots together
Mcap_PR_plot<-Mcap_PR_plot+ theme(legend.position = "none") #remove legend
Pcomp_PR_plot<-Pcomp_PR_plot+ theme(legend.position = "none") #remove legend
Pvar_PR_plot<-Pvar_PR_plot+ theme(legend.position = "none") #remove legend
Pacu_PR_plot<-Pacu_PR_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_PR_plot, Pcomp_PR_plot, Pvar_PR_plot,Pacu_PR_plot, nrow = 1)

```
Plots by Clades
```{r} 
#Mcap
PR_mean.Clade <- ddply(PR.df_B, c("Treatment", "Species", "Time.Point","Clade"), summarise, #summarize cell counts
                   N    = length(PR[!is.na(PR)]), #calculate the length of the data frame, excluding NA’s *this part is important*
                   mean = mean(PR, na.rm=TRUE), #calculate mean of response variable, removing NA's
                   sd   = sd(PR, na.rm=TRUE), #calculate standard deviation
                   se   = sd / sqrt(N), #calculate standard error
                   max = max(PR, na.rm=TRUE) #calculate max, could also calculate min () if desired
)
PR_mean.Clade #display table

# divide by species
Mcap_PR_mean.Clade<-subset(PR_mean.Clade, Species =="Montipora_capitata")
  Mcap_PR_mean.Clade$Code<-paste(Mcap_PR_mean.Clade$Clade, Mcap_PR_mean.Clade$Treatment)
Pcomp_PR_mean.Clade<-subset(PR_mean.Clade, Species =="Porites_compressa")
  Pcomp_PR_mean.Clade$Code<-paste(Pcomp_PR_mean.Clade$Clade, Pcomp_PR_mean.Clade$Treatment)
Pvar_PR_mean.Clade<-subset(PR_mean.Clade, Species =="Pavona_varians")
  Pvar_PR_mean.Clade$Code<-paste(Pvar_PR_mean.Clade$Clade, Pvar_PR_mean.Clade$Treatment)
Pacu_PR_mean.Clade<-subset(PR_mean.Clade, Species =="Pocillopora_acuta")
  Pacu_PR_mean.Clade$Code<-paste(Pacu_PR_mean.Clade$Clade, Pacu_PR_mean.Clade$Treatment)


library(RColorBrewer)

#Mcap by clade

#Mcap by clade
Mcap_PR_mean.Clade$Code<-paste(Mcap_PR_mean.Clade$Treatment,Mcap_PR_mean.Clade$Clade)

Mcap_PR_plot.Clade<-ggplot(data=Mcap_PR_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Mcap PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Mcap_PR_plot.Clade

#Pcomp by clade
Pcomp_PR_mean.Clade$Code<-paste(Pcomp_PR_mean.Clade$Treatment,Pcomp_PR_mean.Clade$Clade)

Pcomp_PR_plot.Clade<-ggplot(data=Pcomp_PR_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pcomp PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pcomp_PR_plot.Clade


#Pvar by clade
Pvar_PR_mean.Clade$Code<-paste(Pvar_PR_mean.Clade$Treatment,Pvar_PR_mean.Clade$Clade)

Pvar_PR_plot.Clade<-ggplot(data=Pvar_PR_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pvar PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pvar_PR_plot.Clade

#Pacu by clade
Pacu_PR_mean.Clade$Code<-paste(Pacu_PR_mean.Clade$Treatment,Pacu_PR_mean.Clade$Clade)

Pacu_PR_plot.Clade<-ggplot(data=Pacu_PR_mean.Clade, aes(x=Time.Point, y=mean, group = Code, color=Code)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se),
            width=0.1, show.legend = T)+
  geom_point(aes(color=Code), size=4, show.legend = T)+ 
  geom_line(aes(linetype=Clade, color=Code))+
    scale_linetype_manual(values=c("twodash", "dotted"))+
  scale_color_manual(values=c("dodgerblue3","blue", "darkred","red"))+
  xlab("Time Point") + #Label the X Axis
  theme_bw() + #Set the background color
  theme(axis.line = element_line(color = 'black'), #Set the axes color
        axis.title=element_text(size=14,face="bold"), #Set axis format
        panel.border = element_blank(), #Set the border 
        panel.grid.major = element_blank(), #Set the major gridlines
        panel.grid.minor = element_blank(), #Set the minor gridlines
        text = element_text(size=18),  # set element text
        plot.background =element_blank(), #Set the plot background
        legend.key = element_blank()) + #Set plot legend key
  ylab(expression(paste("umol/sec/cm2"))) +
theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=2))+
        theme(aspect.ratio=1)+
  ggtitle("Pacu PR")+
  theme(plot.title = element_text(size=20, face = "italic", hjust=0.5));Pacu_PR_plot.Clade



Mcap_PR_plot.Clade<-Mcap_PR_plot.Clade+ theme(legend.position = "none") #remove legend
Pcomp_PR_plot.Clade<-Pcomp_PR_plot.Clade+ theme(legend.position = "none") #remove legend
Pvar_PR_plot.Clade<-Pvar_PR_plot.Clade+ theme(legend.position = "none") #remove legend
Pacu_PR_plot.Clade<-Pacu_PR_plot.Clade+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_PR_plot.Clade, Pcomp_PR_plot.Clade, Pvar_PR_plot.Clade,Pacu_PR_plot.Clade, nrow = 1)

```

PR stats 
```{r}   
#df PR.df_B 

hist(PR.df_B$PR) #fube
# PR.df_B$PR_log<-log10(PR.df_B$PR+1)
# hist(PR.df_B$PR_log) #
# PR.df_B$PR_sqrt<-sqrt(PR.df_B$PR)
# hist(PR.df_B$PR_sqrt) #
# PR.df_B$PR_cubR<-PR.df_B$PR^(1/3)  #USE
# hist(PR.df_B$PR_cubR) #

#t0
PR_stats_T0<-subset(PR.df_B, Time.Point=="T0")
hist (PR_stats_T0$PR) 

#t0 only
PR_stats_T0_model<-lmer(PR~Treatment*Species+(1|Tank.num), PR_stats_T0)
anova(PR_stats_T0_model)  #species differ
qqPlot(residuals(PR_stats_T0_model)) 
emm<-emmeans(PR_stats_T0_model,  ~ Species, adjust="Tukey")
cld(emm)
pairs(emm)
emm<-emmeans(PR_stats_T0_model,  ~ Species*Treatment, adjust="Tukey")
cld(emm)
pairs(emm)
 

#t0 only by speices?
PR_stats_T0.mcap<-subset(PR_stats_T0, Species=="Montipora_capitata")
PR_stats_T0.pcomp<-subset(PR_stats_T0, Species=="Porites_compressa")
PR_stats_T0.pvar<-subset(PR_stats_T0, Species=="Pavona_varians")
PR_stats_T0.pacu<-subset(PR_stats_T0, Species=="Pocillopora_acuta")

#mcap
PR_T0_model<-lmer(PR~Clade+(1|Tank.num), PR_stats_T0.mcap)
anova(PR_T0_model)  #species differ
qqPlot(residuals(PR_T0_model)) 
emm<-emmeans(PR_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pcomp
PR_T0_model<-lmer(PR~Clade+(1|Tank.num), PR_stats_T0.pcomp)
anova(PR_T0_model)  #species differ
qqPlot(residuals(PR_T0_model)) 
emm<-emmeans(PR_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pvar
PR_T0_model<-lmer(PR~Clade+(1|Tank.num), PR_stats_T0.pvar)
anova(PR_T0_model)  #species differ
qqPlot(residuals(PR_T0_model)) 
emm<-emmeans(PR_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)

#pacu
PR_T0_model<-lmer(PR~Clade+(1|Tank.num), PR_stats_T0.pacu)
anova(PR_T0_model)  #species differ
qqPlot(residuals(PR_T0_model)) 
emm<-emmeans(PR_T0_model,  ~ Clade, adjust="Tukey")
cld(emm)
pairs(emm)




PR.df_B_Mcap<-subset(PR.df_B, Species=="Montipora_capitata")
PR.df_B_Pcomp<-subset(PR.df_B, Species=="Porites_compressa")
PR.df_B_Pvar<-subset(PR.df_B, Species=="Pavona_varians")
PR.df_B_Pacu<-subset(PR.df_B, Species=="Pocillopora_acuta")

# by Species df: PR.df_B_Mcap, PR.df_B_Pcomp, PR.df_B_Pvar, PR.df_B_Pacu
PR.df_B_Mcap<-subset(PR.df_B, Species=="Montipora_capitata")
  PR.df_B_Mcap.C<-subset(PR.df_B_Mcap, Clade=="C")
  PR.df_B_Mcap.CD<-subset(PR.df_B_Mcap, Clade=="CD")
PR.df_B_Pcomp<-subset(PR.df_B, Species=="Porites_compressa")
  PR.df_B_Pcomp.C15cj<-subset(PR.df_B_Pcomp, Clade=="C15cj")
  PR.df_B_Pcomp.C15n<-subset(PR.df_B_Pcomp, Clade=="C15n")
PR.df_B_Pvar<-subset(PR.df_B, Species=="Pavona_varians")
  PR.df_B_Pvar.C1<-subset(PR.df_B_Pvar, Clade=="C1")
  PR.df_B_Pvar.C27<-subset(PR.df_B_Pvar, Clade=="C27")
PR.df_B_Pacu<-subset(PR.df_B, Species=="Pocillopora_acuta")
  PR.df_B_Pacu.CCC<-subset(PR.df_B_Pacu, Clade=="CCC")
  PR.df_B_Pacu.C42<-subset(PR.df_B_Pacu, Clade=="C42")




#lmer
PR_stats_model<-lmer(PR~Time.Point*Treatment*Species+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B)
anova(PR_stats_model) 
qqPlot(residuals(PR_stats_model)) 

PR_stats_modelC<-lmer(PR~Time.Point*Treatment*Species*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B)
anova(PR_stats_modelC) 

emm<-emmeans(PR_stats_model,  ~ Time.Point*Treatment|Species, adjust="Tukey")
 cld(emm)
 pairs(emm)
  
#mcap ####
#lmer
  PR_Mcap_model<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(PR_Mcap_model) 
 PR_Mcap_model<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(PR_Mcap_model) 
    emm<-emmeans(PR_Mcap_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
PR_Mcap_model<-lmer(PR~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap)
  anova(PR_Mcap_model) 
  qqPlot(residuals(PR_Mcap_model)) 
  emm<-emmeans(PR_Mcap_model,  ~ Clade*Treatment*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm) 

 #T1 only
      PR.df_B_Mcap_model.T1<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.T1)
  anova(PR.df_B_Mcap_model.T1)
    PR.df_B_Mcap_model.T1<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.T1)
  anova(PR.df_B_Mcap_model.T1) 
  qqPlot(residuals(PR.df_B_Mcap_model.T1)) 
  emm<-emmeans(PR.df_B_Mcap_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Mcap_model.TF<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.TF)
  anova(PR.df_B_Mcap_model.TF) 
  PR.df_B_Mcap_model.TF<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Mcap.TF)
  anova(PR.df_B_Mcap_model.TF) 
  qqPlot(residuals(PR.df_B_Mcap_model.TF)) 
  emm<-emmeans(PR.df_B_Mcap_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
  
#mcap-C only
  PR_Mcap_model.C<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap.C)
  anova(PR_Mcap_model.C) 
  qqPlot(residuals(PR_Mcap_model.C)) 
    emm<-emmeans(PR_Mcap_model.C,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#mcap-CD only
  PR_Mcap_model.CD<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Mcap.CD)
  anova(PR_Mcap_model.CD) 
  qqPlot(residuals(PR_Mcap_model.CD)) 
    emm<-emmeans(PR_Mcap_model.CD,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
########Pcomp ####
#lmer
    PR_Pcomp_model<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(PR_Pcomp_model) 
   emm<-emmeans(PR_Pcomp_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

  
PR_Pcomp_model<-lmer(PR~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(PR_Pcomp_model) 
  qqPlot(residuals(PR_Pcomp_model)) 
  emm<-emmeans(PR_Pcomp_model,  ~ Clade*Treatment*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

PR_Pcomp_model.Clade<-lmer(PR~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp)
  anova(PR_Pcomp_model.Clade) 
  qqPlot(residuals(PR_Pcomp_model.Clade)) 
  emm<-emmeans(PR_Pcomp_model.Clade,  ~ Time.Point*Treatment*Clade, adjust="Tukey")
    cld(emm)
    pairs(emm)
 
  #T1 only
     PR.df_B_Pcomp_model.T1<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.T1)
  anova(PR.df_B_Pcomp_model.T1) 
    PR.df_B_Pcomp_model.T1<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.T1)
  anova(PR.df_B_Pcomp_model.T1) 
  qqPlot(residuals(PR.df_B_Pcomp_model.T1)) 
  emm<-emmeans(PR.df_B_Pcomp_model.T1,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
   PR.df_B_Pcomp_model.TF<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.TF)
  anova(PR.df_B_Pcomp_model.TF)
  PR.df_B_Pcomp_model.TF<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pcomp.TF)
  anova(PR.df_B_Pcomp_model.TF) 
  qqPlot(residuals(PR.df_B_Pcomp_model.TF)) 
  emm<-emmeans(PR.df_B_Pcomp_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
      
    
#Pcomp-C15cj only
  PR_Pcomp_model.C15cj<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp.C15cj)
  anova(PR_Pcomp_model.C15cj) 
  qqPlot(residuals(PR_Pcomp_model.C15cj)) 
    emm<-emmeans(PR_Pcomp_model.C15cj,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pcomp-C27 only
  PR_Pcomp_model.C15n<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pcomp.C15n)
  anova(PR_Pcomp_model.C15n) 
  qqPlot(residuals(PR_Pcomp_model.C15n)) 
    emm<-emmeans(PR_Pcomp_model.C15n,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
#####Pvar ####
#lmer 
    PR_Pvar_model<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar)
  anova(PR_Pvar_model) 
    qqPlot(residuals(PR_Pvar_model)) 
  emm<-emmeans(PR_Pvar_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
PR_Pvar_model<-lmer(PR~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar)
  anova(PR_Pvar_model) 
  qqPlot(residuals(PR_Pvar_model)) 
  emm<-emmeans(PR_Pvar_model,  ~ Treatment*Clade*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

 #T1 only
      PR.df_B_Pvar_model.T1<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.T1)
  anova(PR.df_B_Pvar_model.T1) 
    PR.df_B_Pvar_model.T1<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.T1)
  anova(PR.df_B_Pvar_model.T1) 
  qqPlot(residuals(PR.df_B_Pvar_model.T1)) 
  emm<-emmeans(PR.df_B_Pvar_model.T1,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pvar_model.TF<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.TF)
  anova(PR.df_B_Pvar_model.TF) 
  PR.df_B_Pvar_model.TF<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pvar.TF)
  anova(PR.df_B_Pvar_model.TF) 
  qqPlot(residuals(PR.df_B_Pvar_model.TF)) 
  emm<-emmeans(PR.df_B_Pvar_model.TF,  ~ Clade*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)    
  
#Pvar-C1 only
  PR_Pvar_model.C1<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar.C1)
  anova(PR_Pvar_model.C1) 
  qqPlot(residuals(PR_Pvar_model.C1)) 
    emm<-emmeans(PR_Pvar_model.C1,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pvar-C27 only
  PR_Pvar_model.C27<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pvar.C27)
  anova(PR_Pvar_model.C27) 
  qqPlot(residuals(PR_Pvar_model.C27)) 
    emm<-emmeans(PR_Pvar_model.C27,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)  

 #### Pacu ####
#lmer 
    PR_Pacu_model<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu)
  anova(PR_Pacu_model) 
  qqPlot(residuals(PR_Pacu_model)) 
  emm<-emmeans(PR_Pacu_model,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)

  
PR_Pacu_model<-lmer(PR~Time.Point*Treatment*Clade+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu)
  anova(PR_Pacu_model) 
  qqPlot(residuals(PR_Pacu_model)) 
  emm<-emmeans(PR_Pacu_model,  ~ Treatment*Clade*Time.Point, adjust="Tukey")
  cld(emm)
  pairs(emm)

   #T1 only
    PR.df_B_Pacu_model.T1<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.T1)
  anova(PR.df_B_Pacu_model.T1)
    PR.df_B_Pacu_model.T1<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.T1)
  anova(PR.df_B_Pacu_model.T1) 
  qqPlot(residuals(PR.df_B_Pacu_model.T1)) 
  emm<-emmeans(PR.df_B_Pacu_model.T1,  ~ Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)
  
  #TF only
    PR.df_B_Pacu_model.TF<-lmer(PR~Treatment+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.TF)
  anova(PR.df_B_Pacu_model.TF) 
  PR.df_B_Pacu_model.TF<-lmer(PR~Treatment*Clade+(1|Parent.ID)+(1|Tank.num), PR.df_B_Pacu.TF)
  anova(PR.df_B_Pacu_model.TF) 
  qqPlot(residuals(PR.df_B_Pacu_model.TF)) 
  emm<-emmeans(PR.df_B_Pacu_model.TF,  ~ Time.Point*Treatment, adjust="Tukey")
  cld(emm)
  pairs(emm)  
  
#Pacu-CCC only
  PR_Pacu_model.CCC<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu.CCC)
  anova(PR_Pacu_model.CCC) 
  qqPlot(residuals(PR_Pacu_model.CCC)) 
    emm<-emmeans(PR_Pacu_model.CCC,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)

#Pacu-C42 only
  PR_Pacu_model.C42<-lmer(PR~Time.Point*Treatment+(1|Parent.ID:Frag.ID)+(1|Tank.num), PR.df_B_Pacu.C42)
  anova(PR_Pacu_model.C42) 
  qqPlot(residuals(PR_Pacu_model.C42)) 
    emm<-emmeans(PR_Pacu_model.C42,  ~ Time.Point*Treatment, adjust="Tukey")
    cld(emm)
    pairs(emm)
    
    
```
All P, R, PR plots
```{r}
grid.arrange(Mcap_Photo_plot, Pcomp_Photo_plot, Pvar_Photo_plot,Pacu_Photo_plot,Mcap_Resp_plot, Pcomp_Resp_plot, Pvar_Resp_plot,Pacu_Resp_plot,Mcap_PR_plot, Pcomp_PR_plot, Pvar_PR_plot,Pacu_PR_plot, nrow = 3)

 
#by clade
grid.arrange(Mcap_Photo_plot.Clade, Pcomp_Photo_plot.Clade, Pvar_Photo_plot.Clade,Pacu_Photo_plot.Clade,Mcap_Resp_plot.Clade, Pcomp_Resp_plot.Clade, Pvar_Resp_plot.Clade,Pacu_Resp_plot.Clade,Mcap_PR_plot.Clade, Pcomp_PR_plot.Clade, Pvar_PR_plot.Clade,Pacu_PR_plot.Clade, nrow = 3)

```


#COMBINE all physio dfs
Set these up so they are by PARENT-TREATMENT-TIMEPOINT and average across frag reps
```{r}     
#prep metadata for by Parent.ID df for ordinations
metaPhysio<-subset(meta, select= -X)#remove X from df
metaPhysio<-subset(metaPhysio, select= -Tank.num)#remove tank from df
metaPhysio<-subset(metaPhysio, select= -Frag.ID)#remove tank from df
metaPhysio$Code<-paste(metaPhysio$Species,metaPhysio$Treatment,metaPhysio$Parent.ID, metaPhysio$Time.Point)


#biomass: keep Frag.ID and AFDW.cm2_log
Biomass_psy<- Biomass_stats[,c("Frag.ID","Parent.ID" ,"Species","Treatment","Tank.num","Time.Point","AFDWmg.cm2")] # keep only columns you need
  
# #create duplicate T0 for H or A that isn't there for each parent. ONLY IF YOU WANTT0
#   Biomass_psyT0<-Biomass_psy #copy
#   Biomass_psyT0<-subset(Biomass_psyT0, Time.Point=="T0")
#   Biomass_psyT0Amb<-Biomass_psyT0
#   Biomass_psyT0Amb$Treatment[Biomass_psyT0Amb$Treatment == "High"] <- "Ambient" #change 
#   Biomass_psyT0High<-Biomass_psyT0
#   Biomass_psyT0High$Treatment[Biomass_psyT0High$Treatment == "Ambient"] <- "High" #change 
#   Biomass_psyT02<-rbind(Biomass_psyT0Amb,Biomass_psyT0High) #now oyu have T0 for Amb and High
# 
#   Biomass_psy<-Biomass_psy[!(Biomass_psy$Time.Point=="T0"),] #remove T0s
#   Biomass_psy<-rbind(Biomass_psy,Biomass_psyT02) # add the full T0 dataset
# duplicated(Biomass_psy)
  Biomass_psy$Code<-paste(Biomass_psy$Species,Biomass_psy$Treatment,Biomass_psy$Parent.ID, Biomass_psy$Time.Point)

  Biomass_psy<- Biomass_psy[,c("Code" ,"AFDWmg.cm2")] # keep only columns you need
duplicated(Biomass_psy) #check
Biomass_psy<-unique(Biomass_psy) # remove dups

#cell counts:FC_Data df and keep  Frag.ID and zoox.cm2_log
CellCounts_psy<- FC_Data[,c("Frag.ID","Parent.ID" ,"Species","Treatment","Tank.num","Time.Point","zoox.cm2_log")] # keep only columns you need

# #create duplicate T0 for H or A that isn't there for each parent. id
#   CellCounts_psyT0<-CellCounts_psy #copy
#   CellCounts_psyT0<-subset(CellCounts_psyT0, Time.Point=="T0")
#   CellCounts_psyT0Amb<-CellCounts_psyT0
#   CellCounts_psyT0Amb$Treatment[CellCounts_psyT0Amb$Treatment == "High"] <- "Ambient" #change 
#   CellCounts_psyT0High<-CellCounts_psyT0
#   CellCounts_psyT0High$Treatment[CellCounts_psyT0High$Treatment == "Ambient"] <- "High" #change 
#   CellCounts_psyT02<-rbind(CellCounts_psyT0Amb,CellCounts_psyT0High) #now oyu have T0 for Amb and High
# 
#   CellCounts_psy<-CellCounts_psy[!(CellCounts_psy$Time.Point=="T0"),] #remove T0s
#   CellCounts_psy<-rbind(CellCounts_psy,CellCounts_psyT02) # add the full T0 dataset

  CellCounts_psy$Code<-paste(CellCounts_psy$Species,CellCounts_psy$Treatment,CellCounts_psy$Parent.ID, CellCounts_psy$Time.Point)

  CellCounts_psy<- CellCounts_psy[,c("Code" ,"zoox.cm2_log")] # keep only columns you need

  duplicated(CellCounts_psy)
  CellCounts_psy<-unique(CellCounts_psy) #keep uniques


#Chla Chla df ChlaSA_quart
Chla_psy<- Chla[,c("Parent.ID" ,"Species","Treatment","Time.Point","ChlaSA_quart")] # keep only columns you need
names(Chla_psy)[names(Chla_psy) == "ChlaSA_quart"] <- "Chla_ug.chla.cm2"

# #create duplicate T0 for H or A that isn't there for each parent. id
#   Chla_psyT0<-Chla_psy #copy
#   Chla_psyT0<-subset(Chla_psyT0, Time.Point=="T0")
#   Chla_psyT0Amb<-Chla_psyT0
#   Chla_psyT0Amb$Treatment[Chla_psyT0Amb$Treatment == "High"] <- "Ambient" #change 
#   Chla_psyT0High<-Chla_psyT0
#   Chla_psyT0High$Treatment[Chla_psyT0High$Treatment == "Ambient"] <- "High" #change 
#   Chla_psyT02<-rbind(Chla_psyT0Amb,Chla_psyT0High) #now oyu have T0 for Amb and High
# 
#   Chla_psy<-Chla_psy[!(Chla_psy$Time.Point=="T0"),] #remove T0s
#   Chla_psy<-rbind(Chla_psy,Chla_psyT02) # add the full T0 dataset

  Chla_psy$Code<-paste(Chla_psy$Species,Chla_psy$Treatment,Chla_psy$Parent.ID, Chla_psy$Time.Point)
Chla_psy<- Chla_psy[,c("Code","Chla_ug.chla.cm2")] # keep only columns you need

duplicated(Chla_psy)


#Protein Protein$mg.mm2_sqrt
Protein_psy<- Protein[,c("Parent.ID" ,"Species","Treatment","Time.Point","mg.mm2_sqrt")] # keep only columns you need
names(Protein_psy)[names(Protein_psy) == "mg.mm2_sqrt"] <- "Protein_mg.mm2_sqrt"

# #create duplicate T0 for H or A that isn't there for each parent. id
#   Protein_psyT0<-Protein_psy #copy
#   Protein_psyT0<-subset(Protein_psyT0, Time.Point=="T0")
#   Protein_psyAmb<-Protein_psyT0
#   Protein_psyAmb$Treatment[Protein_psyAmb$Treatment == "High"] <- "Ambient" #change 
#   Protein_psyHigh<-Protein_psyT0
#   Protein_psyHigh$Treatment[Protein_psyHigh$Treatment == "Ambient"] <- "High" #change 
#   Protein_psy2<-rbind(Protein_psyAmb,Protein_psyHigh) #now oyu have T0 for Amb and High
# 
#   Protein_psy<-Protein_psy[!(Protein_psy$Time.Point=="T0"),] #remove T0s
#   Protein_psy<-rbind(Protein_psy,Protein_psy2) # add the full T0 dataset

  Protein_psy$Code<-paste(Protein_psy$Species,Protein_psy$Treatment,Protein_psy$Parent.ID, Protein_psy$Time.Point)
Protein_psy<- Protein_psy[,c("Code","Protein_mg.mm2_sqrt")] # keep only columns you need
duplicated(Protein_psy)

#Repeate measures ####
#Calcification, Growth and percent.change_log do for each time point ####

Calcification_psy<- Growth3 #copy df
Calcification_psy$Time.point<-as.character(Calcification_psy$Time.point)
Calcification_psy$Time.point[Calcification_psy$Time.point == "time1.growth"] <- "T1" #change 
Calcification_psy$Time.point[Calcification_psy$Time.point == "time2.growth"] <- "TF" #change 
Calcification_psy$Time.point<-as.factor(Calcification_psy$Time.point)
 names(Calcification_psy)[names(Calcification_psy) == "Time.point"] <- "Time.Point" #change name

Calcification_psy$Code<-paste(Calcification_psy$Species,Calcification_psy$Treatment,Calcification_psy$Parent.ID,Calcification_psy$Time.Point) #make code

Calcification_psy<- Calcification_psy[,c("Code","percent.change_sqrt","Parent.ID", "Treatment","Species","Time.Point")] # keep only columns you need

# Calcification_psy<-Calcification_psy %>% group_by(Code) %>% mutate(mean=mean(percent.change_sqrt)) # mean by code, this worked
# names(Calcification_psy)[names(Calcification_psy) == "mean"] <- "calc.percentchange" #change name
# Calcification_psy<-Calcification_psy[,c("Code","Parent.ID", "Treatment","Species","calc.percentchange")] #remove col
# Calcification_psy<-unique(Calcification_psy) #remove duplicates, now you have 
 Calcification_psy<-aggregate(x = Calcification_psy$percent.change_sqrt,                # Specify data column
          by = list(Calcification_psy$Code),              # Specify group indicator
          FUN = mean)        
        names(Calcification_psy)[names(Calcification_psy) == "x"] <- "Calcification" #change name
        names(Calcification_psy)[names(Calcification_psy) == "Group.1"] <- "Code" #change name


Calcification_psy<-merge(metaPhysio, Calcification_psy, all.x = T)
Calcification_psy$calc.percentchange[is.na(Calcification_psy$calc.percentchange)] <- 0 #change T0 growth to 0s
Calcification_psy<- Calcification_psy[,c("Code","calc.percentchange")] # keep only columns you need

 
#PAM df PAMdata_stats make for T0, T1, TF ####
PAM_psy<- PAMdata2_stats

PAM_psy$Days<-as.character(PAM_psy$Days)
PAM_psy$Days[PAM_psy$Days == "0"] <- "T0" #change 
PAM_psy$Days[PAM_psy$Days == "24"] <- "T1" #change 
PAM_psy$Days[PAM_psy$Days == "58"] <- "TF" #change 

PAM_psy<-PAM_psy[!(PAM_psy$Days=="17"),] #remove other days by name
PAM_psy<-PAM_psy[!(PAM_psy$Days=="31"),] #remove other days by name
PAM_psy<-PAM_psy[!(PAM_psy$Days=="38"),] #remove other days by name
PAM_psy<-PAM_psy[!(PAM_psy$Days=="45"),] #remove other days by name
PAM_psy<-PAM_psy[!(PAM_psy$Days=="52"),] #remove other days by name

#now you need to figure out the sample 'day' for each parent.id, and subset out only those. 
names(PAM_psy)[names(PAM_psy) == "Days"] <- "Time.Point" #change name

PAM_psy$Code<-paste(PAM_psy$Species,PAM_psy$Treatment,PAM_psy$Parent.ID,PAM_psy$Time.Point) #make code
PAM_psy$Code<-as.factor(PAM_psy$Code)

PAM_psy<- PAM_psy[,c("Code","Yield_cu")] # keep only columns you need
# PAM_psy<-PAM_psy %>% group_by(Code) %>% mutate(mean=mean(Yield_cu)) # mean by code, this worked
# names(PAM_psy)[names(PAM_psy) == "mean"] <- "PAM.Yield_cu" #change name
# PAM_psy<-PAM_psy[,c("Code","Parent.ID", "Treatment","Species","PAM.Yield_cu","Time.Point")] #remove col
# PAM_psy<-unique(PAM_psy) #remove duplicates, now you have 
 
PAM_psy<-aggregate(x = PAM_psy$Yield_cu,                # Specify data column
          by = list(PAM_psy$Code),              # Specify group indicator
          FUN = mean)        
        names(PAM_psy)[names(PAM_psy) == "x"] <- "PAM" #change name
        names(PAM_psy)[names(PAM_psy) == "Group.1"] <- "Code" #change name



# Photosynthesis PR.df_B ####

PR_psy<-PR.df_B
    PR_psy$Code<-paste(PR_psy$Species,PR_psy$Treatment,PR_psy$Parent.ID, PR_psy$Time.Point)
 
  #photo  code stopped working. 
  Photo_psy<- PR_psy[,c("Photo","Code")] 
    # Photo_psy<-Photo_psy %>% group_by(Code) %>% mutate(mean=mean(Photo)) # mean by code, this STOPPED WORKING use below
    # names(Photo_psy)[names(Photo_psy) == "mean"] <- "Photosynthesis" #change name
    # Photo_psy<-Photo_psy[,c("Code","Photosynthesis")] #remove col with uniq
    # Photo_psy<-unique(Photo_psy) #remove duplicates, now you have 
    
  Photo_psy<-aggregate(x = Photo_psy$Photo,                # Specify data column
          by = list(Photo_psy$Code),              # Specify group indicator
          FUN = mean)        
        names(Photo_psy)[names(Photo_psy) == "x"] <- "Photosynthesis" #change name
        names(Photo_psy)[names(Photo_psy) == "Group.1"] <- "Code" #change name

  
   #Resp
   Resp_psy<- PR_psy[,c("Resp","Code")] 
    # Resp_psy<-Resp_psy %>% group_by(Code) %>% mutate(mean=mean(Resp)) # mean by code, this worked
    # names(Resp_psy)[names(Resp_psy) == "mean"] <- "Respiration" #change name
    # Resp_psy<-Resp_psy[,c("Code","Respiration")] #remove col
    # Resp_psy<-unique(Resp_psy) #remove duplicates, now you have 
 Resp_psy<-aggregate(x = Resp_psy$Resp,                # Specify data column
          by = list(Resp_psy$Code),              # Specify group indicator
          FUN = mean)        
        names(Resp_psy)[names(Resp_psy) == "x"] <- "Respiration" #change name
        names(Resp_psy)[names(Resp_psy) == "Group.1"] <- "Code" #change name

  
   #PR
  P_R_psy<- PR_psy[,c("PR","Code")] 
    # P_R_psy2<-P_R_psy %>% group_by(Code) %>% mutate(mean=mean(PR)) # mean by code, this worked
    # names(P_R_psy2)[names(P_R_psy2) == "mean"] <- "P_R" #change name
    # P_R_psy2<-P_R_psy2[,c("Code","P_R")] #remove col
    # P_R_psy2<-unique(P_R_psy2) #remove duplicates, now you have 
    # 
    P_R_psy<-aggregate(x = P_R_psy$PR,                # Specify data column
          by = list(P_R_psy$Code),              # Specify group indicator
          FUN = mean)        
        names(P_R_psy)[names(P_R_psy) == "x"] <- "PR" #change name
        names(P_R_psy)[names(P_R_psy) == "Group.1"] <- "Code" #change name
    
    
    
#merge
 PRPR_psy<-merge(Photo_psy,Resp_psy, all = T)   
     PRPR_psy<-merge(PRPR_psy,P_R_psy, all = T)   
 
```
#merging full physio 
```{r}   
#merg: this is EVERYTHING! PAM and BW subsetted to ONLY T0, T1 and TF time points, and all data is already transformed! 
 

# #create duplicate T0 for H or A that isn't there for each parent. id
# MetaT0<-metaPhysio #copy
# MetaT0<-subset(MetaT0, Time.Point=="T0")
# MetaT0Amb<-MetaT0
# MetaT0Amb$Treatment[MetaT0Amb$Treatment == "High"] <- "Ambient" #change 
# MetaT0High<-MetaT0
# MetaT0High$Treatment[MetaT0High$Treatment == "Ambient"] <- "High" #change 
# MetaT02<-rbind(MetaT0Amb,MetaT0High) #now oyu have T0 for Amb and High
# metaPhysio<-metaPhysio[!(metaPhysio$Time.Point=="T0"),] #remove T0s 
# metaPhysio<-rbind(metaPhysio,MetaT02) # add the full T0 dataset
# metaPhysio$Code<-paste(metaPhysio$Species,metaPhysio$Treatment,metaPhysio$Parent.ID,metaPhysio$Time.Point) #make code
# 

#MERGE

PhysioData<-merge(metaPhysio,Calcification_psy , all.x=T)
PhysioData<-merge(PhysioData,Biomass_psy,all.x=T)

PhysioData<-merge(PhysioData,CellCounts_psy,all.x=T)
PhysioData<-merge(PhysioData,Chla_psy,all.x=T)
PhysioData<-merge(PhysioData,Protein_psy,all.x=T)
PhysioData<-merge(PhysioData,PAM_psy,all.x=T)
PhysioData<-merge(PhysioData,PRPR_psy,all.x=T)
  PhysioData$Parent.ID<-as.factor(PhysioData$Parent.ID)
  PhysioData$Code<-as.factor(PhysioData$Code)

#check
duplicated(PhysioData$Code)
PhysioData$Code[duplicated(PhysioData$Code)]
PhysioData<-unique(PhysioData) #this is the df. 

# PhysioData <- PhysioData[, c(10,11,1,2,3,4,5,6,7,12, 13,8,9,14:20)]




```

#nMDS of physio, PhysioData df, by Parent.ID, all data
```{r}     


#make a copy
pData<-PhysioData

pData<-na.omit(pData) #remove anything without a value

#deal with negatives by adding a constant (only P, R and P:R)
pData$Photosynthesis<-pData$Photosynthesis+1
pData$Respiration<-pData$Respiration+1
pData$PR<-pData$PR+1

Phy_nmds<-pData

#make just for T1 and TF
pData.T1TF<-subset(Phy_nmds, Time.Point=="T1"|Time.Point=="TF")

pData.T0<-subset(Phy_nmds, Time.Point=="T0")




#bray curtis presence-absense and abundance


library(vegan)  #hannah code below, edited
set.seed(30)

Phy_nmds.MDS<-metaMDS(Phy_nmds[,12:20], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(Phy_nmds.MDS)
Phy_nmds.MDS
Phy_nmds.MDS.scores <- as.data.frame(scores(Phy_nmds.MDS)) #make the nMDS scores into a dataframe
Phy_nmds.MDS #get summary info, stress is 0.096 great

##Add variables that you want to test to your scores data sheet
Phy_nmds.MDS.scores$Parent.ID <- Phy_nmds$Parent.ID
Phy_nmds.MDS.scores$Treatment <- Phy_nmds$Treatment
Phy_nmds.MDS.scores$Species <- Phy_nmds$Species
Phy_nmds.MDS.scores$transmission <- Phy_nmds$transmission
Phy_nmds.MDS.scores$skeleton <- Phy_nmds$skeleton
Phy_nmds.MDS.scores$Tissue <- Phy_nmds$Tissue

Phy_nmds.MDS.scores$Time.Point <- Phy_nmds$Time.Point
Phy_nmds.MDS.scores$Code <- Phy_nmds$Code # move the code 
Phy_nmds.MDS.scores$Code2 <- paste(Phy_nmds.MDS.scores$Species,Phy_nmds.MDS.scores$Treatment,Phy_nmds.MDS.scores$Time.Point) # create new code species, time point treatment 
Phy_nmds.MDS.scores$Code2<-as.factor(Phy_nmds.MDS.scores$Code2)

Phy_nmds.MDS.scores$Code3 <- paste(Phy_nmds.MDS.scores$Species,Phy_nmds.MDS.scores$Treatment) # create new code species, time point treatment 
Phy_nmds.MDS.scores$Code3<-as.factor(Phy_nmds.MDS.scores$Code3)


Sp.colors <- c("Montipora_capitata"= "#D43F3AFF","Porites_compressa"="#EEA236FF","Pavona_varians"="#5CB85CFF","Pocillopora_acuta"="#46B8DAFF", "High"="darkRed","Ambient"="navyBlue")


ggplot(Phy_nmds.MDS.scores, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Species), size = 4) +
  scale_color_manual(values=Sp.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  #stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2), linetype = 2) +
  ggtitle("NMDS phyio Bray Curtis") +
  theme_classic()
#ggsave("bc_all.pdf")


#################### Subset PLOTS (do not rerun nmds) for T1 and TF visualizations ####
 

Phy_nmds.MDS.scores_T1<-subset(Phy_nmds.MDS.scores, Time.Point=="T1")

ggplot(Phy_nmds.MDS.scores_T1, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Species), size = 4) +
  scale_color_manual(values=Sp.colors)+
  geom_text(aes(label=Parent.ID),hjust=-.5, vjust=-.5)+
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Species), linetype = 2) +
  ggtitle("NMDS physio T1") +
  theme_classic()
#ggsave("bc_all.pdf")

#################### Subset PLOTS (do not rerun nmds) for TF visualizations####


Phy_nmds.MDS.scores_TF<-subset(Phy_nmds.MDS.scores, Time.Point=="TF")


ggplot(Phy_nmds.MDS.scores_TF, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Species), size = 4) +
  geom_text(aes(label=Parent.ID),hjust=-.5, vjust=-.5)+
  scale_color_manual(values=Sp.colors)+
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Species), linetype = 2) +
  ggtitle("NMDS physio  TF") +
  theme_classic()

######### ok now do it by rerun T1 #### 
Phy_nmds.T1<-subset(Phy_nmds, Time.Point=="T1")
Phy_nmds.T1$Tissue<-as.factor(Phy_nmds.T1$Tissue)
Phy_nmds.T1$skeleton<-as.factor(Phy_nmds.T1$skeleton)
Phy_nmds.T1$shape<-as.factor(Phy_nmds.T1$shape)
Phy_nmds.T1$transmission<-as.factor(Phy_nmds.T1$transmission)


  set.seed(30)

Phy_nmds.MDS.T1<-metaMDS(Phy_nmds.T1[,12:20], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(Phy_nmds.MDS.T1)
Phy_nmds.MDS.T1.scores <- as.data.frame(scores(Phy_nmds.MDS.T1)) #make the nMDS scores into a dataframe
Phy_nmds.MDS.T1 #get summary info, stress is 0.096 great

##Add variables that you want to test to your scores data sheet
Phy_nmds.MDS.scores$Parent.ID <- Phy_nmds$Parent.ID
Phy_nmds.MDS.scores$Treatment <- Phy_nmds$Treatment
Phy_nmds.MDS.scores$Species <- Phy_nmds$Species
Phy_nmds.MDS.scores$Time.Point <- Phy_nmds$Time.Point
Phy_nmds.MDS.scores$Code <- Phy_nmds$Code # move the code 
Phy_nmds.MDS.scores$Code2 <- paste(Phy_nmds.MDS.scores$Species,Phy_nmds.MDS.scores$Treatment) # create new code species, time point treatment 
Phy_nmds.MDS.scores$Code2<-as.factor(Phy_nmds.MDS.scores$Code2)

Phy_nmds.MDS.scores$Code3 <- paste(Phy_nmds.MDS.scores$Species,Phy_nmds.MDS.scores$Treatment) # create new code species, time point treatment 
Phy_nmds.MDS.scores$Code3<-as.factor(Phy_nmds.MDS.scores$Code3)



#make loading vectors
vec.sp<-envfit(Phy_nmds.MDS.T1, Phy_nmds.T1[,8:20], perm=1000)
vec.sp2<-vec.sp$vectors$arrows*sqrt(vec.sp$vectors$r)

en_coord_cont = as.data.frame(scores(vec.sp, "vectors")) * ordiArrowMul(vec.sp, fill=6)
en_coord_cat = as.data.frame(scores(vec.sp, "factors")) * ordiArrowMul(vec.sp, fill=6)




vec.sp.df<-as.data.frame(vec.sp$vectors$arrows*sqrt(vec.sp$vectors$r))
vec.sp.df$Code<-rownames(vec.sp.df)



ggplot(Phy_nmds.MDS.scores, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Species), size = 4) +
  scale_color_manual(values=Sp.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Species), linetype = 2) +
    #geom_segment(data=vec.sp.df,aes(x=0,xend=NMDS1,y=0,yend=NMDS2),
    #  arrow = arrow(length = unit(0.0001, "cm")),colour="grey",inherit_aes=F) + 
   # geom_text(data=vec.sp.df,aes(x=NMDS1,y=NMDS2,label=Code),size=3)+
  geom_segment(aes(x = 0, y = 0, xend = NMDS1, yend = NMDS2), 
       data = en_coord_cont, size =1, alpha = 0.5, colour = "grey30") +
     geom_point(data = en_coord_cat, aes(x = NMDS1, y = NMDS2), 
       shape = "diamond", size = 4, alpha = 0.6, colour = "navy") +
     geom_text(data = en_coord_cat, aes(x = NMDS1, y = NMDS2+0.04), 
       label = row.names(en_coord_cat), colour = "navy", fontface = "bold") + 
     geom_text(data = en_coord_cont, aes(x = NMDS1, y = NMDS2), colour = "grey30", 
       fontface = "bold", label = row.names(en_coord_cont)) + 
  ggtitle("NMDS Physio T1") +
  theme_classic()


######### ok now Rerun by T0 ####
#keep time 0
 

  set.seed(30)

Phy_nmds.MDS.T0<-metaMDS(pData.T0[,(12:20)], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS"))
stressplot(Phy_nmds.MDS.T0)
Phy_nmds.MDS.T0.scores <- as.data.frame(scores(Phy_nmds.MDS.T0)) #make the nMDS scores into a dataframe
Phy_nmds.MDS.T0 #get summary info, stress .19

##Add variables that you want to test to your scores data sheet
Phy_nmds.MDS.T0.scores$Parent.ID <- pData.T0$Parent.ID
Phy_nmds.MDS.T0.scores$Treatment <- pData.T0$Treatment
Phy_nmds.MDS.T0.scores$Species <- pData.T0$Species
Phy_nmds.MDS.T0.scores$Time.Point <- pData.T0$Time.Point
Phy_nmds.MDS.T0.scores$Code <- pData.T0$Code # move the code 
Phy_nmds.MDS.T0.scores$Code2 <- paste(Phy_nmds.MDS.T0.scores$Species,Phy_nmds.MDS.T0.scores$Treatment) # create new code species, time point treatment 
Phy_nmds.MDS.T0.scores$Code2<-as.factor(Phy_nmds.MDS.scores$Code2)

Phy_nmds.MDS.T0.scores$Code3 <- paste(Phy_nmds.MDS.T0.scores$Species,Phy_nmds.MDS.T0.scores$Treatment) # create new code species, time point treatment 
Phy_nmds.MDS.T0.scores$Code3<-as.factor(Phy_nmds.MDS.T0.scores$Code3)

#make loading vectors
vec.spT0<-envfit(Phy_nmds.MDS.T0, pData.T0[,9:16], perm=1000)
vec.sp.dfT0<-as.data.frame(vec.spT0$vectors$arrows*sqrt(vec.spT0$vectors$r))
vec.sp.dfT0$traits<-rownames(vec.sp.dfT0)

mult <- .25

ggplot(Phy_nmds.MDS.T0.scores, aes(x = NMDS1, y = NMDS2)) + 
  geom_point(aes(colour = Species), size = 4) +
  scale_color_manual(values=Sp.colors)+
  #geom_text(label = rownames(scores), nudge_x = 0.05, nudge_y = 0.05,check_overlap = T) +
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Species), linetype = 2) +
    # geom_segment(data=vec.sp.df,aes(x=0,xend=NMDS1,y=0,yend=NMDS2),
    #   arrow = arrow(length = unit(0.25, "cm")),colour="grey",inherit_aes=FALSE) + 
    # geom_text(data=vec.sp.dfT0,aes(x=NMDS1,y=NMDS2,label=traits),size=4)+
  geom_segment(data = vec.sp.dfT0,
                    aes(x = 0, xend = mult*NMDS1, y = 0, yend = mult*NMDS2),
                    arrow = arrow(length = unit(0.25, "cm")), colour = "black") + #arrows for envfit.  doubled the length for similarity to the plot() function. NB check ?envfit regarding arrow length if not familiar with lengths
       geom_text(data = vec.sp.dfT0, aes(x = mult*NMDS1, y = mult*NMDS2, label=traits),size = 3)+#labels the environmental variable arrows * "mult" as for the arrows
  ggtitle("NMDS Physio T0") +
  
  theme_classic()


```
#### By SPECIES. Make a NEW ordination for each species. 
Mcap phys
```{r} 
Phy_nmds_Mcap<-pData.T1TF
  

Phy_nmds_Mcap<-subset(Phy_nmds_Mcap, Species=="Montipora_capitata")

set.seed(30)

Phy_nmds_Mcap.MDS<-metaMDS(Phy_nmds_Mcap[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(Phy_nmds_Mcap.MDS)
Phy_nmds_Mcap.MDS.scores <- as.data.frame(scores(Phy_nmds_Mcap.MDS)) #make the nMDS scores into a dataframe
Phy_nmds_Mcap.MDS #get summary info, stress is 0.096 great

##Add variables that you want to test to your scores data sheet
Phy_nmds_Mcap.MDS.scores$Parent.ID <- Phy_nmds_Mcap$Parent.ID
Phy_nmds_Mcap.MDS.scores$Treatment <- Phy_nmds_Mcap$Treatment
Phy_nmds_Mcap.MDS.scores$Species <- Phy_nmds_Mcap$Species
Phy_nmds_Mcap.MDS.scores$Time.Point <- Phy_nmds_Mcap$Time.Point
Phy_nmds_Mcap.MDS.scores$Code <- paste(Phy_nmds_Mcap$Parent.ID,Phy_nmds_Mcap$Time.Point)
Phy_nmds_Mcap.MDS.scores$Code2 <- paste(Phy_nmds_Mcap$Treatment,Phy_nmds_Mcap$Time.Point)
Phy_nmds_Mcap.MDS.scores$Code3 <- paste(Phy_nmds_Mcap$Treatment,Phy_nmds_Mcap$Time.Point,Phy_nmds_Mcap$Parent.ID)

#colors
## create palette for parent.ID and treatments
Mcap.Parent.colors <- c("363" = "green4",  "364" = "firebrick3", "365" ="deeppink4", "366" = "orange", "367" = "green1","368" = "gold",  "369"= "hotpink", "370" ="darkslateblue", "371" = "cyan", "372" = "darkorange","373" ="darkorchid1", "374" = "lightblue", 
                        "Ambient" = "dodgerblue", "High" = "darkred",
                        "C Ambient"="#DDCC77","C High"="#999933", "CD Ambient"="#44AA99", "CD High"="#117733", 
                        "Ambient T1"="darkblue", "Ambient TF"="skyblue", "High T1"="darkred","High TF"="hotpink") 


ggplot(Phy_nmds_Mcap.MDS.scores, aes(x = NMDS1, y = NMDS2)) +
  geom_point(aes(shape = Code2, color = Parent.ID, fill=Treatment), size = 5) + 
  scale_shape_manual(values = c(21, 22,24,25)) + 
    scale_color_manual(values=Mcap.Parent.colors)+
stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("M. capitata T1TF") +
  theme_classic()

ggplot(Phy_nmds_Mcap.MDS.scores, aes(x = NMDS1, y = NMDS2, shape=Code2, fill=Treatment)) + 
 geom_point(aes(size = 5) )+
    #geom_point(aes(colour = Treatment, size = 4, shape=Code2)) +
    scale_shape_manual(values = c(21, 22,24,25)) + 
  scale_color_manual(values=Mcap.Parent.colors)+
   # geom_line(aes(group = Code), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("M. capitata T1TF") +
  theme_classic()
#ggsave("McapT1its2.pdf")

#T1
Phy_nmds_Mcap.T1<-subset(Phy_nmds_Mcap, Time.Point=="T1")
ord.mcap.T1<-metaMDS(Phy_nmds_Mcap.T1[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.mcap.T1)
ord.mcap.T1.df<-as.data.frame(cbind(vegan::scores(ord.mcap.T1, display="sites"))) # these are "points" ask hannah 
ord.mcap.T1.df$Time.Point <- Phy_nmds_Mcap.T1$Time.Point
ord.mcap.T1.df$Parent.ID <- Phy_nmds_Mcap.T1$Parent.ID
ord.mcap.T1.df$Treatment <- Phy_nmds_Mcap.T1$Treatment
ord.mcap.T1.df$Clade <- Phy_nmds_Mcap.T1$Clade
ord.mcap.T1.df$Code <- paste(ord.mcap.T1.df$Parent.ID,ord.mcap.T1.df$Time.Point)
ord.mcap.T1.df$Code2 <- paste(ord.mcap.T1.df$Clade,ord.mcap.T1.df$Treatment)
ord.mcap.T1.df$Code2 <- as.factor(ord.mcap.T1.df$Code2)

ggplot(ord.mcap.T1.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=Mcap.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("M. capitata physio T1") +
  theme_classic()
#ggsave("McapT1its2.pdf")

#workaround-for when this randomly breaks
# plot_ordination(mcap.bac.TF, ordinate(mcap.bac, "MDS", set.seed=(30)), color = "Treatment", shape="Clade") + geom_point(size = 5)


#TF
Phy_nmds_Mcap.TF<-subset(Phy_nmds_Mcap, Time.Point=="TF")
ord.mcap.TF<-metaMDS(Phy_nmds_Mcap.TF[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.mcap.TF)
ord.mcap.TF.df<-as.data.frame(cbind(vegan::scores(ord.mcap.TF, display="sites"))) # these are "points" ask hannah 
ord.mcap.TF.df$Time.Point <- Phy_nmds_Mcap.TF$Time.Point
ord.mcap.TF.df$Parent.ID <- Phy_nmds_Mcap.TF$Parent.ID
ord.mcap.TF.df$Treatment <- Phy_nmds_Mcap.TF$Treatment
ord.mcap.TF.df$Clade <- Phy_nmds_Mcap.TF$Clade
ord.mcap.TF.df$Code <- paste(Phy_nmds_Mcap.TF$Parent.ID,Phy_nmds_Mcap.TF$Time.Point)
ord.mcap.TF.df$Code2 <- paste(Phy_nmds_Mcap.TF$Clade,Phy_nmds_Mcap.TF$Treatment)
ord.mcap.TF.df$Code2 <- as.factor(Phy_nmds_Mcap.TF$Code2)

ggplot(ord.mcap.TF.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=Mcap.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("M. capitata physio TF") +
  theme_classic()




```
pcomp phys
```{r}  

#colors
## create palette for parent.ID and treatments
pcomp.Parent.colors <- c("313" = "green4",  "314" = "firebrick3", "315" ="deeppink4", "316" = "orange", "317" = "green1","318" = "gold",  "319"= "hotpink", "320" ="darkslateblue", "321" = "cyan", "322" = "darkorange","323" ="darkorchid1", "324" = "lightblue", 
                         "Ambient" = "Blue", "High" = "Red",
                         "C Ambient"="blue","C High"="red", "CD Ambient"="darkblue", "CD High"="darkred", 
                         "Ambient T1"="blue", "Ambient TF"="darkblue", "High T1"="pink","High TF"="darkred") 
 

Phy_nmds_pcomp<-pData.T1TF
Phy_nmds_pcomp<-subset(Phy_nmds_pcomp, Species=="Porites_compressa")

set.seed(30)

Phy_nmds_pcomp.MDS<-metaMDS(Phy_nmds_pcomp[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(Phy_nmds_pcomp.MDS)
Phy_nmds_pcomp.MDS.scores <- as.data.frame(scores(Phy_nmds_pcomp.MDS)) #make the nMDS scores into a dataframe
Phy_nmds_pcomp.MDS #get summary info,

##Add variables that you want to test to your scores data sheet
Phy_nmds_pcomp.MDS.scores$Parent.ID <- Phy_nmds_pcomp$Parent.ID
Phy_nmds_pcomp.MDS.scores$Treatment <- Phy_nmds_pcomp$Treatment
Phy_nmds_pcomp.MDS.scores$Species <- Phy_nmds_pcomp$Species
Phy_nmds_pcomp.MDS.scores$Time.Point <- Phy_nmds_pcomp$Time.Point
Phy_nmds_pcomp.MDS.scores$Code <- paste(Phy_nmds_pcomp$Parent.ID,Phy_nmds_pcomp$Time.Point)
Phy_nmds_pcomp.MDS.scores$Code2 <- paste(Phy_nmds_pcomp$Treatment,Phy_nmds_pcomp$Time.Point)
Phy_nmds_pcomp.MDS.scores$Code3 <- paste(Phy_nmds_pcomp$Treatment,Phy_nmds_pcomp$Time.Point,Phy_nmds_pcomp$Parent.ID)

#plot
ggplot(Phy_nmds_pcomp.MDS.scores, aes(x = NMDS1, y = NMDS2)) +
  geom_point(aes(shape = Code2, color = Parent.ID, fill=Treatment), size = 5) + 
  scale_shape_manual(values = c(21, 22,24,25)) + 
    scale_color_manual(values=pcomp.Parent.colors)+
stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("P. comp T1TF") +
  theme_classic()

ggplot(Phy_nmds_pcomp.MDS.scores, aes(x = NMDS1, y = NMDS2, shape=Code2, fill=Treatment)) + 
 geom_point(aes(size = 5) )+
    #geom_point(aes(colour = Treatment, size = 4, shape=Code2)) +
    scale_shape_manual(values = c(21, 22,24,25)) + 
  scale_color_manual(values=Pcomp.Parent.colors)+
   # geom_line(aes(group = Code), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("P. comp T1TF") +
  theme_classic()
#ggsave("pcompT1its2.pdf")

#T1
Phy_nmds_pcomp.T1<-subset(Phy_nmds_pcomp, Time.Point=="T1")
ord.pcomp.T1<-metaMDS(Phy_nmds_pcomp.T1[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.pcomp.T1)
ord.pcomp.T1.df<-as.data.frame(cbind(vegan::scores(ord.pcomp.T1, display="sites"))) # these are "points" ask hannah 
ord.pcomp.T1.df$Time.Point <- Phy_nmds_pcomp.T1$Time.Point
ord.pcomp.T1.df$Parent.ID <- Phy_nmds_pcomp.T1$Parent.ID
ord.pcomp.T1.df$Treatment <- Phy_nmds_pcomp.T1$Treatment
ord.pcomp.T1.df$Clade <- Phy_nmds_pcomp.T1$Clade
ord.pcomp.T1.df$Code <- paste(Phy_nmds_pcomp.T1$Parent.ID,Phy_nmds_pcomp.T1$Time.Point)
ord.pcomp.T1.df$Code2 <- paste(Phy_nmds_pcomp.T1$Clade,Phy_nmds_pcomp.T1$Treatment)
ord.pcomp.T1.df$Code2 <- as.factor(Phy_nmds_pcomp.T1$Code2)

ggplot(ord.pcomp.T1.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=Pcomp.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("P. comp physio T1") +
  theme_classic()
#ggsave("pcompT1its2.pdf")

#workaround-for when this randomly breaks
# plot_ordination(pcomp.bac.TF, ordinate(pcomp.bac, "MDS", set.seed=(30)), color = "Treatment", shape="Clade") + geom_point(size = 5)


#TF
Phy_nmds_pcomp.TF<-subset(Phy_nmds_pcomp, Time.Point=="TF")
ord.pcomp.TF<-metaMDS(Phy_nmds_pcomp.TF[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.pcomp.TF)
ord.pcomp.TF.df<-as.data.frame(cbind(vegan::scores(ord.pcomp.TF, display="sites"))) # these are "points" ask hannah 
ord.pcomp.TF.df$Time.Point <- Phy_nmds_pcomp.TF$Time.Point
ord.pcomp.TF.df$Parent.ID <- Phy_nmds_pcomp.TF$Parent.ID
ord.pcomp.TF.df$Treatment <- Phy_nmds_pcomp.TF$Treatment
ord.pcomp.TF.df$Clade <- Phy_nmds_pcomp.TF$Clade
ord.pcomp.TF.df$Code <- paste(Phy_nmds_pcomp.TF$Parent.ID,Phy_nmds_pcomp.TF$Time.Point)
ord.pcomp.TF.df$Code2 <- paste(Phy_nmds_pcomp.TF$Clade,Phy_nmds_pcomp.TF$Treatment)
ord.pcomp.TF.df$Code2 <- as.factor(Phy_nmds_pcomp.TF$Code2)

#try envfit
# env = Phy_nmds_pcomp.TF[,3] NOT WORKING SORT OUT LATER
# 
# en = envfit(ord.pcomp.TF, env, permutations = 999, na.rm = TRUE)


ggplot(ord.pcomp.TF.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=Pcomp.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("P. comp physio TF") +
  theme_classic()


```
pvar phys
```{r}  
pvar.Parent.colors <- c("325" = "green4",  "353" = "firebrick3", "356" ="deeppink4", "358" = "orange", "361" = "green1","354" = "gold",  "351"= "hotpink", "355" ="darkslateblue", "357" = "cyan", "359" = "darkorange","360" ="darkorchid1", "362" = "lightblue", 
                       "Ambient" = "dodgerblue", "High" = "darkred",
                        "C1 Ambient"="#DDCC77","C1 High"="#999933", "C27 Ambient"="#44AA99", "C27 High"="#117733", 
                         "Ambient T1"="darkblue", "Ambient TF"="skyblue", "High T1"="darkred","High TF"="hotpink") 

Phy_nmds_pvar<-pData.T1TF
  

Phy_nmds_pvar<-subset(Phy_nmds_pvar, Species=="Pavona_varians")

set.seed(30)

Phy_nmds_pvar.MDS<-metaMDS(Phy_nmds_pvar[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(Phy_nmds_pvar.MDS)
Phy_nmds_pvar.MDS.scores <- as.data.frame(scores(Phy_nmds_pvar.MDS)) #make the nMDS scores into a dataframe
Phy_nmds_pvar.MDS #get summary info, stress is 0.096 great

##Add variables that you want to test to your scores data sheet
Phy_nmds_pvar.MDS.scores$Parent.ID <- Phy_nmds_pvar$Parent.ID
Phy_nmds_pvar.MDS.scores$Treatment <- Phy_nmds_pvar$Treatment
Phy_nmds_pvar.MDS.scores$Species <- Phy_nmds_pvar$Species
Phy_nmds_pvar.MDS.scores$Time.Point <- Phy_nmds_pvar$Time.Point
Phy_nmds_pvar.MDS.scores$Code <- paste(Phy_nmds_pvar$Parent.ID,Phy_nmds_pvar$Time.Point)
Phy_nmds_pvar.MDS.scores$Code2 <- paste(Phy_nmds_pvar$Treatment,Phy_nmds_pvar$Time.Point)
Phy_nmds_pvar.MDS.scores$Code3 <- paste(Phy_nmds_pvar$Treatment,Phy_nmds_pvar$Time.Point,Phy_nmds_pvar$Parent.ID)


ggplot(Phy_nmds_pvar.MDS.scores, aes(x = NMDS1, y = NMDS2)) +
  geom_point(aes(shape = Code2, color = Parent.ID, fill=Treatment), size = 5) + 
  scale_shape_manual(values = c(21, 22,24,25)) + 
    scale_color_manual(values=pvar.Parent.colors)+
stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("P. varians T1TF") +
  theme_classic()

ggplot(Phy_nmds_pvar.MDS.scores, aes(x = NMDS1, y = NMDS2, shape=Code2, fill=Treatment)) + 
 geom_point(aes(size = 5) )+
    #geom_point(aes(colour = Treatment, size = 4, shape=Code2)) +
    scale_shape_manual(values = c(21, 22,24,25)) + 
  scale_color_manual(values=pvar.Parent.colors)+
   # geom_line(aes(group = Code), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("P. varians T1TF") +
  theme_classic()
#ggsave("pvarT1its2.pdf")

#T1
Phy_nmds_pvar.T1<-subset(Phy_nmds_pvar, Time.Point=="T1")
ord.pvar.T1<-metaMDS(Phy_nmds_pvar.T1[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.pvar.T1)
ord.pvar.T1.df<-as.data.frame(cbind(vegan::scores(ord.pvar.T1, display="sites"))) # these are "points" ask hannah 
ord.pvar.T1.df$Time.Point <- Phy_nmds_pvar.T1$Time.Point
ord.pvar.T1.df$Parent.ID <- Phy_nmds_pvar.T1$Parent.ID
ord.pvar.T1.df$Treatment <- Phy_nmds_pvar.T1$Treatment
ord.pvar.T1.df$Clade <- Phy_nmds_pvar.T1$Clade
ord.pvar.T1.df$Code <- paste(Phy_nmds_pvar.T1$Parent.ID,Phy_nmds_pvar.T1$Time.Point)
ord.pvar.T1.df$Code2 <- paste(Phy_nmds_pvar.T1$Clade,Phy_nmds_pvar.T1$Treatment)
ord.pvar.T1.df$Code2 <- as.factor(Phy_nmds_pvar.T1$Code2)

ggplot(ord.pvar.T1.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=pvar.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("P. varians physio T1") +
  theme_classic()
#ggsave("pvarT1its2.pdf")

#workaround-for when this randomly breaks
# plot_ordination(pvar.bac.TF, ordinate(pvar.bac, "MDS", set.seed=(30)), color = "Treatment", shape="Clade") + geom_point(size = 5)


#TF
Phy_nmds_pvar.TF<-subset(Phy_nmds_pvar, Time.Point=="TF")
ord.pvar.TF<-metaMDS(Phy_nmds_pvar.TF[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.pvar.TF)
ord.pvar.TF.df<-as.data.frame(cbind(vegan::scores(ord.pvar.TF, display="sites"))) # these are "points" ask hannah 
ord.pvar.TF.df$Time.Point <- Phy_nmds_pvar.TF$Time.Point
ord.pvar.TF.df$Parent.ID <- Phy_nmds_pvar.TF$Parent.ID
ord.pvar.TF.df$Treatment <- Phy_nmds_pvar.TF$Treatment
ord.pvar.TF.df$Clade <- Phy_nmds_pvar.TF$Clade
ord.pvar.TF.df$Code <- paste(Phy_nmds_pvar.TF$Parent.ID,Phy_nmds_pvar.TF$Time.Point)
ord.pvar.TF.df$Code2 <- paste(Phy_nmds_pvar.TF$Clade,Phy_nmds_pvar.TF$Treatment)
ord.pvar.TF.df$Code2 <- as.factor(Phy_nmds_pvar.TF$Code2)

ggplot(ord.pvar.TF.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=pvar.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("P. varians physio TF") +
  theme_classic()

 


```

pacu phys
```{r}   
## create palette for parent.ID and treatments
pacu.Parent.colors <- c("305" = "green4",  "307" = "firebrick3", "309" ="deeppink4", "311" = "orange", "301" = "green1","302" = "gold",  "308"= "hotpink", "310" ="darkslateblue", "312" = "cyan", "303" = "darkorange","304" ="darkorchid1", "306" = "lightblue", 
                        "Ambient" = "dodgerblue", "High" = "darkred",
                        "C42 Ambient"="#DDCC77","C42 High"="#999933", "CCC Ambient"="#44AA99", "CCC High"="#117733", 
                        "Ambient T1"="darkblue", "Ambient TF"="skyblue", "High T1"="darkred","High TF"="hotpink") 



Phy_nmds_pacu<-pData.T1TF
Phy_nmds_pacu<-subset(Phy_nmds_pacu, Species=="Pocillopora_acuta")

set.seed(30)

Phy_nmds_pacu.MDS<-metaMDS(Phy_nmds_pacu[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(Phy_nmds_pacu.MDS)
Phy_nmds_pacu.MDS.scores <- as.data.frame(scores(Phy_nmds_pacu.MDS)) #make the nMDS scores into a dataframe
Phy_nmds_pacu.MDS #get summary info, stress is 0.096 great

##Add variables that you want to test to your scores data sheet
Phy_nmds_pacu.MDS.scores$Parent.ID <- Phy_nmds_pacu$Parent.ID
Phy_nmds_pacu.MDS.scores$Treatment <- Phy_nmds_pacu$Treatment
Phy_nmds_pacu.MDS.scores$Species <- Phy_nmds_pacu$Species
Phy_nmds_pacu.MDS.scores$Time.Point <- Phy_nmds_pacu$Time.Point
Phy_nmds_pacu.MDS.scores$Code <- paste(Phy_nmds_pacu$Parent.ID,Phy_nmds_pacu$Time.Point)
Phy_nmds_pacu.MDS.scores$Code2 <- paste(Phy_nmds_pacu$Treatment,Phy_nmds_pacu$Time.Point)
Phy_nmds_pacu.MDS.scores$Code3 <- paste(Phy_nmds_pacu$Treatment,Phy_nmds_pacu$Time.Point,Phy_nmds_pacu$Parent.ID)

ggplot(Phy_nmds_pacu.MDS.scores, aes(x = NMDS1, y = NMDS2)) +
  geom_point(aes(shape = Code2, color = Parent.ID, fill=Treatment), size = 5) + 
  scale_shape_manual(values = c(21, 22,24,25)) + 
    scale_color_manual(values=pacu.Parent.colors)+
stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("P. acuta T1TF") +
  theme_classic()

ggplot(Phy_nmds_pacu.MDS.scores, aes(x = NMDS1, y = NMDS2, shape=Code2, fill=Treatment)) + 
 geom_point(aes(size = 5) )+
    #geom_point(aes(colour = Treatment, size = 4, shape=Code2)) +
    scale_shape_manual(values = c(21, 22,24,25)) + 
  scale_color_manual(values=pacu.Parent.colors)+
   # geom_line(aes(group = Code), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Code2, lty=factor(Time.Point))) +
  scale_linetype_manual(values=c(2,3,2,3))+
  ggtitle("P. acuta T1TF") +
  theme_classic()
#ggsave("pacuT1its2.pdf")

#T1
Phy_nmds_pacu.T1<-subset(Phy_nmds_pacu, Time.Point=="T1")
ord.pacu.T1<-metaMDS(Phy_nmds_pacu.T1[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.pacu.T1)
ord.pacu.T1.df<-as.data.frame(cbind(vegan::scores(ord.pacu.T1, display="sites"))) # these are "points" ask hannah 
ord.pacu.T1.df$Time.Point <- Phy_nmds_pacu.T1$Time.Point
ord.pacu.T1.df$Parent.ID <- Phy_nmds_pacu.T1$Parent.ID
ord.pacu.T1.df$Treatment <- Phy_nmds_pacu.T1$Treatment
ord.pacu.T1.df$Clade <- Phy_nmds_pacu.T1$Clade
ord.pacu.T1.df$Code <- paste(Phy_nmds_pacu.T1$Parent.ID,Phy_nmds_pacu.T1$Time.Point)
ord.pacu.T1.df$Code2 <- paste(Phy_nmds_pacu.T1$Clade,Phy_nmds_pacu.T1$Treatment)
ord.pacu.T1.df$Code2 <- as.factor(Phy_nmds_pacu.T1$Code2)

ggplot(ord.pacu.T1.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=pacu.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("P. acuta physio T1") +
  theme_classic()
#ggsave("pacuT1its2.pdf")

#workaround-for when this randomly breaks
# plot_ordination(pacu.bac.TF, ordinate(pacu.bac, "MDS", set.seed=(30)), color = "Treatment", shape="Clade") + geom_point(size = 5)


#TF
Phy_nmds_pacu.TF<-subset(Phy_nmds_pacu, Time.Point=="TF")
ord.pacu.TF<-metaMDS(Phy_nmds_pacu.TF[,8:16], distance = "bray", k = 2, trymax = 200, engine = c("monoMDS", "isoMDS"))
stressplot(ord.pacu.TF)
ord.pacu.TF.df<-as.data.frame(cbind(vegan::scores(ord.pacu.TF, display="sites"))) # these are "points" ask hannah 
ord.pacu.TF.df$Time.Point <- Phy_nmds_pacu.TF$Time.Point
ord.pacu.TF.df$Parent.ID <- Phy_nmds_pacu.TF$Parent.ID
ord.pacu.TF.df$Treatment <- Phy_nmds_pacu.TF$Treatment
ord.pacu.TF.df$Clade <- Phy_nmds_pacu.TF$Clade
ord.pacu.TF.df$Code <- paste(ord.pacu.TF.df$Parent.ID,ord.pacu.TF.df$Time.Point)
ord.pacu.TF.df$Code2 <- paste(ord.pacu.TF.df$Clade,ord.pacu.TF.df$Treatment)
ord.pacu.TF.df$Code2 <- as.factor(ord.pacu.TF.df$Code2)

ggplot(ord.pacu.TF.df, aes(x = NMDS1, y = NMDS2)) + 
   geom_point(aes(stroke=3, colour = Parent.ID, shape=Treatment,size = 4) )+
    geom_point(aes(colour = Treatment, size = 4, shape=Treatment)) +
  scale_color_manual(values=pacu.Parent.colors)+
   # geom_line(aes(group = Parent.ID), color = "black") + 
  stat_ellipse(aes(x = NMDS1, y = NMDS2, colour = Treatment, lty=factor(Treatment))) +
    scale_linetype_manual(values=c(3,3))+
  ggtitle("P. acuta physio TF") +
  theme_classic()




```






#PERMANOVA on physio only

```{r}      
  
#ALL THE DATA

phy.dist <- vegdist(pData.T1TF [8:16], method="bray") #make dist matrix
phy.div <- adonis2(pData.T1TF [8:16] ~ Species*Treatment*Time.Point, data = pData.T1TF [1:6], permutations = 999, method="bray")
phy.div #view, everything is significant

##Check for homogeneity of dispersions (you want this to be insignificant)
phy.dist.disp <- betadisper(phy.dist, pData.T1TF$Species, type = "centroid")
#par(pty = 's')
boxplot(phy.dist.disp) #visualise your dispersion
permutest(phy.dist.disp) #this is your PERMDISP test

#this runs but it's only univariate so not helpful. 
# pairwise.adonis(PhysioData_noMissing [7:12], PhysioData_noMissing$Species)



```


##By SPECIES
```{r}     
#Mcap, Phy_nmds_Mcap
phy_Mcap.dist <- vegdist(Phy_nmds_Mcap [8:16], method="bray") #make dist matrix
phy_Mcap.div <- adonis2(Phy_nmds_Mcap [8:16] ~ Treatment*Time.Point, data = Phy_nmds_Mcap [1:7], permutations = 999, method="bray")
phy_Mcap.div #view, Time is significant
  ##Check for homogeneity of dispersions (you want this to be insignificant)
  phy.dist.disp <- betadisper(phy_Mcap.dist, Phy_nmds_Mcap$Treatment, type = "centroid")
  boxplot(phy.dist.disp) #visualise your dispersion
  permutest(phy.dist.disp) #this is your PERMDISP test

#Pcomp, Phy_nmds_Pcomp 
phy_Pcomp.dist <- vegdist(Phy_nmds_pcomp [8:16], method="bray") #make dist matrix
phy_Pcomp.div <- adonis2(Phy_nmds_pcomp [8:16] ~ Treatment*Time.Point, data = Phy_nmds_pcomp [1:7], permutations = 999, method="bray")
phy_Pcomp.div 
  ##Check for homogeneity of dispersions (you want this to be insignificant)
  phy.dist.disp <- betadisper(phy_Pcomp.dist, Phy_nmds_pcomp$Treatment, type = "centroid")
  boxplot(phy.dist.disp) #visualise your dispersion
  permutest(phy.dist.disp) #this is your PERMDISP test

#Pvar, Phy_nmds_Pvar
phy_Pvar.dist <- vegdist(Phy_nmds_pvar [8:16], method="bray") #make dist matrix
phy_Pvar.div <- adonis2(Phy_nmds_pvar [8:16] ~ Treatment*Time.Point, data = Phy_nmds_pvar [1:7], permutations = 999, method="bray")
phy_Pvar.div #view, all is significant
    ##Check for homogeneity of dispersions (you want this to be insignificant)
  phy.dist.disp <- betadisper(phy_Pvar.dist, Phy_nmds_pvar$Treatment, type = "centroid")
  boxplot(phy.dist.disp) #visualise your dispersion
  permutest(phy.dist.disp) #this is your PERMDISP test
  
  
#Pacu, Phy_nmds_Pacu
phy_Pacu.dist <- vegdist(Phy_nmds_pacu [8:16], method="bray") #make dist matrix
phy_Pacu.div <- adonis2(Phy_nmds_pacu [8:16] ~ Treatment*Time.Point, data = Phy_nmds_pacu [1:7], permutations = 999, method="bray")
phy_Pacu.div #view, all is significant
   ##Check for homogeneity of dispersions (you want this to be insignificant)
  phy.dist.disp <- betadisper(phy_Pacu.dist, Phy_nmds_pacu$Treatment, type = "centroid")
  boxplot(phy.dist.disp) #visualise your dispersion
  permutest(phy.dist.disp) #this is your PERMDISP test

```






####ITS2
## ITS2

# Physio PCA
```{r} 
PhysioData4.pr <- prcomp(PhysioData4[c(8:11)], center = TRUE, scale = TRUE)
summary(PhysioData.pr)
 
library(VIM)
library(FactoMineR)
library(missMDA) #lets you do with incomplete dataset
library(naniar)
gg_miss_var(PhysioData)
res<-summary(aggr(PhysioData, sortVar=TRUE))$combinations


nb <- estim_ncpPCA(PhysioData,method.cv = "Kfold", verbose = FALSE) # estimate the number of components from incomplete data
#(available methods include GCV to approximate CV)
nb$ncp #2

res <- cor(PhysioData)
round(res, 2)


library("PerformanceAnalytics")
my_data <- PhysioData[, c(8:16)]
chart.Correlation(my_data, histogram=TRUE, pch=19)


#Display Pearson correlation: testing physio (normal data) correlations

cor.test(PhysioData3$AFDWmg.cm2_log, PhysioData3$Cellcounts_zoox.cm2_log, method=c("pearson")) #

PhysioData3$Treatment_level <- factor(PhysioData3$Treatment, levels = c("Ambient", "High")) #make new col

Cor1<-ggplot(PhysioData3, aes(x=AFDWmg.cm2_log, y=Cellcounts_zoox.cm2_log)) + 
  geom_point(aes(color=Treatment, shape=Treatment), size=6) +
   #scale_color_manual(name="Nutrition",
        #            values=c("orange", "purple"), 
          #          labels=c("Fed", "Unfed"))+
  scale_shape_manual(values = c(19,21))+
  theme_classic()+
  geom_text(x=800, y=20, label="r=0.50, p<0.001", size=9, color="black") +
  theme(text = element_text(size = 20))+
  theme(axis.text = element_text(size = 20, color="black"))+
  theme(axis.title = element_text(size = 20, face="bold"))+
  theme(legend.title = element_text(size = 20, face="bold"))+
  theme(legend.text = element_text(size = 20, color="black"))+
  ylab(expression(bold(paste("AFDWmg.cm2_log")))) +
  xlab(expression(bold(paste("Cellcounts_zoox.cm2_log"))));Cor1

corrModel<-lmer(AFDWmg.cm2_log~Cellcounts_zoox.cm2_log * Treatment * Species + (1|Tank.num) + (1|Parent.ID), data=PhysioData3)
summary(corrModel)
anova(corrModel, type=2)


##### trying correlations with only complete data (no PAM or BW)
correlation<-PhysioData4
correlation<-correlation[complete.cases(correlation), ] #only full data (2 samps no chla)

correlation_Mcap<-subset(correlation, Species=="Montipora_capitata")
correlation_Mcap_T1<-subset(correlation_Mcap, Time.Point=="T1")

#not workin
corrplots<-ggplot(correlation_Mcap_T1, aes(x=Treatment, y=Frag.ID))+
  geom_point()+
  facet_wrap(~compound, scales="free")+
  geom_smooth(method='lm', color='red')+
  theme_classic()+
  theme(text=element_text(size=14, face="bold"))
corrplots


#back to PCA with the shorter coor dataset that is full
PhysioData5<-PhysioData4
PhysioData5<-PhysioData5[complete.cases(PhysioData5), ] #only full data (2 samps no chla)

PhysioData5.pr <- prcomp(PhysioData5[c(8:11)], center = TRUE, scale = TRUE)
summary(PhysioData5.pr)

#amount of variance explained
screeplot(PhysioData5.pr, type = "l", npcs = 15, main = "Screeplot of the first 10 PCs")
abline(h = 1, col="red", lty=5)
legend("topright", legend=c("Eigenvalue = 1"),
       col=c("red"), lty=5, cex=0.6)
cumpro <- cumsum(PhysioData5.pr$sdev^2 / sum(PhysioData5.pr$sdev^2))
plot(cumpro[0:15], xlab = "PC #", ylab = "Amount of explained variance", main = "Cumulative variance plot")
abline(v = 6, col="blue", lty=5)
abline(h = 0.88759, col="blue", lty=5)
legend("topleft", legend=c("Cut-off @ PC6"),
       col=c("blue"), lty=5, cex=0.6)


#try plotting PC1 and 2 (how to get the percents?????)
plot(PhysioData5.pr$x[,1],PhysioData5.pr$x[,2], xlab="PC1 ()", ylab = "PC2 ()", main = "PC1 / PC2 - plot")


library("factoextra")
fviz_pca_ind(PhysioData5.pr, geom.ind = "point", pointshape = 21, 
             pointsize = 2, 
             fill.ind = PhysioData5$Treatment, 
             col.ind = "black", 
             palette = "jco", 
             addEllipses = TRUE,
             label = "var",
             col.var = "black",
             repel = TRUE,
             legend.title = "Treatment") +
  ggtitle("") +
  theme(plot.title = element_text(hjust = 0.5))


PhysioData5_mat<-PhysioData5[c(8:11)]
cor.res <- cor(PhysioData5_mat)
corrplot.mixed(cor.res, tl.cex = 0.7, tl.col = "black", addCoefasPercent = TRUE)
 
```



PCA hannah use physio data
```{r}
##PCA with imputation using PPCA (Probabilistic PCA, can handle ~15% missing data)

##Use the pcaMethods package for imputing
#BiocManager::install("pcaMethods")
library(pcaMethods)
sum(is.na(PhysioData)) #385
data<-PhysioData #make copy
View(data)

data$time1.growth[data$time1.growth == "NaN"] <- NA #change NaN to NA
data$time1.growth[data$Chla_ug.chla.cm2 == "NaN"] <- NA #change NaN to NA

data$T1.PAM[data$T1.PAM == "NaN"] <- NA #change NaN to NA
data$TF.PAM[data$TF.PAM == "NaN"] <- NA #change NaN to NA
data$T0.PAM[data$T0.PAM == "NaN"] <- NA #change NaN to NA

#Now we get the estimated data set by using PPCA and two principal components
#But you can use nPCs = 3 or however many principal components you want to use.

pc <- pca(data, nPcs=2, method="ppca") #probabilistic PCA
imputed <- completeObs(pc) #This creates a new dataframe with imputed values based on your probability pca

#Then you can run a pca on the imputed datafram
pca <- prcomp(imputed, center = TRUE, scale. = TRUE)
summary(pca)
View(pca)

#you can view it this way
library(devtools)
#install_github("vqv/ggbiplot")
library(ggbiplot)
ggbiplot(pca)

#Or extract the scores and make a ggplot
#Then add your metadata
library(ggplot2)
Miss_scores <- as.data.frame(pca$x)
Miss_scores$frag.id <- data$Frag.ID
Miss_scores$parent.id <- data$Parent.ID
Miss_scores$treatment <- data$Treatment
Miss_scores$species <- data$Species
Miss_scores$time.point <- data$Time.Point

#Plot
ggplot(Miss_scores, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = time.point), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = species), linetype = 2) +
  theme_classic()

#plot by time and species
Miss_scores$treatSpecies<-paste0(Miss_scores$species, Miss_scores$treatment )
Miss_scores$treatTime<-paste0(Miss_scores$treatment, Miss_scores$time.point )


#subset by T0
Miss_scores_T0<-subset(Miss_scores, time.point=="T0")

Miss_scores_T0_plot<-ggplot(Miss_scores_T0, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = treatment), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatSpecies), linetype = 2, level=0.25) +
  theme_classic();Miss_scores_T0_plot

#subset by T1
Miss_scores_T1<-subset(Miss_scores, time.point=="T1")
Miss_scores_T1_plot<-ggplot(Miss_scores_T1, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = treatment), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatSpecies), linetype = 2, level=.25) +
  theme_classic();Miss_scores_T1_plot

#subset by TF
Miss_scores_TF<-subset(Miss_scores, time.point=="TF")
Miss_scores_TF_plot<-ggplot(Miss_scores_TF, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = treatment), size = 4) +
  #stat_ellipse(aes(x = PC1, y = PC2, colour = treatSpecies), linetype = 2) +
  theme_classic();Miss_scores_TF_plot

#plot all time plots
Miss_scores_T0_plot<-Miss_scores_T0_plot+ theme(legend.position = "none") #remove legend
Miss_scores_T1_plot<-Miss_scores_T1_plot+ theme(legend.position = "none") #remove legend
Miss_scores_TF_plot<-Miss_scores_TF_plot+ theme(legend.position = "none") #remove legend

grid.arrange(Miss_scores_T0_plot, Miss_scores_T1_plot, Miss_scores_TF_plot, nrow = 1)

#Subset MCAP
Miss_scores_Mcap<-subset(Miss_scores, species=="Montipora_capitata")

Miss_Mcap_pca<-ggplot(Miss_scores_Mcap, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+ 
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
   ggtitle("Mcap") +
  theme_classic();Miss_Mcap_pca

#Subset Pcomp
Miss_scores_Pcomp<-subset(Miss_scores, species=="Porites_compressa")
Miss_Pcomp_pca<-ggplot(Miss_scores_Pcomp, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
      ggtitle("Pcomp") +
  theme_classic();Miss_Pcomp_pca

#Subset Pvar
Miss_scores_Pvar<-subset(Miss_scores, species=="Pavona_varians")
Miss_Pvar_pca<-ggplot(Miss_scores_Pvar, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
    ggtitle("Pvar") +
  theme_classic();Miss_Pvar_pca

#Subset Pacu
Miss_scores_Pacu<-subset(Miss_scores, species=="Pocillopora_acuta")
Miss_Pacu_pca<-ggplot(Miss_scores_Pacu, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
  ggtitle("Pacuta") +
  theme_classic();Miss_Pacu_pca

#plot all species plots
Miss_Mcap_pca<-Miss_Mcap_pca+ theme(legend.position = "none") #remove legend
Miss_Pcomp_pca<-Miss_Pcomp_pca+ theme(legend.position = "none") #remove legend
Miss_Pvar_pca<-Miss_Pvar_pca+ theme(legend.position = "none") #remove legend
Miss_Pacu_pca<-Miss_Pacu_pca+ theme(legend.position = "none") #remove legend

grid.arrange(Miss_Mcap_pca, Miss_Pcomp_pca, Miss_Pvar_pca,Miss_Pacu_pca, nrow = 2)

```


PCA not alive measurements' not PAM.BW
```{r}
#PhysioData5 

PhysioData5.pca <- prcomp(PhysioData5[,c(8:11)], center = TRUE,scale. = TRUE)
summary(PhysioData5.pca)
str(PhysioData5.pca)


scores <- as.data.frame(PhysioData5.pca$x)
scores$frag.id <- data$Frag.ID
scores$parent.id <- data$Parent.ID
scores$treatment <- data$Treatment
scores$species <- data$Species
scores$time.point <- data$Time.Point
scores$treatSpecies<-paste0(scores$species, scores$treatment )
scores$treatTime<-paste0(scores$treatment, scores$time.point )


ggplot(scores, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = time.point), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = species), linetype = 2) +
  theme_classic()


#subset by T0
scores_T0<-subset(scores, time.point=="T0")
scores_T0_plot<-ggplot(scores_T0, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = treatment), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatSpecies), linetype = 2, level=0.25) +
  theme_classic();scores_T0_plot

#subset by T1
scores_T1<-subset(scores, time.point=="T1")
scores_T1_plot<-ggplot(scores_T1, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = treatment), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatSpecies), linetype = 2, level=0.25) +
  theme_classic();scores_T1_plot

#subset by TFs
scores_TF<-subset(scores, time.point=="TF")
scores_TF_plot<-ggplot(scores_TF, aes(x = PC1, y= PC2)) + geom_point(aes(colour = species, shape = treatment), size = 4) +
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatSpecies), linetype = 2, level=.25) +
  theme_classic();scores_TF_plot

#plot all time plots
scores_T0_plot<-scores_T0_plot+ theme(legend.position = "none") #remove legend
scores_T1_plot<-scores_T1_plot+ theme(legend.position = "none") #remove legend
scores_TF_plot<-scores_TF_plot+ theme(legend.position = "none") #remove legend

grid.arrange(scores_T0_plot, scores_T1_plot, scores_TF_plot, nrow = 1)


#Subset MCAP
scores_Mcap<-subset(scores, species=="Montipora_capitata")

Mcap_pca<-ggplot(scores_Mcap, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+ 
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
   ggtitle("Mcap") +
  theme_classic();Mcap_pca

#Subset Pcomp
scores_Pcomp<-subset(scores, species=="Porites_compressa")
Pcomp_pca<-ggplot(scores_Pcomp, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
      ggtitle("Pcomp") +
  theme_classic();Pcomp_pca

#Subset Pvar
scores_Pvar<-subset(scores, species=="Pavona_varians")
Pvar_pca<-ggplot(scores_Pvar, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
    ggtitle("Pvar") +
  theme_classic();Pvar_pca

#Subset Pacu
scores_Pacu<-subset(scores, species=="Pocillopora_acuta")
Pacu_pca<-ggplot(scores_Pacu, aes(x = PC1, y= PC2)) + geom_point(aes(colour = treatment, shape = time.point), size = 4)+
  stat_ellipse(aes(x = PC1, y = PC2, colour = treatTime), linetype = 2, level=.25) +
  ggtitle("Pacuta") +
  theme_classic();Pacu_pca

#plot all species plots
Mcap_pca<-Mcap_pca+ theme(legend.position = "none") #remove legend
Pcomp_pca<-Pcomp_pca+ theme(legend.position = "none") #remove legend
Pvar_pca<-Pvar_pca+ theme(legend.position = "none") #remove legend
Pacu_pca<-Pacu_pca+ theme(legend.position = "none") #remove legend

grid.arrange(Mcap_pca, Pcomp_pca, Pvar_pca,Pacu_pca, nrow = 2)
```
Lets try the PCA by Parent.ID, collapse the df by parent. 
```{r} 
 PhysioData6<-PhysioData #make a copy


Testing <- cbind(
  aggregate(PhysioData6$AFDWmg.cm2_log, by = list(PhysioData6$ParentID, PhysioData6$Treatment, PhysioData6$Species,PhysioData6$Time.Point,PhysioData6$Depth,PhysioData6$Tank.num), FUN=mean, na.rm = F))
  
  
  
  




```

